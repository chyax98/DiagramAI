# ============================================
# L3 类型层 - Mermaid Pie Chart v1.0.0
# ============================================

[meta]
level = "L3"
language = "mermaid"
diagram_type = "pie"
version = "1.0.0"
description = "Mermaid 饼图规范 - 展示比例分布"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选元数据
complexity = "low"
target_length = 1800
use_cases = ["数据占比分析", "市场份额分布", "资源分配比例", "投票结果展示"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "数据可视化专家 - 精通比例关系和百分比展示",
  "Mermaid Pie Chart 工程师 - 掌握饼图配置和标签优化"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **饼图声明**: 必须使用 `pie` 关键字开始饼图,支持可选的 `showData` 属性:
  - `pie`: 基本饼图
  - `pie showData`: 在饼图上显示具体数值
  """,

  """
  **数据格式规范**: 每个数据项必须使用 `"标签" : 数值` 格式:
  - 标签使用双引号包裹 (如 `"苹果"`)
  - 数值为正数,支持整数和小数
  - 标签和数值之间使用冒号和空格分隔 (`: `)
  - 每行一个数据项
  - 示例: `"产品A" : 42.5`
  """,

  """
  **数值有效性**: 数值必须满足以下要求:
  - 必须为正数 (> 0)
  - 支持整数和浮点数
  - 数值总和不限制 (Mermaid 自动计算百分比)
  - 避免数值过小 (< 0.1) 导致扇区不可见
  """,

  """
  **标签命名规范**: 标签应简洁明了,便于理解:
  - 长度建议 ≤ 15 个中文字符或 30 个英文字符
  - 使用有意义的名称 (如 "移动端用户" 而非 "类型A")
  - 避免使用特殊字符 (建议只用中文、英文、数字、空格)
  - 标签不得重复
  """,

  """
  **数据项数量**: 饼图扇区数量应合理:
  - 建议: 3-7 个扇区 (易于阅读和理解)
  - 最少: 2 个扇区 (至少有对比)
  - 最多: ≤ 10 个扇区 (避免视觉混乱)
  - 超过 7 个时,考虑合并小比例项为 "其他"
  """,

  """
  **标题配置 (可选)**: 可使用 `title` 添加图表标题:
  - 标题简洁明了 (≤ 30 个中文字符)
  - 标题位于 `pie` 关键字之后
  - 示例: `pie title 2024年市场份额分布`
  """,

  """
  **比例平衡性**: 扇区大小应有区分度:
  - 避免所有扇区大小相近 (差异 < 5%)
  - 避免某个扇区过于巨大 (> 90%)
  - 至少有 2 个扇区比例 ≥ 10%
  - 过小扇区 (< 2%) 考虑合并为 "其他"
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 理解数据含义**:
  - 识别数据的整体概念 (如市场份额、投票结果、资源分配)
  - 确定数据的单位 (如人数、金额、百分比、时间)
  - 理解数据的业务背景和比较维度
  - 确认数据是否适合饼图展示 (必须是比例关系)
  """,

  """
  **2. 提取关键数据**:
  - 从用户描述中提取标签和数值对
  - 如果用户提供百分比,需确认是否有实际数值
  - 如果数据项过多 (> 7个),识别主要项和次要项
  - 对于小比例项 (< 5%),考虑合并为 "其他"
  """,

  """
  **3. 选择显示模式**:
  - **基本模式** (`pie`): 仅显示百分比,适合强调比例关系
  - **数据模式** (`pie showData`): 显示具体数值,适合需要知道绝对值的场景
  - 根据用户需求选择合适的模式
  """,

  """
  **4. 优化数据表达**:
  - 标签命名: 使用简洁、有意义的标签
  - 数值处理: 保留合适的小数位数 (通常 1-2 位)
  - 排序优化: 考虑按数值大小排序 (从大到小)
  - 添加标题: 使用 `title` 说明图表主题
  """,

  """
  **5. 验证和完善**:
  - 检查数据项数量 (建议 3-7 个)
  - 确认数值都为正数
  - 验证标签无重复
  - 检查比例分布是否合理 (有区分度)
  - 确保语法正确 (标签双引号、冒号空格)
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **语法正确性**:
  - 使用 `pie` 或 `pie showData` 声明
  - 每行数据格式正确: `"标签" : 数值`
  - 标签使用双引号包裹
  - 数值为正数
  - 标题格式正确 (如使用)
  """,

  """
  **数据合理性**:
  - 数据项数量合理 (2-10 个,建议 3-7 个)
  - 数值都为正数 (> 0)
  - 标签无重复
  - 比例分布有区分度 (避免所有扇区大小相近)
  - 无过小扇区 (< 2%) 或过大扇区 (> 90%)
  """,

  """
  **可读性和美观性**:
  - 标签简洁明了 (≤ 15 个中文字符)
  - 标题清晰 (如使用)
  - 数值保留合适的小数位数
  - 扇区数量适中,视觉清晰
  - 标签命名有业务意义
  """,

  """
  **业务适配性**:
  - 数据适合用饼图展示 (比例关系)
  - 标题和标签反映真实业务场景
  - 数据单位一致 (如都是人数、都是金额)
  - 比例分布符合业务逻辑
  """
]

# ============================================
# 使用场景示例
# ============================================

[[use_cases]]
title = "市场份额分析"
scenario = "展示不同品牌或产品在市场中的占比"
key_points = [
  "标签为品牌或产品名称",
  "数值为市场份额百分比或销售额",
  "建议使用 `pie showData` 显示具体数值",
  "扇区按市场份额从大到小排序"
]

[[use_cases]]
title = "资源分配展示"
scenario = "展示预算、时间或人力资源在不同项目或部门的分配"
key_points = [
  "标签为项目或部门名称",
  "数值为分配的金额、时间或人数",
  "添加标题说明资源类型和时间周期",
  "合并小比例项 (< 5%) 为 '其他'"
]

[[use_cases]]
title = "投票结果统计"
scenario = "展示投票或调查中不同选项的支持率"
key_points = [
  "标签为选项内容",
  "数值为票数或支持率",
  "使用 `pie showData` 显示具体票数",
  "标题包含投票主题和参与人数"
]
