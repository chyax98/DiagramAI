# ============================================
# L3 类型层模板 v1.0.0
# RackDiag DataCenter (数据中心机柜布局) 规范
# ============================================

[meta]
level = "L3"
language = "rackdiag"
diagram_type = "datacenter"
version = "1.0.0"
description = "RackDiag 数据中心机柜布局规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选: 类型相关的元数据
complexity = "high"
target_length = 3500
use_cases = ["企业级数据中心标准机柜", "云服务商高密度机柜", "金融级高可用机柜", "多机柜数据中心"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "数据中心高可用架构师",
  "企业级机柜设计专家"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **冗余设计强制要求**: 数据中心级别应用要求高可用，关键路径必须全部冗余：
  - 双 UPS（建议不同品牌，避免固件漏洞同时影响）
  - 双 PDU（主备电源分离）
  - 双网络交换机（核心交换机冗余）
  - 双防火墙或双核心路由（安全设备冗余）
  - 双存储阵列或主备数据库（数据冗余）
  """,

  """
  **分区规划标准**: 数据中心机柜必须遵循清晰的分区规划：
  - 电源分区（U1-U8）：UPS + 双 PDU
  - 网络分区（U9-U16）：核心路由/交换/防火墙
  - 计算分区（U17-U32）：虚拟化主机/应用服务器/数据库
  - 存储分区（U33-U38）：存储阵列/磁盘柜
  - 管理分区（U39-U42）：监控/日志/KVM
  """,

  """
  **散热优化要求**: 高密度部署必须考虑散热：
  - 热密度分散：避免高功耗设备集中
  - 冷热通道：考虑数据中心冷热通道布局
  - 预留空位：每 10U 预留 1-2U 散热空间
  - 使用 `N/A` 标记散热预留空间
  """,

  """
  **扩展预留标准**: 数据中心设备需要定期升级和扩容：
  - 垂直扩展：预留 15-20% U 位空间
  - 水平扩展：设计支持多机柜横向扩展
  - 线缆预留：考虑未来布线需求
  """,

  """
  **管理设备要求**: 数据中心运维需要完善的管理能力：
  - KVM 或带外管理（IPMI/iDRAC）
  - 监控服务器（Zabbix/Prometheus）
  - 日志聚合服务器（ELK Stack）
  - 管理控制台（Out-of-Band）
  """,

  """
  **设备描述完整性**: 关键设备必须标注完整信息：
  - `description`：品牌/型号/功能（如 "Eaton 9PX 10kVA", "Juniper MX", "VMware ESXi"）
  - `[Nkg]`：设备重量（用于承重计算）
  - `[NA]`：设备功耗（用于电源规划）
  - `color`：使用颜色区分不同功能分区
  """,

  """
  **多机柜语法**: 如需展示多机柜数据中心，使用 `rack {}` 语法：
  ```
  rackdiag {
    rack { 1: Device1; 5: Device2; }
    rack { 1: Device3; 5: Device4; }
  }
  ```
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 分析高可用需求**:
  - 确定冗余级别（N+1 还是 2N 冗余）
  - 识别单点故障风险
  - 规划故障域隔离策略
  - 确定 SLA 要求和恢复时间目标（RTO）
  """,

  """
  **2. 设计冗余架构**:
  - 电源冗余：双 UPS + 双 PDU
  - 网络冗余：双核心交换机 + 双防火墙
  - 计算冗余：虚拟化集群 + 应用集群（2 Active + 1 Standby）
  - 存储冗余：双存储阵列或主备数据库
  - 管理冗余：监控和日志服务器独立部署
  """,

  """
  **3. 规划分区布局**:
  - 电源分区（U1-U8）：双 UPS（不同品牌）+ 双 PDU
  - 网络分区（U9-U16）：核心路由 + 双防火墙 + 双 L3 交换机
  - 计算分区（U17-U32）：虚拟化主机 × 4 + 数据库集群（主备）
  - 存储分区（U33-U38）：存储阵列 + 扩展磁盘柜
  - 管理分区（U39-U42）：监控 + 日志 + KVM
  """,

  """
  **4. 实现 RackDiag 代码**:
  - 使用 `rackdiag {}` 包裹
  - 添加分区注释（电源分区、网络分区等）
  - 按分区顺序定义设备
  - 所有关键设备标注品牌/型号
  - 冗余设备使用 -A/-B 或 -Primary/-Backup 命名
  - 使用颜色或 description 区分不同分区
  """,

  """
  **5. 验证高可用性**:
  - 冗余完整性：电源/网络/存储全链路冗余
  - 故障域隔离：不同设备使用不同品牌/型号
  - 散热优化：高功耗设备分散布局
  - 扩展预留：15-20% 空间用于未来扩展
  - 管理完善：监控/日志/KVM 完整
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **高可用架构完整性**:
  - 电源/网络/存储关键路径有备份
  - 单点故障风险已消除
  - 故障域隔离合理（不同品牌/型号）
  - 冗余设备命名规范（-A/-B, -Primary/-Backup）
  """,

  """
  **分区规划合理性**:
  - 电源 → 网络 → 计算 → 存储 → 管理分层清晰
  - 每个分区 U 位分配合理
  - 重量分布合理（重设备在底部）
  - 散热规划合理（高功耗设备分散）
  """,

  """
  **容量规划和扩展性**:
  - 承重 < 1000kg（安全范围）
  - 功耗 < 32A 或使用双 PDU 分流
  - 预留 15-20% 空间用于扩展
  - 支持水平扩展到多机柜
  """,

  """
  **企业级专业性**:
  - 设备品牌/型号标注完整
  - 设备命名符合企业规范
  - 布局符合数据中心最佳实践
  - 监控和管理设备完善
  - 适用于企业级生产环境
  """
]

# ============================================
# Section 5: 使用场景 (Use Cases)
# ============================================

[[use_cases]]
title = "企业级数据中心标准机柜"
scenario = """
企业级数据中心标准配置，包含完整的冗余设计和分区规划。
电源双冗余（不同品牌 UPS）、网络双冗余（双防火墙 + 双交换机）、计算集群（4 个虚拟化主机）、数据库主备、存储冗余。
"""
key_points = [
  "电源分区（U1-U6）：UPS-Primary (Eaton) + UPS-Backup (Schneider) + 双 PDU",
  "网络分区（U7-U14）：核心路由 [2U] + 双防火墙 [2U × 2] + 双 L3 交换机",
  "计算分区（U15-U28）：4 个虚拟化主机 (VMware ESXi) + 数据库主备集群 (Oracle RAC)",
  "存储分区（U29-U36）：主存储 [4U] + 扩展磁盘柜 [4U]",
  "管理分区（U38-U42）：监控 + 日志 + Patch Panel + KVM",
  "所有关键设备标注品牌/型号"
]

[[use_cases]]
title = "云服务商高密度计算机柜"
scenario = """
云服务商数据中心高密度部署，24 台 1U 云计算节点，双 ToR 交换机冗余，IPMI 远程管理。
重点展示高密度部署和散热优化。
"""
key_points = [
  "电源分区（U1-U8）：UPS [3U] + 双 PDU",
  "网络分区（U6-U8）：双 ToR 交换机（避免单点故障）",
  "计算分区（U9-U32）：24 台 1U 云计算节点（Intel Xeon Gold）",
  "管理分区（U40）：IPMI 控制器（Baseboard Management）",
  "散热优化：预留 U33-U39 空间用于扩展和散热",
  "超高密度部署，功耗需双 PDU 分流"
]

[[use_cases]]
title = "金融级高可用机柜（强冗余）"
scenario = """
金融级数据中心，全链路冗余设计，双 UPS（不同品牌）、双核心交换机、双防火墙、3 节点应用集群、数据库主备、双存储阵列。
所有关键路径无单点故障，监控和日志独立部署。
"""
key_points = [
  "电源高可用（U1-U8）：双 UPS 不同品牌 (Schneider + Eaton) + 双 PDU",
  "网络高可用（U9-U16）：双核心交换机 (Cisco Nexus) + 双防火墙 (Fortinet)",
  "计算高可用（U17-U28）：3 节点应用集群 (2 Active + 1 Standby) + 数据库主备 (Oracle Exadata)",
  "存储高可用（U29-U36）：双存储阵列 (EMC VMAX)",
  "管理完善（U38-U42）：监控 (Zabbix) + 日志 (ELK) + KVM",
  "全链路冗余，无单点故障"
]

[[use_cases]]
title = "多机柜数据中心布局"
scenario = """
展示两个机柜的数据中心布局，机柜 A 为计算节点，机柜 B 为存储节点。
使用 `rack {}` 语法展示多机柜横向扩展。
"""
key_points = [
  "机柜 A（计算节点）：UPS [2U] + 服务器 × 多台",
  "机柜 B（存储节点）：UPS [2U] + 存储阵列 × 多台",
  "使用 `rack {}` 语法展示多机柜",
  "每个机柜独立电源和网络",
  "展示数据中心横向扩展能力"
]
