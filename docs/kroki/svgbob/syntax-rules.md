# SvgBob 语法规则详解

> **渲染引擎**: SvgBob
> **文档类型**: 语法规则和最佳实践

---

## 📐 字符网格系统

SvgBob 基于**字符网格**工作，每个字符占据一个网格单元。

### 网格规则

1. **等宽字体**: 必须使用等宽字体（如 Courier, Consolas, Monaco）
2. **字符对齐**: 每个字符在网格中占据相同的宽度和高度
3. **空格处理**: 空格被视为透明区域

---

## 🔤 字符分类

### 1. 线条字符

#### 水平线

```
-     单横线
=     双横线
~     波浪线
```

#### 垂直线

```
|     单竖线
:     虚线竖线
```

#### 斜线

```
/     正斜线（左下到右上）
\     反斜线（左上到右下）
```

### 2. 连接字符

```
+     直角连接（四个方向）
*     节点（任意方向）
o     小圆点/节点
x     交叉点
```

### 3. 箭头字符

```
>     向右箭头头部
<     向左箭头头部
v     向下箭头头部
^     向上箭头头部
V     大向下箭头
A     大向上箭头
```

### 4. 边框字符

#### 尖角边框

```
+------+
|      |
+------+
```

#### 圆角边框

```
.------.
|      |
'------'
```

#### 双线边框

```
.======.
||    ||
'======'
```

### 5. 形状字符

#### 圆形/椭圆

```
   ___       使用下划线和斜线
  /   \      构建圆形
 |     |
  \___/

  .---.      使用点和横线
 (     )     构建圆形
  '---'
```

#### 菱形

```
   /\
  /  \
  \  /
   \/
```

---

## 🎯 形状识别规则

### 1. 矩形识别

SvgBob 自动识别以下模式为矩形：

```
+---+    .---.    +===+
|   |    |   |    |   |
+---+    '---'    +===+
```

**规则**:

- 四个角必须对齐
- 边必须连续
- 内部可以包含文本

### 2. 箭头识别

```
--->    单箭头
-->>    双箭头
<---    左箭头
<-->    双向箭头
```

**规则**:

- 箭头头部必须与线条连接
- 支持水平、垂直和对角箭头

### 3. 线条连接规则

```
A----+----B     正确：+ 连接两条线
     |
     C

A----+----B     错误：缺少连接点

     C
```

---

## 📝 文本处理规则

### 1. 文本识别

- **自动识别**: 不属于图形字符的内容被视为文本
- **居中对齐**: 在形状内部的文本会自动居中
- **换行**: 使用多行文本时，每行独立处理

### 2. 文本位置

```
+--------+
|  Text  |    <- 文本在矩形中央
+--------+

A --Text--> B  <- 文本在箭头上方/内部
```

### 3. 特殊文本字符

- 使用反斜杠 `\` 转义特殊字符
- 空格用于调整文本位置

---

## 🎨 样式系统规则

### 1. 标签语法

```
形状 {tag_name}

示例:
+------+
| {r1} |
+------+
```

### 2. CSS 样式定义

```
# 在图表代码后定义
tag_name = {
    property: value;
    property: value;
}
```

### 3. 支持的 CSS 属性

```css
fill: color; /* 填充色 */
stroke: color; /* 边框色 */
stroke-width: number; /* 边框宽度 */
stroke-dasharray: number; /* 虚线样式 */
opacity: number; /* 透明度 */
```

### 4. 多标签支持

```
+------+
| {a,b}|    <- 可以应用多个标签
+------+

a = { fill: red; }
b = { stroke: blue; }
```

---

## 🔄 绘图顺序规则

SvgBob 按以下顺序处理图表：

1. **扫描字符网格**
2. **识别形状模式** (矩形、圆形等)
3. **识别线条和箭头**
4. **处理连接点**
5. **提取文本标签**
6. **应用样式**
7. **生成 SVG 输出**

---

## ⚠️ 对齐规则

### 1. 网格对齐

所有元素必须对齐到字符网格：

```
正确:
+---+
|   |
+---+

错误:
+---+
 |   |    <- 左边界未对齐
+---+
```

### 2. 连接点对齐

```
正确:
A----+
     |
     B

错误:
A----+
      |   <- 连接点错位
     B
```

### 3. 角度限制

SvgBob 仅支持以下角度：

- 0° (水平)
- 90° (垂直)
- 45° (对角线)

---

## 🔢 尺寸规则

### 1. 最小尺寸

```
最小矩形: 3x3 字符
+-+
| |
+-+

最小圆形: 5x3 字符
 ___
/   \
\___/
```

### 2. 线条长度

- 最小线条长度: 1 个字符
- 无最大限制（受限于文本编辑器）

---

## 🎯 最佳实践

### 1. 使用一致的边框样式

```
推荐:
+---+  +---+  +---+
|   |  |   |  |   |
+---+  +---+  +---+

避免混用:
+---+  .---.  +===+
|   |  |   |  |   |
+---+  '---'  +===+
```

### 2. 保持适当的间距

```
好的间距:
+---+     +---+
| A |---->| B |
+---+     +---+

太密集:
+---++---+
| A || B |
+---++---+
```

### 3. 使用注释

```
# 这是系统架构图
# 显示了主要组件的连接关系

+--------+
| Server |
+--------+
```

### 4. 分层组织

```
# 第一层: 用户界面
+----+  +----+
| UI |  | UI |
+----+  +----+
   |      |
# 第二层: 业务逻辑
   v      v
+-------------+
|   Service   |
+-------------+
```

---

## 🚫 常见错误

### 1. 缺失连接点

```
错误:
A----
    B    <- 没有连接点

正确:
A----+
     |
     B
```

### 2. 不对齐的边框

```
错误:
+---+
|   |
 +---+   <- 底部边框缩进

正确:
+---+
|   |
+---+
```

### 3. 箭头方向错误

```
错误:
A <--- B   <- 箭头指向 A，但线条从 B 开始

正确:
A <--- B   <- 明确表示从 B 指向 A
或
B ---> A   <- 明确表示从 B 指向 A
```

### 4. 文本覆盖形状

```
错误:
+Text+    <- 文本与边框字符冲突
| Box|
+---+

正确:
+------+
| Text |
+------+
```

---

## 🔧 高级语法

### 1. 嵌套结构

```
.~~~~~~~~~~~~~~~~~.
!   +-------+     :
!   | Inner |     :
!   +-------+     :
!                 :
'~~~~~~~~~~~~~~~~~'
```

### 2. 复杂连接

```
    A
   / \
  B   C
 / \ / \
D   E   F
```

### 3. 表格结构

```
+---+---+---+
| A | B | C |
+---+---+---+
| 1 | 2 | 3 |
+---+---+---+
```

---

## 📊 字符优先级

当多个字符可以形成形状时，SvgBob 使用以下优先级：

1. **明确的形状字符** (`+`, `.`, `'`) > 普通字符
2. **箭头** > 普通线条
3. **连接点** (`+`, `*`) > 线条交叉
4. **封闭形状** > 开放线条

---

## 🎨 样式优先级

1. **直接标签样式** > 继承样式
2. **后定义的样式** > 先定义的样式
3. **多标签**: 后面的标签覆盖前面的冲突属性

---

**最后更新**: 2025-10-13
**适用版本**: SvgBob 0.7.6+
