# ============================================
# L3 类型层 - Mermaid XY Chart v1.0.0
# ============================================

[meta]
level = "L3"
language = "mermaid"
diagram_type = "xychart"
version = "1.0.0"
description = "L3: mermaid - XY 图表图表生成规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选元数据
complexity = "medium"
target_length = 2400
use_cases = ["数据趋势分析", "指标监控", "性能对比", "统计图表", "时间序列"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "数据分析专家 - 理解数据趋势和统计分析",
  "图表设计专家 - 精通折线图、柱状图的视觉表达",
  "Mermaid XYChart 工程师 - 掌握 xyChart 语法和配置"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **图表声明**: XY 图表必须使用 `xychart-beta` 或 `xyChart` 声明:
  - 推荐语法: `xychart-beta`（实验性功能，功能更丰富）
  - 兼容语法: `xyChart`（稳定版本）
  - 图表标题: `title "图表标题"`（可选）
  - X 轴标题: `x-axis "X轴名称" [分类1, 分类2, ...]`（必需）
  - Y 轴标题: `y-axis "Y轴名称" 最小值 --> 最大值`（必需）
  """,

  """
  **X 轴定义**: X 轴必须定义类别或时间点:
  - 格式: `x-axis "标题" [类别1, 类别2, 类别3, ...]`
  - 类别数量: 至少 2 个类别
  - 类别名称: 支持中文、英文、数字
  - 正确示例: `x-axis "月份" [1月, 2月, 3月, 4月, 5月]`
  - 错误示例: `x-axis [1月, 2月]`（缺少标题）
  """,

  """
  **Y 轴定义**: Y 轴必须定义数值范围:
  - 格式: `y-axis "标题" 最小值 --> 最大值`
  - 数值范围: 最小值 < 最大值
  - 范围合理: 应覆盖所有数据点
  - 正确示例: `y-axis "销售额(万元)" 0 --> 100`
  - 错误示例: `y-axis "销售额" 100 --> 0`（范围错误）
  """,

  """
  **数据系列定义**: 使用 `line` 或 `bar` 定义数据系列:
  - 折线图: `line [数值1, 数值2, 数值3, ...]`
  - 柱状图: `bar [数值1, 数值2, 数值3, ...]`
  - 数据点数量: 必须与 X 轴类别数量一致
  - 数据格式: 数值用逗号分隔，支持整数和小数
  - 正确示例: `line [10, 25, 40, 35, 50]`（5个数据点）
  - 错误示例: `line [10, 25, 40]`（与X轴类别数量不一致）
  """,

  """
  **多系列数据**: 支持在同一图表中显示多条折线或柱状:
  - 混合类型: 可以同时使用 `line` 和 `bar`
  - 系列数量: 建议不超过 5 条系列
  - 数据一致性: 每条系列的数据点数量必须与 X 轴一致
  - 示例:
    ```
    line [10, 20, 30, 40, 50]
    line [15, 25, 35, 45, 55]
    bar [5, 10, 15, 20, 25]
    ```
  """,

  """
  **数据值约束**: 数据值必须在 Y 轴范围内:
  - 范围检查: 所有数据点应在 Y 轴最小值和最大值之间
  - 推荐做法: Y 轴范围略大于数据范围（留 10% 余量）
  - 异常值: 超出范围的数据可能导致显示问题
  - 精度: 小数位数建议不超过 2 位
  """,

  """
  **图表类型选择**: 根据数据特征选择合适的图表类型:
  - 折线图 (`line`): 适合展示趋势变化、连续数据
  - 柱状图 (`bar`): 适合展示对比、分类数据
  - 混合图: 适合同时展示趋势和对比（如实际值vs目标值）
  - 建议: 时间序列用折线图，类别对比用柱状图
  """,

  """
  **完整性检查**: 生成前必须检查:
  - X 轴定义: 标题和类别完整
  - Y 轴定义: 标题和范围正确
  - 数据一致性: 每条系列的数据点数量与 X 轴类别数量一致
  - 数值范围: 所有数据点在 Y 轴范围内
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 分析数据特征**:
  - 数据类型: 确定 X 轴是类别（如月份、产品）还是连续值（如时间）
  - 数值范围: 确定 Y 轴的最小值和最大值
  - 数据系列: 确定需要展示几条数据系列
  - 图表类型: 选择折线图、柱状图或混合图
  """,

  """
  **2. 设计 X 轴和 Y 轴**:
  - X 轴: 定义标题和类别列表
  - Y 轴: 定义标题和数值范围
  - 范围优化: Y 轴范围留 10% 余量
  - 标题语义化: 使用清晰的轴标题（如 "月份", "销售额(万元)"）
  """,

  """
  **3. 组织数据系列**:
  - 数据收集: 收集每个类别对应的数值
  - 数据验证: 确保数据点数量与 X 轴类别数量一致
  - 系列选择: 选择 `line` 或 `bar` 类型
  - 多系列: 如有对比需求，定义多条数据系列
  """,

  """
  **4. 生成代码**:
  - 声明图表: 添加 `xychart-beta` 或 `xyChart`
  - 添加标题: `title "图表标题"`（可选）
  - 定义 X 轴: `x-axis "标题" [类别1, 类别2, ...]`
  - 定义 Y 轴: `y-axis "标题" 最小值 --> 最大值`
  - 添加数据: 逐行添加 `line` 或 `bar` 数据系列
  """,

  """
  **5. 质量检查**:
  - 语法正确: 检查 X 轴、Y 轴格式正确
  - 数据一致: 每条系列数据点数量与 X 轴类别数量一致
  - 范围合理: 所有数据点在 Y 轴范围内
  - 视觉清晰: 图表类型选择恰当，数据系列不超过 5 条
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **轴定义完整性**:
  - X 轴: 标题和类别列表完整，至少 2 个类别
  - Y 轴: 标题和数值范围正确，最小值 < 最大值
  - 轴标题: 语义化，清晰表达数据含义
  - 范围合理: Y 轴范围覆盖所有数据点
  """,

  """
  **数据一致性**:
  - 数据点数量: 每条系列的数据点数量与 X 轴类别数量一致
  - 数值范围: 所有数据点在 Y 轴范围内
  - 数据精度: 小数位数适中（建议 0-2 位）
  - 数据合理: 数据值符合实际业务逻辑
  """,

  """
  **图表类型适配性**:
  - 折线图: 用于展示趋势、连续数据、时间序列
  - 柱状图: 用于展示对比、分类数据、离散值
  - 混合图: 合理组合折线和柱状，不超过 5 条系列
  - 类型选择: 图表类型与数据特征匹配
  """,

  """
  **视觉清晰度**:
  - 系列数量: 建议不超过 5 条数据系列
  - 图表标题: 清晰描述图表内容（可选）
  - 轴标题: 标题语义化，包含单位（如 "万元", "%"）
  - 数据分布: 数据分布均匀，避免数量级差异过大
  """
]

# ============================================
# 使用场景示例
# ============================================

[[use_cases]]
title = "月度销售趋势分析"
scenario = "展示公司过去 6 个月的销售额变化趋势，分析增长情况"
key_points = [
  "X 轴: 月份（1月-6月）",
  "Y 轴: 销售额（0-100 万元）",
  "数据系列: 折线图展示销售额趋势",
  "用途: 分析销售增长趋势，识别高峰和低谷"
]

[[use_cases]]
title = "产品性能对比图"
scenario = "对比不同产品在多个指标上的性能表现"
key_points = [
  "X 轴: 产品名称（产品A、产品B、产品C、产品D）",
  "Y 轴: 性能分数（0-100）",
  "数据系列: 柱状图展示各产品性能分数",
  "用途: 直观对比产品性能，辅助决策"
]

[[use_cases]]
title = "实际vs目标对比图"
scenario = "展示每月实际完成情况与目标值的对比"
key_points = [
  "X 轴: 月份（1月-12月）",
  "Y 轴: 完成率（0-120%）",
  "数据系列1: 折线图展示实际完成率",
  "数据系列2: 折线图展示目标完成率（100%基线）",
  "用途: 监控目标达成情况，识别差距"
]
