# ============================================
# L3 类型层 - Vega-Lite Scatter Plot v1.0.0
# ============================================

[meta]
level = "L3"
language = "vegalite"
diagram_type = "scatter"
version = "1.0.0"
description = "Vega-Lite 散点图规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选元数据
complexity = "medium"
target_length = 2800
use_cases = ["相关性分析", "数据分布展示", "聚类识别", "气泡图"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "数据关系分析专家 - 精通变量相关性和数据分布特征识别",
  "散点图专家 - 擅长散点图的分类、气泡图和多维数据展示"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **mark 类型固定**: 散点图必须使用 `"point"` 标记类型:
  - ✅ **正确**: `"mark": "point"` 或 `"mark": {"type": "point"}`
  - ❌ **错误**: `"mark": "scatter"` 或 `"mark": "dot"`
  """,

  """
  **坐标轴数据类型**: 散点图的 x/y 轴通常使用 `quantitative` 类型:
  - ✅ **正确**: `{"field": "height", "type": "quantitative"}`
  - **连续数值数据**: 身高、体重、价格、评分等
  - **特殊情况**: 时间数据可使用 `temporal` 类型
  """,

  """
  **数据点样式**: 必须设置清晰可见的数据点样式:
  - ✅ **推荐**: `"filled": true` 填充数据点
  - ✅ **推荐**: `"size": 100` 设置合适的大小
  - 默认的 point 可能不够明显
  """,

  """
  **坐标轴范围**: 根据数据特点设置坐标轴范围:
  - `"scale": {"zero": false}` - 显示数据真实范围（身高、体重等）
  - `"scale": {"zero": true}` - 从 0 开始（销售额等）
  - `"scale": {"domain": [min, max]}` - 固定范围（如 0-100 分）
  """,

  """
  **分类散点图**: 使用 `color` 通道区分不同类别:
  - 数据需要包含分类字段
  - color 通道使用 `nominal` 类型
  - 添加图例标题（`legend.title`）
  """,

  """
  **气泡图实现**: 使用 `size` 通道表示第三维度:
  - ✅ **正确**: `"size": {"field": "value", "type": "quantitative"}`
  - ❌ **错误**: 使用 `color` 表示数值维度
  - 使用 `scale.range` 控制气泡大小范围
  """,

  """
  **透明度控制**: 气泡图建议使用适当透明度:
  - 使用 `"opacity": 0.7` 避免重叠遮挡
  - 特别是气泡图和数据密集的散点图
  """,

  """
  **tooltip 必需**: 散点图必须启用交互提示:
  - 使用 `"tooltip": true` 提升交互性
  - 帮助用户查看具体数据点的详细信息
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 识别散点图类型**:
  - **基础散点图**: 两个变量的相关性分析
  - **分类散点图**: 按类别着色区分不同组
  - **气泡图**: 使用大小表示第三维度
  - **多维散点图**: 结合 color, size, shape 多个通道
  """,

  """
  **2. 准备数据结构**:
  - **基础散点图**: `[{"x": 10, "y": 20}]`
  - **分类散点图**: `[{"x": 10, "y": 20, "category": "A"}]`
  - **气泡图**: `[{"x": 10, "y": 20, "size_value": 100}]`
  - 确保 x/y 字段为数值数据
  """,

  """
  **3. 配置坐标轴**:
  - x/y 轴使用 `quantitative` 类型
  - 根据数据特点设置 `scale.zero`
  - 添加清晰的坐标轴标题
  - 必要时固定坐标轴范围（`scale.domain`）
  """,

  """
  **4. 设置数据点样式**:
  - 使用 `filled: true` 填充数据点
  - 设置合适的 `size`（建议 100-120）
  - 单系列使用 `mark.color` 设置颜色
  - 分类图使用 `color` 通道区分
  - 气泡图使用 `size` 通道映射数值
  """,

  """
  **5. 优化可读性**:
  - 气泡图使用 `opacity` 避免重叠
  - 启用 `tooltip` 提升交互性
  - 添加图例标题（分类图、气泡图）
  - 设置合理的图表尺寸
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **坐标轴类型正确性**:
  - x/y 轴使用 `quantitative` 类型
  - 类型选择符合数据语义
  - 时间数据使用 `temporal` 类型
  """,

  """
  **数据点可见性**:
  - 数据点清晰可辨（filled: true, size 合适）
  - 颜色对比明显
  - 重叠区域使用透明度处理
  """,

  """
  **坐标轴范围合理性**:
  - 范围设置符合数据特点
  - 不从 0 开始的数据正确设置 scale.zero: false
  - 固定范围数据使用 scale.domain
  """,

  """
  **多维数据正确性**:
  - 分类散点图使用 `color` 通道
  - 气泡图使用 `size` 通道
  - 图例标题和标签清晰
  - 数据格式正确（包含所需字段）
  """
]

# ============================================
# Section 5: 使用场景 (Use Cases)
# ============================================

[[use_cases]]
title = "身高体重相关性分析"
scenario = "展示身高和体重的关系，识别是否存在正相关"
key_points = [
  "x/y 轴使用 quantitative 类型",
  "scale.zero: false 显示数据真实范围",
  "启用 tooltip 显示具体数值"
]

[[use_cases]]
title = "学生成绩分布（按班级分类）"
scenario = "展示不同班级学生的数学和英语成绩分布，识别班级差异"
key_points = [
  "使用 color 通道区分不同班级",
  "scale.domain: [0, 100] 固定坐标轴范围",
  "图例清晰标注班级信息"
]

[[use_cases]]
title = "城市人口、GDP和面积关系（气泡图）"
scenario = "使用气泡图展示城市的三维数据：人口（x轴）、GDP（y轴）、面积（气泡大小）"
key_points = [
  "使用 size 通道表示面积（第三维度）",
  "使用 color 通道区分不同城市",
  "opacity: 0.7 避免气泡重叠遮挡",
  "scale.range 控制气泡大小范围"
]

[[use_cases]]
title = "广告投放效果分析"
scenario = "分析广告点击率和转化率的关系，识别高效广告渠道"
key_points = [
  "x 轴点击率，y 轴转化率",
  "使用 color 区分不同渠道",
  "识别高效象限（高点击率 + 高转化率）"
]
