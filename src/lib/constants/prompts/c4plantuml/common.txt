
# C4-PlantUML è¯­è¨€è§„èŒƒ

## å¼ºåˆ¶è§„åˆ™ï¼ˆMandatory Rulesï¼‰

C4-PlantUML åŸºäº PlantUMLï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹å¼ºåˆ¶è§„åˆ™ï¼š

### âš ï¸ è§„åˆ™ 1: æ‰€æœ‰å›¾è¡¨å¿…é¡»ä½¿ç”¨ @startuml å’Œ @enduml åŒ…è£¹
è¿™æ˜¯ PlantUML æœ€åŸºæœ¬çš„å¼ºåˆ¶è§„åˆ™ï¼ç¼ºå°‘ä¼šå¯¼è‡´æ¸²æŸ“å¤±è´¥ã€‚

**é”™è¯¯ç¤ºä¾‹**ï¼š
```plantuml
!include <C4/C4_Container>
Person(user, "ç”¨æˆ·")
```

**ç¼–è¯‘é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Syntax error at line 1: Unexpected content outside @startuml block
```

**æ­£ç¡®å†™æ³•**ï¼š
```plantuml
@startuml
!include <C4/C4_Container>
Person(user, "ç”¨æˆ·")
@enduml
```

### âš ï¸ è§„åˆ™ 2: ç‰¹æ®Šå­—ç¬¦å¿…é¡»ç”¨åŒå¼•å·åŒ…è£¹
æ–¹æ‹¬å· []ã€èŠ±æ‹¬å· {}ã€åœ†æ‹¬å· () åœ¨æè¿°æ–‡æœ¬ä¸­ä½¿ç”¨æ—¶å¿…é¡»ç”¨åŒå¼•å·åŒ…è£¹ã€‚

**é”™è¯¯ç¤ºä¾‹**ï¼š
```plantuml
@startuml
!include <C4/C4_Container>
Container(api, APIæœåŠ¡[v2], "Node.js")
@enduml
```

**ç¼–è¯‘é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Syntax error at line 3: Unexpected token '['
```

**æ­£ç¡®å†™æ³•**ï¼š
```plantuml
@startuml
!include <C4/C4_Container>
Container(api, "APIæœåŠ¡[v2]", "Node.js", "RESTful API")
@enduml
```

### âš ï¸ è§„åˆ™ 3: å¿…é¡»åŒ…å«å®Œæ•´çš„ C4-PlantUML åº“å¼•ç”¨ï¼ˆæœ€è‡´å‘½é”™è¯¯ï¼‰
**è¿™æ˜¯å¯¼è‡´æ¸²æŸ“å¤±è´¥çš„é¦–è¦åŸå› ï¼** ä¸å®Œæ•´çš„ `!include` ä¼šå¯¼è‡´ PlantUML æ— æ³•è¯†åˆ« C4 å…³é”®å­—ã€‚

**âŒ é”™è¯¯ç¤ºä¾‹ - ä¸å®Œæ•´çš„ include**ï¼š
```plantuml
@startuml
!include  <-- ç¼ºå°‘åº“æ–‡ä»¶è·¯å¾„ï¼Œå¯¼è‡´æ¸²æŸ“å¤±è´¥

title ç³»ç»Ÿä¸Šä¸‹æ–‡å›¾
Person(customer, "é¡¾å®¢", "åœ¨çº¿è´­ç‰©ç”¨æˆ·")
System(ecommerce, "ç”µå•†ç³»ç»Ÿ")
@enduml
```

**Kroki å®é™…é”™è¯¯ä¿¡æ¯**ï¼š
```
Error 400: cannot include  (line: 1)
```

**âœ… æ­£ç¡®å†™æ³•ï¼ˆä¸¤ç§å®˜æ–¹æ”¯æŒçš„æ ¼å¼ï¼‰**ï¼š

**æ–¹å¼ 1 - ä½¿ç”¨æ ‡å‡†åº“çŸ­æ ¼å¼ï¼ˆæ¨èï¼Œé€‚ç”¨äºæ”¯æŒ PlantUML æ ‡å‡†åº“çš„ç¯å¢ƒï¼‰**ï¼š
```plantuml
@startuml
!include <C4/C4_Context>

title ç³»ç»Ÿä¸Šä¸‹æ–‡å›¾
Person(customer, "é¡¾å®¢", "åœ¨çº¿è´­ç‰©ç”¨æˆ·")
System(ecommerce, "ç”µå•†ç³»ç»Ÿ")
@enduml
```

**æ–¹å¼ 2 - ä½¿ç”¨ HTTPS URLï¼ˆåœ¨çº¿ç¯å¢ƒï¼Œå§‹ç»ˆæœ€æ–°ï¼‰**ï¼š
```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

title ç³»ç»Ÿä¸Šä¸‹æ–‡å›¾
Person(customer, "é¡¾å®¢", "åœ¨çº¿è´­ç‰©ç”¨æˆ·")
System(ecommerce, "ç”µå•†ç³»ç»Ÿ")
@enduml
```

**âš ï¸ æ ¹æ®å›¾è¡¨ç±»å‹é€‰æ‹©æ­£ç¡®çš„åº“æ–‡ä»¶**ï¼š
| å›¾è¡¨ç±»å‹ | æ ‡å‡†åº“çŸ­æ ¼å¼ | HTTPS URL |
|---------|------------|-----------|
| Context å›¾ | `!include <C4/C4_Context>` | `!include https://raw.githubusercontent.com/.../C4_Context.puml` |
| Container å›¾ | `!include <C4/C4_Container>` | `!include https://raw.githubusercontent.com/.../C4_Container.puml` |
| Component å›¾ | `!include <C4/C4_Component>` | `!include https://raw.githubusercontent.com/.../C4_Component.puml` |
| Dynamic å›¾ | `!include <C4/C4_Dynamic>` | `!include https://raw.githubusercontent.com/.../C4_Dynamic.puml` |
| Deployment å›¾ | `!include <C4/C4_Deployment>` | `!include https://raw.githubusercontent.com/.../C4_Deployment.puml` |

**æ³¨æ„**: Kroki é»˜è®¤åœ¨ SECURE æ¨¡å¼ä¸‹è¿è¡Œ,å¯èƒ½é˜»æ­¢å¤–éƒ¨ URL includeã€‚ä¼˜å…ˆä½¿ç”¨**æ ‡å‡†åº“çŸ­æ ¼å¼**ã€‚

### âš ï¸ è§„åˆ™ 4: æ‰‹å†™é£æ ¼å¿…é¡»ä½¿ç”¨ !option æŒ‡ä»¤ï¼ˆKroki å…¼å®¹æ€§ï¼‰
**é‡è¦**: æ—§è¯­æ³• `skinparam handwritten true` åœ¨ Kroki ç¯å¢ƒä¸‹å·²åºŸå¼ƒï¼Œå¿…é¡»ä½¿ç”¨æ–°è¯­æ³•ã€‚

**é”™è¯¯ç¤ºä¾‹**ï¼š
```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
skinparam handwritten true
Person(user, "ç”¨æˆ·")
@enduml
```

**Kroki é”™è¯¯ä¿¡æ¯**ï¼š
```
Warning: 'skinparam handwritten' is deprecated, use '!option handwritten' instead
```

**æ­£ç¡®å†™æ³•**ï¼š
```plantuml
@startuml
!option handwritten false
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
Person(user, "ç”¨æˆ·")
@enduml
```

## æ ¸å¿ƒæ¦‚å¿µ

C4 æ¨¡å‹ï¼ˆContext, Container, Component, Codeï¼‰æ˜¯ä¸€ç§ç”¨äºå¯è§†åŒ–è½¯ä»¶æ¶æ„çš„åˆ†å±‚æ–¹æ³•ã€‚C4-PlantUML æ˜¯ PlantUML çš„æ‰©å±•åº“ï¼Œä¸“é—¨ç”¨äºç»˜åˆ¶ C4 æ¨¡å‹å›¾è¡¨ã€‚

### C4 æ¨¡å‹å››ä¸ªå±‚æ¬¡

1. **Level 1 - System Context**: ç³»ç»Ÿä¸å¤–éƒ¨å®ä½“çš„äº¤äº’å…³ç³»
2. **Level 2 - Container**: ç³»ç»Ÿå†…éƒ¨çš„é«˜å±‚æŠ€æœ¯æ„æˆï¼ˆåº”ç”¨ã€æ•°æ®åº“ã€æœåŠ¡ç­‰ï¼‰
3. **Level 3 - Component**: å®¹å™¨å†…éƒ¨çš„ç»„ä»¶å’ŒèŒè´£åˆ’åˆ†
4. **Level 4 - Code**: ä»£ç çº§åˆ«çš„ç±»å›¾ï¼ˆé€šå¸¸ä¸åœ¨ C4-PlantUML ä¸­å®ç°ï¼‰

## åŸºç¡€è¯­æ³•

### å›¾è¡¨å£°æ˜

æ‰€æœ‰ C4-PlantUML å›¾è¡¨å¿…é¡»åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

```plantuml
@startuml
' ä½¿ç”¨æ ‡å‡†åº“çŸ­æ ¼å¼ï¼ˆæ¨èï¼‰
!include <C4/C4_Container>

' æ¨èæ·»åŠ å¸ƒå±€å®
LAYOUT_WITH_LEGEND()

' å›¾è¡¨æ ‡é¢˜
title å®¹å™¨æ¶æ„å›¾

' å›¾è¡¨å†…å®¹...

@enduml
```

**âš ï¸ æ ¹æ®å›¾è¡¨ç±»å‹é€‰æ‹©æ­£ç¡®çš„åº“æ–‡ä»¶**ï¼š
- **Context å›¾**: `!include <C4/C4_Context>`
- **Container å›¾**: `!include <C4/C4_Container>`
- **Component å›¾**: `!include <C4/C4_Component>`
- **Dynamic å›¾**: `!include <C4/C4_Dynamic>`
- **Deployment å›¾**: `!include <C4/C4_Deployment>`

### å…ƒç´ å®šä¹‰

#### äººå‘˜ï¼ˆPersonï¼‰
```plantuml
Person(alias, "æ˜¾ç¤ºåç§°", "å¯é€‰æè¿°")
Person_Ext(alias, "å¤–éƒ¨äººå‘˜", "å¤–éƒ¨ç”¨æˆ·æè¿°")
```

#### ç³»ç»Ÿï¼ˆSystemï¼‰
```plantuml
System(alias, "ç³»ç»Ÿåç§°", "ç³»ç»Ÿæè¿°")
System_Ext(alias, "å¤–éƒ¨ç³»ç»Ÿ", "å¤–éƒ¨ç³»ç»Ÿæè¿°")
System_Boundary(alias, "è¾¹ç•Œåç§°") {
    ' å†…éƒ¨å®¹å™¨...
}
```

**âš ï¸ è¾¹ç•ŒåµŒå¥—è§„åˆ™**:
- `Enterprise_Boundary` å¯åŒ…å«: System, System_Boundary
- `System_Boundary` å¯åŒ…å«: Container, ContainerDb, ContainerQueue
- `Container_Boundary` å¯åŒ…å«: Component, ComponentDb, ComponentQueue
- ä¸å…è®¸åŒç±»è¾¹ç•ŒåµŒå¥— (å¦‚ System_Boundary å†…ä¸èƒ½å†åµŒå¥— System_Boundary)
- å¦‚éœ€é€šç”¨åˆ†ç»„,ä½¿ç”¨ `Boundary(alias, "æ ‡ç­¾")` (æ— ç±»å‹é™åˆ¶)

**ç¤ºä¾‹ - ä¼ä¸šçº§è¾¹ç•ŒåµŒå¥—**:
```plantuml
@startuml
!include <C4/C4_Container>

Enterprise_Boundary(enterprise, "ä¼ä¸šè¾¹ç•Œ") {
    System_Boundary(system1, "ç³»ç»ŸA") {
        Container(web1, "Webåº”ç”¨", "React")
        ContainerDb(db1, "æ•°æ®åº“", "PostgreSQL")
    }

    System_Boundary(system2, "ç³»ç»ŸB") {
        Container(api2, "APIæœåŠ¡", "Node.js")
    }
}
@enduml
```

#### å®¹å™¨ï¼ˆContainerï¼‰
```plantuml
Container(alias, "å®¹å™¨åç§°", "æŠ€æœ¯æ ˆ", "å®¹å™¨æè¿°")
Container_Boundary(alias, "è¾¹ç•Œåç§°") {
    ' å†…éƒ¨ç»„ä»¶...
}
```

**å®¹å™¨ä¸“ç”¨å˜ä½“**:
```plantuml
ContainerDb(alias, "æ•°æ®åº“åç§°", "æ•°æ®åº“ç±»å‹", "æ•°æ®æè¿°")
ContainerQueue(alias, "é˜Ÿåˆ—åç§°", "é˜Ÿåˆ—æŠ€æœ¯", "é˜Ÿåˆ—æè¿°")
```

**è¯´æ˜**: ä½¿ç”¨ä¸“ç”¨å®ä¼šè‡ªåŠ¨åº”ç”¨å¯¹åº”çš„æ•°æ®åº“æˆ–é˜Ÿåˆ—å›¾æ ‡,å¢å¼ºè§†è§‰è¯†åˆ«åº¦ã€‚

**ç¤ºä¾‹**:
```plantuml
ContainerDb(userDb, "ç”¨æˆ·æ•°æ®åº“", "PostgreSQL", "å­˜å‚¨ç”¨æˆ·ä¿¡æ¯")
ContainerQueue(msgQueue, "æ¶ˆæ¯é˜Ÿåˆ—", "RabbitMQ", "å¼‚æ­¥ä»»åŠ¡å¤„ç†")
```

#### ç»„ä»¶ï¼ˆComponentï¼‰
```plantuml
Component(alias, "ç»„ä»¶åç§°", "æŠ€æœ¯æ ˆ", "ç»„ä»¶æè¿°")
```

**ç»„ä»¶ä¸“ç”¨å˜ä½“**:
```plantuml
ComponentDb(alias, "æ•°æ®ç»„ä»¶", "æŠ€æœ¯", "æ•°æ®è®¿é—®æè¿°")
ComponentQueue(alias, "æ¶ˆæ¯ç»„ä»¶", "æŠ€æœ¯", "æ¶ˆæ¯å¤„ç†æè¿°")
```

**è¯´æ˜**: ä½¿ç”¨ä¸“ç”¨å®ä¼šè‡ªåŠ¨åº”ç”¨å¯¹åº”çš„æ•°æ®åº“æˆ–é˜Ÿåˆ—å›¾æ ‡,å¢å¼ºè§†è§‰è¯†åˆ«åº¦ã€‚

**ç¤ºä¾‹**:
```plantuml
ComponentDb(userRepo, "ç”¨æˆ·ä»“å‚¨", "JPA/Hibernate", "ç”¨æˆ·æ•°æ®è®¿é—®å±‚")
ComponentQueue(eventHandler, "äº‹ä»¶å¤„ç†å™¨", "Spring AMQP", "å¤„ç†å¼‚æ­¥äº‹ä»¶")
```

### å…³ç³»å®šä¹‰

#### åŸºç¡€å…³ç³»
```plantuml
Rel(from, to, "æè¿°", "å¯é€‰æŠ€æœ¯")
Rel_Back(from, to, "åå‘å…³ç³»", "æŠ€æœ¯")
```

#### æ–¹å‘å…³ç³»
```plantuml
Rel_U(from, to, "å‘ä¸Š", "æŠ€æœ¯")    ' Upward
Rel_D(from, to, "å‘ä¸‹", "æŠ€æœ¯")    ' Downward
Rel_L(from, to, "å‘å·¦", "æŠ€æœ¯")    ' Left
Rel_R(from, to, "å‘å³", "æŠ€æœ¯")    ' Right
```

#### å¸¦åºå·å…³ç³»ï¼ˆåŠ¨æ€å›¾ä¸“ç”¨ï¼‰

```plantuml
RelIndex(1, from, to, "æè¿°")
RelIndex(2, from, to, "æè¿°", "æŠ€æœ¯")
```

**ä½¿ç”¨åœºæ™¯**: C4 åŠ¨æ€å›¾ (Dynamic Diagram),ç”¨äºå±•ç¤ºæ—¶åºäº¤äº’æµç¨‹,åºå·è¡¨ç¤ºæ‰§è¡Œé¡ºåºã€‚

**ç¤ºä¾‹**:
```plantuml
@startuml
!include <C4/C4_Dynamic>

title ç™»å½•æµç¨‹åŠ¨æ€å›¾

Person(user, "ç”¨æˆ·")
Container(web, "Webåº”ç”¨", "React")
Container(api, "APIæœåŠ¡", "Node.js")
ContainerDb(db, "æ•°æ®åº“", "PostgreSQL")

RelIndex(1, user, web, "è¾“å…¥è´¦å·å¯†ç ")
RelIndex(2, web, api, "POST /login", "HTTPS/JSON")
RelIndex(3, api, db, "éªŒè¯å‡­è¯", "SQL")
RelIndex(4, db, api, "è¿”å›ç”¨æˆ·ä¿¡æ¯")
RelIndex(5, api, web, "è¿”å›JWTä»¤ç‰Œ", "JSON")
RelIndex(6, web, user, "è·³è½¬åˆ°é¦–é¡µ")
@enduml
```

**æ³¨æ„**: `RelIndex` ä»…åœ¨ `!include <C4/C4_Dynamic>` å›¾è¡¨ä¸­å¯ç”¨,æ™®é€šå›¾è¡¨è¯·ä½¿ç”¨ `Rel` ç³»åˆ—ã€‚

### å¸ƒå±€å’Œæ ·å¼

#### å¸ƒå±€æ–¹å‘
```plantuml
LAYOUT_TOP_DOWN()           ' ä»ä¸Šåˆ°ä¸‹ï¼ˆé»˜è®¤æ–¹å‘ï¼‰
LAYOUT_LEFT_RIGHT()         ' ä»å·¦åˆ°å³
LAYOUT_LANDSCAPE()          ' æ¨ªå‘å¸ƒå±€
LAYOUT_WITH_LEGEND()        ' æ¨èï¼šè‡ªåŠ¨å¸ƒå±€ + åº•éƒ¨å›¾ä¾‹
```

#### ç²¾ç¡®å¸ƒå±€æ§åˆ¶

å½“è‡ªåŠ¨å¸ƒå±€ä¸æ»¡è¶³éœ€æ±‚æ—¶,å¯ä½¿ç”¨ä»¥ä¸‹å®è¿›è¡Œç²¾ç¡®æ§åˆ¶ï¼š

```plantuml
' å…ƒç´ ä½ç½®æ§åˆ¶
Lay_U(from, to)   ' from åœ¨ to ä¸Šæ–¹
Lay_D(from, to)   ' from åœ¨ to ä¸‹æ–¹
Lay_L(from, to)   ' from åœ¨ to å·¦ä¾§
Lay_R(from, to)   ' from åœ¨ to å³ä¾§

' è·ç¦»æ§åˆ¶
Lay_Distance(from, to, 2)  ' è®¾ç½®è·ç¦»ä¸º 2 ä¸ªå•ä½
```

**ä½¿ç”¨åœºæ™¯**: å½“è‡ªåŠ¨å¸ƒå±€ä¸æ»¡è¶³éœ€æ±‚æ—¶,ç”¨äºç²¾ç¡®æ§åˆ¶å…ƒç´ ä½ç½®å’Œé—´è·ã€‚

**ç¤ºä¾‹**:
```plantuml
@startuml
!include <C4/C4_Container>

Container(web, "Webåº”ç”¨", "React")
Container(api, "API", "Node.js")
Container(db, "æ•°æ®åº“", "PostgreSQL")

' å¼ºåˆ¶ web åœ¨ api å·¦ä¾§
Lay_L(web, api)
' å¼ºåˆ¶ db åœ¨ api ä¸‹æ–¹,è·ç¦» 2 å•ä½
Lay_D(api, db)
Lay_Distance(api, db, 2)
@enduml
```

#### æ˜¾ç¤ºå›¾ä¾‹
C4-PlantUML æä¾›ä¸¤ç§å›¾ä¾‹æ˜¾ç¤ºæ–¹å¼ï¼š

```plantuml
' æ–¹å¼ 1: åº•éƒ¨å›¾ä¾‹ï¼ˆå¢åŠ é¢å¤–ç©ºç™½ï¼‰
SHOW_LEGEND()               ' åœ¨åº•éƒ¨å³ä¾§æ˜¾ç¤ºå›¾ä¾‹

' æ–¹å¼ 2: æµ®åŠ¨å›¾ä¾‹ï¼ˆèŠ‚çœç©ºé—´ï¼Œæ¨èï¼‰
SHOW_FLOATING_LEGEND()      ' åœ¨ç»˜å›¾åŒºåŸŸå†…æ˜¾ç¤ºå›¾ä¾‹ï¼Œå¤ç”¨ç°æœ‰ç©ºç™½

' æ–¹å¼ 3: ç»„åˆå®ï¼ˆæ¨èï¼Œè‡ªåŠ¨åŒ…å«å›¾ä¾‹ï¼‰
LAYOUT_WITH_LEGEND()        ' è‡ªåŠ¨å¤„ç†å¸ƒå±€å’Œå›¾ä¾‹

' éšè—å›¾ä¾‹
HIDE_LEGEND()               ' ä¸æ˜¾ç¤ºå›¾ä¾‹
```

**æœ€ä½³å®è·µ**: ä½¿ç”¨ `LAYOUT_WITH_LEGEND()` æˆ– `SHOW_FLOATING_LEGEND()` ä»¥è·å¾—æ›´ç´§å‡‘çš„å¸ƒå±€ã€‚

### æ ·å¼å®šåˆ¶

C4-PlantUML æ”¯æŒé€šè¿‡ä¸»é¢˜å’Œ skinparam å®šåˆ¶å›¾è¡¨æ ·å¼ã€‚

#### é¢„å®šä¹‰ä¸»é¢˜

C4-PlantUML æä¾›å¤šç§å®˜æ–¹ä¸»é¢˜:

```plantuml
@startuml
!include <C4/C4_Container>

' åº”ç”¨ä¸»é¢˜ï¼ˆåœ¨å…ƒç´ å®šä¹‰ä¹‹å‰ï¼‰
!theme C4_blue        ' è“è‰²ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰
!theme C4_brown       ' æ£•è‰²ä¸»é¢˜
!theme C4_green       ' ç»¿è‰²ä¸»é¢˜
!theme C4_gray        ' ç°è‰²ä¸»é¢˜

LAYOUT_WITH_LEGEND()

Person(user, "ç”¨æˆ·")
Container(web, "Webåº”ç”¨", "React")
@enduml
```

**æ³¨æ„**: ä¸»é¢˜å¿…é¡»åœ¨ `!include` ä¹‹åã€å…ƒç´ å®šä¹‰ä¹‹å‰åº”ç”¨ã€‚

#### è‡ªå®šä¹‰é¢œè‰²

é€šè¿‡ `skinparam` å®šåˆ¶å…ƒç´ é¢œè‰²:

```plantuml
@startuml
!include <C4/C4_Container>

' å…¨å±€èƒŒæ™¯è‰²
skinparam backgroundColor #FEFEFE

' è¾¹ç•Œé¢œè‰²
skinparam rectangleBorderColor #2E4057
skinparam rectangleBackgroundColor #F0F4F7

' å…³ç³»ç®­å¤´
skinparam arrowColor #666666

Person(user, "ç”¨æˆ·")
System(app, "ç³»ç»Ÿ")
@enduml
```

#### è‡ªå®šä¹‰å­—ä½“

```plantuml
@startuml
!include <C4/C4_Container>

' è®¾ç½®å…¨å±€å­—ä½“
skinparam defaultFontName "Microsoft YaHei"
skinparam defaultFontSize 14

' è®¾ç½®æ ‡é¢˜å­—ä½“
skinparam titleFontSize 20
skinparam titleFontStyle bold

title ç³»ç»Ÿæ¶æ„å›¾
@enduml
```

#### å…ƒç´ çº§æ ·å¼å®šåˆ¶

ä½¿ç”¨ C4-PlantUML å®å®šåˆ¶ç‰¹å®šå…ƒç´ é¢œè‰²:

```plantuml
@startuml
!include <C4/C4_Container>

' ä½¿ç”¨å¸¦é¢œè‰²å‚æ•°çš„å®
AddElementTag("critical", $bgColor="#FF6B6B", $borderColor="#C92A2A")
AddElementTag("external", $bgColor="#E3F2FD", $borderColor="#1976D2")

Person(user, "ç”¨æˆ·")
Container(web, "Webåº”ç”¨", "React", $tags="critical")
System_Ext(payment, "æ”¯ä»˜ç³»ç»Ÿ", $tags="external")
@enduml
```

**å¸¸ç”¨æ ‡ç­¾å‚æ•°**:
- `$bgColor`: èƒŒæ™¯è‰²
- `$borderColor`: è¾¹æ¡†è‰²
- `$fontColor`: å­—ä½“é¢œè‰²

#### å…³ç³»æ ·å¼å®šåˆ¶

```plantuml
@startuml
!include <C4/C4_Container>

' å®šä¹‰å…³ç³»æ ‡ç­¾
AddRelTag("async", $lineColor="#FFA500", $lineStyle="DashedLine")
AddRelTag("sync", $lineColor="#2E7D32", $lineStyle="BoldLine")

Person(user, "ç”¨æˆ·")
Container(web, "Webåº”ç”¨", "React")
Container(queue, "æ¶ˆæ¯é˜Ÿåˆ—", "RabbitMQ")

Rel(user, web, "è®¿é—®", "HTTPS", $tags="sync")
Rel(web, queue, "å‘é€æ¶ˆæ¯", "AMQP", $tags="async")
@enduml
```

**å…³ç³»æ ·å¼å‚æ•°**:
- `$lineColor`: çº¿æ¡é¢œè‰²
- `$lineStyle`: çº¿æ¡æ ·å¼ (SolidLine, DashedLine, DottedLine, BoldLine)
- `$textColor`: æ ‡ç­¾æ–‡å­—é¢œè‰²

### Sprite å›¾æ ‡æ”¯æŒ

C4-PlantUML æ”¯æŒä¸ºå…ƒç´ æ·»åŠ å›¾æ ‡,å¢å¼ºè§†è§‰è¡¨è¾¾ã€‚

#### ä½¿ç”¨ PlantUML æ ‡å‡†åº“å›¾æ ‡

PlantUML æä¾›ä¸°å¯Œçš„å›¾æ ‡åº“ (AWS, Azure, GCP, Kubernetes ç­‰):

```plantuml
@startuml
!include <C4/C4_Container>
!include <aws/ApplicationServices/AmazonAPIGateway/AmazonAPIGateway>
!include <kubernetes/k8s-sprites-unlabeled-25pct>

LAYOUT_WITH_LEGEND()

Person(user, "ç”¨æˆ·")
Container(api, "APIç½‘å…³", "AWS API Gateway", $sprite="AmazonAPIGateway")
Container(k8s, "K8sé›†ç¾¤", "Kubernetes", $sprite="k8s")

Rel(user, api, "è®¿é—®")
Rel(api, k8s, "è·¯ç”±")
@enduml
```

**å¸¸ç”¨å›¾æ ‡åº“**:
- AWS: `!include <aws/...>`
- Azure: `!include <azure/...>`
- GCP: `!include <gcp/...>`
- Kubernetes: `!include <kubernetes/...>`
- Material Design: `!include <material/...>`

#### è‡ªå®šä¹‰ Sprite å›¾æ ‡

åˆ›å»ºè‡ªå®šä¹‰å•è‰² Sprite:

```plantuml
@startuml
!include <C4/C4_Container>

' å®šä¹‰è‡ªå®šä¹‰ sprite (16x16)
sprite $customIcon [16x16/16] {
0000000000000000
0001111111111000
0010000000001000
0010000110001000
0010001001001000
0010000110001000
0010000000001000
0001111111111000
0000000000000000
}

Container(app, "è‡ªå®šä¹‰åº”ç”¨", "æŠ€æœ¯æ ˆ", $sprite="customIcon")
@enduml
```

#### ä½¿ç”¨å›¾æ ‡ URL

ç›´æ¥ä½¿ç”¨åœ¨çº¿å›¾æ ‡:

```plantuml
@startuml
!include <C4/C4_Container>

!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/master

!includeurl ICONURL/devicons/react.puml
!includeurl ICONURL/devicons/nodejs.puml

Container(web, "å‰ç«¯åº”ç”¨", "React", $sprite="react")
Container(api, "åç«¯æœåŠ¡", "Node.js", $sprite="nodejs")
@enduml
```

**å›¾æ ‡èµ„æºåº“**:
- PlantUML Icon Font Sprites: https://github.com/tupadr3/plantuml-icon-font-sprites
- Font Awesome: DevIcons, FontAwesome, Material Design Icons

#### æœ€ä½³å®è·µ

**å›¾æ ‡ä½¿ç”¨åŸåˆ™**:
- ä»…ä¸ºå…³é”®æŠ€æœ¯ç»„ä»¶æ·»åŠ å›¾æ ‡
- é¿å…è¿‡åº¦ä½¿ç”¨å¯¼è‡´è§†è§‰æ··ä¹±
- å›¾æ ‡åº”ä¸æŠ€æœ¯æ ˆç›¸åŒ¹é…
- ä¼˜å…ˆä½¿ç”¨æ ‡å‡†åº“å›¾æ ‡ (æ— éœ€å¤–éƒ¨ä¾èµ–)

**ç¤ºä¾‹ - åˆç†ä½¿ç”¨å›¾æ ‡**:
```plantuml
@startuml
!include <C4/C4_Container>
!include <aws/Storage/AmazonS3/AmazonS3>
!include <aws/Database/AmazonRDS/AmazonRDS>

LAYOUT_WITH_LEGEND()

Person(user, "ç”¨æˆ·")
Container(web, "Webåº”ç”¨", "React")
Container(api, "APIæœåŠ¡", "Node.js")
ContainerDb(db, "æ•°æ®åº“", "PostgreSQL", $sprite="AmazonRDS")
ContainerDb(storage, "å¯¹è±¡å­˜å‚¨", "S3", $sprite="AmazonS3")

Rel(user, web, "è®¿é—®")
Rel(web, api, "è°ƒç”¨")
Rel(api, db, "è¯»å†™")
Rel(api, storage, "ä¸Šä¼ /ä¸‹è½½")
@enduml
```

## å‘½åè§„èŒƒ

### å…ƒç´ åˆ«åï¼ˆaliasï¼‰
- ä½¿ç”¨æœ‰æ„ä¹‰çš„è‹±æ–‡ç®€ç§°
- é‡‡ç”¨é©¼å³°å‘½åæ³•æˆ–ä¸‹åˆ’çº¿å‘½åæ³•
- ç¤ºä¾‹ï¼š`webApp`, `authService`, `order_db`

### æ˜¾ç¤ºåç§°
- ä½¿ç”¨æ¸…æ™°çš„ä¸­æ–‡æˆ–è‹±æ–‡æè¿°
- æ”¾åœ¨åŒå¼•å·ä¸­
- ç¤ºä¾‹ï¼š`"Web åº”ç”¨"`, `"è®¤è¯æœåŠ¡"`, `"è®¢å•æ•°æ®åº“"`

### æŠ€æœ¯æ ˆæ ‡æ³¨
- æ˜ç¡®æŒ‡å‡ºä½¿ç”¨çš„æŠ€æœ¯å’Œæ¡†æ¶
- ç¤ºä¾‹ï¼š`"React, Next.js"`, `"Node.js, Express"`, `"PostgreSQL"`

## C4 æ¨¡å‹æœ€ä½³å®è·µ

### 1. ä¿æŒå±‚æ¬¡ä¸€è‡´æ€§
- æ¯ä¸ªå›¾è¡¨åªèšç„¦ä¸€ä¸ªæŠ½è±¡å±‚æ¬¡
- **Context å›¾**ï¼šä¸åŒ…å« Container æˆ– Component ç»†èŠ‚
- **Container å›¾**ï¼šä¸æ·±å…¥åˆ°ç»„ä»¶çº§åˆ«
- **Component å›¾**ï¼šä¸å±•ç¤ºä»£ç å®ç°

### 2. æ˜ç¡®è¾¹ç•Œ
- ä½¿ç”¨ `System_Boundary` æˆ– `Container_Boundary` æ¸…æ™°åˆ’åˆ†ç³»ç»Ÿè¾¹ç•Œ
- è¾¹ç•Œå†…çš„å…ƒç´ å±äºåŒä¸€ä¸ªç³»ç»Ÿæˆ–å®¹å™¨

### 3. æŠ€æœ¯æ ‡æ³¨å®Œæ•´
- Container å’Œ Component å¿…é¡»åŒ…å«æŠ€æœ¯æ ˆä¿¡æ¯
- å…³ç³»æè¿°åº”åŒ…å«é€šä¿¡åè®®æˆ–æ ¼å¼
- ç¤ºä¾‹ï¼š`"REST/JSON"`, `"gRPC"`, `"SQL/JDBC"`

### 4. åˆç†ç²’åº¦
- Context å›¾ï¼š3-10 ä¸ªç³»ç»Ÿ
- Container å›¾ï¼š5-15 ä¸ªå®¹å™¨
- Component å›¾ï¼š5-20 ä¸ªç»„ä»¶
- è¿‡å¤šå…ƒç´ åº”è€ƒè™‘æ‹†åˆ†ä¸ºå¤šä¸ªå›¾è¡¨

## å¸¸è§é”™è¯¯

### âš ï¸ é”™è¯¯ 1: ç¼ºå°‘æˆ–ä¸å®Œæ•´çš„ include å£°æ˜ï¼ˆæœ€å¸¸è§ï¼ï¼‰
âŒ **é”™è¯¯å†™æ³• 1 - å®Œå…¨ç¼ºå°‘ include**ï¼š
```plantuml
@startuml
Person(user, "ç”¨æˆ·")
System(app, "åº”ç”¨")
@enduml
```

âŒ **é”™è¯¯å†™æ³• 2 - ä¸å®Œæ•´çš„ includeï¼ˆçœŸå®å¤±è´¥æ¡ˆä¾‹ï¼‰**ï¼š
```plantuml
@startuml
!include  <-- ç¼ºå°‘åº“æ–‡ä»¶è·¯å¾„ï¼Œå¯¼è‡´ "Error 400: cannot include"
Person(customer, "é¡¾å®¢")
System(ecommerce, "ç”µå•†ç³»ç»Ÿ")
@enduml
```

âœ… **æ­£ç¡®å†™æ³•**ï¼š
```plantuml
@startuml
' ä½¿ç”¨æ ‡å‡†åº“çŸ­æ ¼å¼ï¼ˆæ¨èï¼‰
!include <C4/C4_Container>

' æ¨èæ·»åŠ å¸ƒå±€å®
LAYOUT_WITH_LEGEND()

Person(user, "ç”¨æˆ·")
System(app, "åº”ç”¨")
@enduml
```

**åŸå› **ï¼šC4-PlantUML å…ƒç´ å®šä¹‰æ¥è‡ªäºå¤–éƒ¨åº“ï¼Œå¿…é¡»å…ˆ include æ‰èƒ½ä½¿ç”¨ã€‚`!include` åé¢**ç»å¯¹ä¸èƒ½ä¸ºç©º**ã€‚

### é”™è¯¯ 2: æ··ç”¨ä¸åŒæŠ½è±¡å±‚æ¬¡
âŒ **é”™è¯¯å†™æ³•**ï¼šåœ¨ Context å›¾ä¸­ä½¿ç”¨ Component
```plantuml
@startuml
!include <C4/C4_Container>

Person(user, "ç”¨æˆ·")
System(app, "åº”ç”¨")
Component(ctrl, "æ§åˆ¶å™¨", "Spring MVC")  ' é”™è¯¯ï¼šContextå›¾ä¸åº”æœ‰Component
@enduml
```

âœ… **æ­£ç¡®å†™æ³•**ï¼š
```plantuml
@startuml
!include <C4/C4_Container>

Person(user, "ç”¨æˆ·")
System(app, "åº”ç”¨ç³»ç»Ÿ")
System_Ext(payment, "æ”¯ä»˜ç³»ç»Ÿ")
@enduml
```

**åŸå› **ï¼šC4 æ¨¡å‹å¼ºè°ƒå±‚æ¬¡åˆ†ç¦»ï¼Œæ¯ä¸ªå›¾è¡¨åº”èšç„¦å•ä¸€æŠ½è±¡å±‚æ¬¡ã€‚

### é”™è¯¯ 3: å›¾ä¾‹ä½¿ç”¨ä¸å½“
âŒ **ä¸æ¨èçš„å†™æ³• - ä½¿ç”¨åº•éƒ¨å›¾ä¾‹å¢åŠ é¢å¤–ç©ºç™½**ï¼š
```plantuml
@startuml
!include <C4/C4_Context>

Person(customer, "é¡¾å®¢")
System(ecommerce, "ç”µå•†ç³»ç»Ÿ")

LAYOUT_TOP_DOWN()
SHOW_LEGEND()  <-- ä¼šåœ¨åº•éƒ¨å¢åŠ é¢å¤–ç©ºç™½
@enduml
```

âœ… **æ¨èå†™æ³• - ä½¿ç”¨æµ®åŠ¨å›¾ä¾‹èŠ‚çœç©ºé—´**ï¼š
```plantuml
@startuml
!include <C4/C4_Context>

' æ¨èæ–¹å¼ 1ï¼šä½¿ç”¨ç»„åˆå®
LAYOUT_WITH_LEGEND()

Person(customer, "é¡¾å®¢")
System(ecommerce, "ç”µå•†ç³»ç»Ÿ")
@enduml
```

âœ… **æ¨èå†™æ³• - æˆ–å•ç‹¬ä½¿ç”¨æµ®åŠ¨å›¾ä¾‹**ï¼š
```plantuml
@startuml
!include <C4/C4_Context>

LAYOUT_TOP_DOWN()
SHOW_FLOATING_LEGEND()  <-- æµ®åŠ¨å›¾ä¾‹ï¼Œå¤ç”¨ç°æœ‰ç©ºç™½

Person(customer, "é¡¾å®¢")
System(ecommerce, "ç”µå•†ç³»ç»Ÿ")
@enduml
```

**åŸå› **ï¼š`SHOW_FLOATING_LEGEND()` åœ¨ç»˜å›¾åŒºåŸŸå†…æ˜¾ç¤ºå›¾ä¾‹ï¼Œæ¯” `SHOW_LEGEND()` æ›´èŠ‚çœç©ºé—´ã€‚ä¸¤è€…éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æµ®åŠ¨å›¾ä¾‹æ›´æ¨èã€‚

### é”™è¯¯ 4: ç¼ºå°‘æŠ€æœ¯æ ˆæ ‡æ³¨
âŒ **é”™è¯¯å†™æ³•**ï¼š
```plantuml
Container(web, "Webåº”ç”¨")  ' ç¼ºå°‘æŠ€æœ¯æ ˆ
```

âœ… **æ­£ç¡®å†™æ³•**ï¼š
```plantuml
Container(web, "Webåº”ç”¨", "React, TypeScript", "å‰ç«¯åº”ç”¨")
```

**åŸå› **ï¼šC4 æ¨¡å‹çš„ Container å’Œ Component å±‚å¿…é¡»åŒ…å«æŠ€æœ¯æ ˆä¿¡æ¯ï¼Œè¿™æ˜¯å…¶æ ¸å¿ƒä»·å€¼ã€‚

### é”™è¯¯ 5: è¾¹ç•ŒåµŒå¥—è¿è§„
âŒ **é”™è¯¯å†™æ³• - åŒç±»è¾¹ç•ŒåµŒå¥—**ï¼š
```plantuml
@startuml
!include <C4/C4_Container>

System_Boundary(outer, "å¤–å±‚ç³»ç»Ÿ") {
    System_Boundary(inner, "å†…å±‚ç³»ç»Ÿ") {  ' é”™è¯¯ï¼šSystem_Boundary ä¸èƒ½åµŒå¥—
        Container(web, "Webåº”ç”¨", "React")
    }
}
@enduml
```

âŒ **é”™è¯¯å†™æ³• - è·¨å±‚åµŒå¥—**ï¼š
```plantuml
@startuml
!include <C4/C4_Component>

Container_Boundary(container, "å®¹å™¨") {
    System(sys, "ç³»ç»Ÿ")  ' é”™è¯¯ï¼šContainer_Boundary ä¸èƒ½åŒ…å« System
}
@enduml
```

âœ… **æ­£ç¡®å†™æ³•**ï¼š
```plantuml
@startuml
!include <C4/C4_Container>

' ä½¿ç”¨ Enterprise_Boundary åŒ…å«å¤šä¸ªç³»ç»Ÿ
Enterprise_Boundary(enterprise, "ä¼ä¸šè¾¹ç•Œ") {
    System_Boundary(system1, "ç³»ç»ŸA") {
        Container(web1, "Webåº”ç”¨", "React")
    }

    System_Boundary(system2, "ç³»ç»ŸB") {
        Container(api2, "APIæœåŠ¡", "Node.js")
    }
}
@enduml
```

**åŸå› **ï¼šC4-PlantUML ä¸¥æ ¼é™åˆ¶è¾¹ç•ŒåµŒå¥—è§„åˆ™,é˜²æ­¢å±‚æ¬¡æ··ä¹±ã€‚

### é”™è¯¯ 6: å›¾è¡¨ç±»å‹ä¸ include ä¸åŒ¹é…
âŒ **é”™è¯¯å†™æ³• - å›¾è¡¨ç±»å‹é”™è¯¯**ï¼š
```plantuml
@startuml
!include <C4/C4_Context>  ' Context åº“

' ä½¿ç”¨äº† Component å…ƒç´ ,ä½† include æ˜¯ Context
Component(ctrl, "æ§åˆ¶å™¨", "Spring MVC")
@enduml
```

âŒ **é”™è¯¯å†™æ³• - åŠ¨æ€å›¾æœªä½¿ç”¨ Dynamic åº“**ï¼š
```plantuml
@startuml
!include <C4/C4_Container>  ' é”™è¯¯ï¼šåº”ä½¿ç”¨ C4_Dynamic

RelIndex(1, user, web, "è®¿é—®")  ' RelIndex éœ€è¦ Dynamic åº“
@enduml
```

âœ… **æ­£ç¡®å†™æ³•**ï¼š
```plantuml
@startuml
!include <C4/C4_Dynamic>  ' æ­£ç¡®ï¼šä½¿ç”¨ Dynamic åº“

title ç™»å½•æµç¨‹åŠ¨æ€å›¾

Person(user, "ç”¨æˆ·")
Container(web, "Webåº”ç”¨", "React")

RelIndex(1, user, web, "è¾“å…¥è´¦å·å¯†ç ")
RelIndex(2, web, user, "æ˜¾ç¤ºé¦–é¡µ")
@enduml
```

**åŸå› **ï¼šä¸åŒ C4 å›¾è¡¨ç±»å‹éœ€è¦å¯¹åº”çš„åº“æ–‡ä»¶,å¦åˆ™ä¼šå¯¼è‡´å…ƒç´ æˆ–å®æ— æ³•è¯†åˆ«ã€‚

**å›¾è¡¨ç±»å‹ä¸ include å¯¹åº”å…³ç³»**:
| å›¾è¡¨ç±»å‹ | å¿…éœ€ include | å¯ç”¨å…ƒç´  |
|---------|-------------|---------|
| Context å›¾ | `<C4/C4_Context>` | Person, System, System_Ext, System_Boundary |
| Container å›¾ | `<C4/C4_Container>` | Person, System, Container, ContainerDb, ContainerQueue, System_Boundary, Container_Boundary |
| Component å›¾ | `<C4/C4_Component>` | Container, Component, ComponentDb, ComponentQueue, Container_Boundary |
| Dynamic å›¾ | `<C4/C4_Dynamic>` | Person, System, Container, Component + RelIndex |
| Deployment å›¾ | `<C4/C4_Deployment>` | Deployment_Node, Container, ContainerDb, ContainerQueue |

---

## âš ï¸ æ ¸å¿ƒæ£€æŸ¥æ¸…å•ï¼ˆæ¯æ¬¡ç”Ÿæˆä»£ç å‰å¿…æŸ¥ï¼ï¼‰

### âœ… å¿…é¡»åŒ…å«çš„å…ƒç´ ï¼ˆç¼ºä¸€ä¸å¯ï¼‰

1. **å®Œæ•´çš„ `@startuml` å’Œ `@enduml` åŒ…è£¹**
   ```plantuml
   @startuml
   ' ä»£ç ...
   @enduml
   ```

2. **å®Œæ•´çš„ C4 åº“å¼•ç”¨ï¼ˆæ ‡å‡†åº“çŸ­æ ¼å¼ï¼‰**
   ```plantuml
   !include <C4/C4_Context>
   ```
   âš ï¸ **æœ€å¸¸è§é”™è¯¯**: `!include` åé¢ä¸ºç©ºï¼Œå¯¼è‡´ "Error 400: cannot include"

3. **å¸ƒå±€å®ï¼ˆæ¨èä½¿ç”¨ï¼‰**
   ```plantuml
   LAYOUT_WITH_LEGEND()
   ```
   æˆ–åˆ†åˆ«æŒ‡å®š:
   ```plantuml
   LAYOUT_TOP_DOWN()
   SHOW_FLOATING_LEGEND()
   ```

### âœ… å®Œæ•´çš„æ­£ç¡®ç¤ºä¾‹æ¨¡æ¿

**Context å›¾æ ‡å‡†æ¨¡æ¿**:
```plantuml
@startuml
!include <C4/C4_Context>

LAYOUT_WITH_LEGEND()

title ç³»ç»Ÿä¸Šä¸‹æ–‡å›¾ - ç¤ºä¾‹ç³»ç»Ÿ

Person(user, "ç”¨æˆ·", "ç³»ç»Ÿä½¿ç”¨è€…")
System(mainSystem, "æ ¸å¿ƒç³»ç»Ÿ", "ä¸»è¦ä¸šåŠ¡åŠŸèƒ½")
System_Ext(externalSystem, "å¤–éƒ¨ç³»ç»Ÿ", "ç¬¬ä¸‰æ–¹æœåŠ¡")

Rel(user, mainSystem, "ä½¿ç”¨", "HTTPS")
Rel(mainSystem, externalSystem, "è°ƒç”¨", "API/JSON")
@enduml
```

**Container å›¾æ ‡å‡†æ¨¡æ¿**:
```plantuml
@startuml
!include <C4/C4_Container>

LAYOUT_WITH_LEGEND()

title å®¹å™¨æ¶æ„å›¾ - ç¤ºä¾‹ç³»ç»Ÿ

Person(user, "ç”¨æˆ·", "ç³»ç»Ÿä½¿ç”¨è€…")

System_Boundary(system, "ç³»ç»Ÿè¾¹ç•Œ") {
    Container(web, "Web åº”ç”¨", "React, TypeScript", "å‰ç«¯ç•Œé¢")
    Container(api, "API æœåŠ¡", "Node.js, Express", "åç«¯æ¥å£")
    ContainerDb(db, "æ•°æ®åº“", "PostgreSQL", "æŒä¹…åŒ–å­˜å‚¨")
}

Rel(user, web, "è®¿é—®", "HTTPS")
Rel(web, api, "è°ƒç”¨", "REST/JSON")
Rel(api, db, "è¯»å†™", "SQL/JDBC")
@enduml
```

### ğŸš« ç»å¯¹é¿å…çš„é”™è¯¯å†™æ³•

1. âŒ `!include` åé¢ä¸ºç©ºï¼ˆæœ€è‡´å‘½é”™è¯¯ï¼ï¼‰
2. âŒ ç¼ºå°‘ `@startuml` æˆ– `@enduml`
3. âŒ åœ¨ Context å›¾ä¸­æ··å…¥ Container/Component å…ƒç´ 
4. âŒ Container æˆ– Component ç¼ºå°‘æŠ€æœ¯æ ˆå‚æ•°
