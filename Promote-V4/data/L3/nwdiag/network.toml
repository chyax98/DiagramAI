# ============================================
# L3 类型层模板 v1.0.0
# NwDiag Network (网络拓扑图) 规范
# ============================================

[meta]
level = "L3"
language = "nwdiag"
diagram_type = "network"
version = "1.0.0"
description = "NwDiag 网络拓扑图规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选: 类型相关的元数据
complexity = "medium"
target_length = 2800
use_cases = ["企业三层网络架构", "DMZ 安全区域设计", "多数据中心互联拓扑", "网络分段规划"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "网络拓扑设计专家",
  "网络安全架构师"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **网段定义完整性**: 每个 `network` 必须定义名称和 `address` 网段地址范围。格式如 `address = "192.168.0.0/24"` 或 `address = "10.0.0.0/16"`。
  """,

  """
  **节点地址强制要求**: 所有节点都必须在某个 `network` 中定义 `address` 属性。节点可以同时出现在多个网段中（如防火墙、网关），但每个网段中都必须定义其地址。
  """,

  """
  **IP 地址与网段匹配**: 节点在某个 network 中定义的 `address` 必须属于该 network 的地址范围。例如 network address 为 "192.168.1.0/24" 时，节点地址必须在 192.168.1.x 范围内。
  """,

  """
  **跨网段设备定义**: 跨多个网段的设备（如防火墙、核心交换机）必须在每个相关 network 中都定义其对应的 IP 地址。这是 NwDiag 表达设备连接关系的核心机制。
  """,

  """
  **分组定义顺序**: 所有 `group` 定义必须放在所有 `network` 定义之后。在 network 定义之前使用 group 会导致渲染异常。
  """,

  """
  **节点命名规范**: 节点名称使用下划线 `_` 或驼峰命名法，禁止使用连字符 `-`。推荐使用语义化名称，如 `core_sw1`、`webServer01`、`db_master`。
  """,

  """
  **网络宽度优化**: 对于多网段复杂拓扑，可使用 `width = full;` 让网络跨越完整画布宽度，改善布局美观性。
  """,

  """
  **公网地址保护**: 公网地址使用占位符（如 "公网IP" 或 "未分配"），避免暴露真实公网地址。
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 分析网络架构需求**:
  - 识别网络分层结构（核心层、汇聚层、接入层）
  - 确定安全区域划分（外网、DMZ、内网、数据库网段）
  - 识别关键网络设备（防火墙、路由器、交换机）
  - 确定跨网段连接需求
  """,

  """
  **2. 规划网段和地址**:
  - 设计网段地址范围（私有地址段或公网地址段）
  - 规划每个网段的 IP 地址分配
  - 确定网关和关键设备的 IP 地址
  - 规划地址预留和扩展空间
  """,

  """
  **3. 设计节点和连接**:
  - 确定每个网段中的设备节点
  - 设计跨网段设备的多网段定义
  - 规划设备描述和属性（description、shape、color）
  - 设计逻辑分组（按功能、安全区域、物理位置）
  """,

  """
  **4. 实现 NwDiag 代码**:
  - 使用 `nwdiag {}` 包裹所有内容
  - 依次定义所有 network 块及其地址范围
  - 在每个 network 中定义节点及其 IP 地址
  - 在所有 network 定义之后添加 group 分组
  - 添加必要的描述和样式优化
  """,

  """
  **5. 验证和优化**:
  - 验证所有节点都有地址定义
  - 检查 IP 地址与网段匹配
  - 确认跨网段设备在所有相关 network 中都有定义
  - 检查分组逻辑清晰且位置正确
  - 优化布局和样式，提高可读性
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **网络拓扑完整性**:
  - 所有设备都在至少一个 network 中定义
  - 跨网段设备在所有相关 network 中都有地址
  - 网段地址范围设计合理，无冲突
  - 关键设备（防火墙、网关）的连接关系清晰
  """,

  """
  **IP 地址规范性**:
  - 所有 IP 地址符合 IPv4 或 IPv6 规范
  - 节点地址与所属网段地址范围匹配
  - 地址分配遵循网络规划最佳实践
  - 公网地址使用占位符保护
  """,

  """
  **分组和标注清晰**:
  - group 分组合理，反映逻辑分区（DMZ、内网、数据库等）
  - group 定义位置正确（在所有 network 之后）
  - 关键设备有 description 说明
  - 使用 color 区分不同安全区域或功能分区
  """,

  """
  **网络架构专业性**:
  - 网络分层符合三层架构或 DMZ 架构标准
  - 安全区域划分合理（外网、DMZ、内网分离）
  - 防火墙和安全设备位置正确
  - 网络拓扑符合企业网络设计最佳实践
  """
]

# ============================================
# Section 5: 使用场景 (Use Cases)
# ============================================

[[use_cases]]
title = "企业三层网络架构"
scenario = """
企业网络包含 DMZ 区域（Web 服务器）、内网区域（应用服务器）和数据库区域（数据库服务器）。
Web 服务器同时连接 DMZ 和内网，应用服务器连接内网和数据库网段。
需要清晰展示三层网络架构和设备连接关系。
"""
key_points = [
  "三个网段：DMZ (210.x.x.x/24)、内网 (172.16.0.0/24)、数据库 (172.16.1.0/24)",
  "Web 服务器同时在 DMZ 和内网中定义（双网卡）",
  "应用服务器连接内网和数据库网段",
  "使用 group 分组区分三个层次",
  "所有节点都有明确的 IP 地址定义"
]

[[use_cases]]
title = "DMZ 安全架构"
scenario = """
包含外网、DMZ、内网、数据库网段的安全架构。
外网通过防火墙连接 DMZ，DMZ 通过另一道防火墙连接内网。
需要展示多层防火墙架构和安全区域划分。
"""
key_points = [
  "四个网段：外网、DMZ、内网、数据库网段",
  "多层防火墙：外网防火墙、DMZ 防火墙、内网防火墙",
  "Web 服务器同时在 DMZ 和内网（前后端接口）",
  "使用 shape = 'cloud' 表示互联网",
  "使用 color 区分不同安全区域（DMZ=#FFE0B0, 内网=#E0FFE0, 数据库=#E0E0FF）"
]

[[use_cases]]
title = "双数据中心互联拓扑"
scenario = """
两个数据中心通过专线互联，每个数据中心有核心交换机、防火墙和服务器。
专线通过两端防火墙连接，需要展示数据中心互联和冗余架构。
"""
key_points = [
  "两个数据中心各自的核心网段（10.1.0.0/24 和 10.2.0.0/24）",
  "专线互联网段（192.168.0.0/30 点对点链路）",
  "防火墙同时连接核心网段和互联网段",
  "使用 group 和 color 区分两个数据中心",
  "使用 width = full 改善多网段布局"
]
