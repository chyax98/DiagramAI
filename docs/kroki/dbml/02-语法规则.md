# DBML è¯­æ³•è§„åˆ™è¯¦è§£

> **éªŒè¯æ—¶é—´**: 2025-10-13
> **å‚è€ƒæ¥æº**: https://dbml.dbdiagram.io/docs/

---

## ğŸ¯ æ ¸å¿ƒè¯­æ³•è§„åˆ™

### 1. å‘½åè§„åˆ™

#### 1.1 æ ‡è¯†ç¬¦å‘½å

```dbml
// âœ… æ¨è: ä½¿ç”¨è›‡å½¢å‘½å (snake_case)
Table user_profiles { ... }
Table order_items { ... }

// âœ… å¯é€‰: ä½¿ç”¨é©¼å³°å‘½å (camelCase)
Table userProfiles { ... }

// âœ… ç‰¹æ®Šå­—ç¬¦: ä½¿ç”¨åŒå¼•å·
Table "User Profiles" { ... }
Table "order-items" { ... }

// âŒ é¿å…: ä¿ç•™å…³é”®å­—ä½œä¸ºåç§° (é™¤éç”¨å¼•å·)
Table select { ... }  // ä¸æ¨è
Table "select" { ... } // å¯ä»¥
```

#### 1.2 Schema è§„åˆ™

```dbml
// é»˜è®¤ schema (public)
Table users { ... }
// ç­‰åŒäº
Table public.users { ... }

// æŒ‡å®š schema
Table core.users { ... }
Table v2.orders { ... }

// Enum ä¹Ÿæ”¯æŒ schema
enum public.job_status { ... }
enum v2.job_status { ... }
```

### 2. æ•°æ®ç±»å‹è§„åˆ™

#### 2.1 åŸºæœ¬ç±»å‹

```dbml
Table data_types {
  // æ•´æ•°
  id integer
  big_id bigint
  small_id smallint

  // æµ®ç‚¹æ•°
  price decimal(10,2)
  rating float
  score double

  // å­—ç¬¦ä¸²
  name varchar(100)
  description text
  code char(10)

  // æ—¥æœŸæ—¶é—´
  created_at timestamp
  birth_date date
  login_time time

  // å¸ƒå°”
  is_active boolean

  // JSON
  metadata json
  settings jsonb

  // å…¶ä»–
  file_data blob
  uuid_col uuid
}
```

#### 2.2 ç±»å‹è§„èŒƒ

**è§„åˆ™**:
- æ•°æ®ç±»å‹å¿…é¡»æ˜¯**å•ä¸ªå•è¯** (ç§»é™¤æ‰€æœ‰ç©ºæ ¼)
- å‚æ•°ç”¨æ‹¬å·åŒ…è£¹: `decimal(10,2)`, `varchar(255)`

```dbml
// âœ… æ­£ç¡®
column_a decimal(10,2)
column_b varchar(255)
column_c "bigint unsigned"  // ç‰¹æ®Šæƒ…å†µç”¨å¼•å·

// âŒ é”™è¯¯
column_d decimal (10, 2)    // ç©ºæ ¼é”™è¯¯
column_e big int            // åº”ä¸º bigint
```

### 3. åˆ—è®¾ç½®è§„åˆ™

#### 3.1 åŸºæœ¬è®¾ç½®

```dbml
Table users {
  // ä¸»é”®
  id integer [pk]
  id2 integer [primary key]  // ç­‰åŒäº pk

  // å”¯ä¸€çº¦æŸ
  email varchar [unique]

  // éç©ºçº¦æŸ
  username varchar [not null]
  password varchar [null]  // é»˜è®¤å¯ç©º

  // è‡ªå¢
  auto_id integer [increment]

  // ç»„åˆè®¾ç½®
  created_at timestamp [not null, default: `now()`]
}
```

#### 3.2 é»˜è®¤å€¼è§„åˆ™

```dbml
Table defaults {
  // æ•°å­— (ä¸å¸¦å¼•å·)
  count integer [default: 0]
  price decimal(10,2) [default: 99.99]

  // å­—ç¬¦ä¸² (å•å¼•å·)
  status varchar [default: 'active']
  source varchar [default: 'direct']

  // å¸ƒå°”å€¼
  is_enabled boolean [default: true]
  is_deleted boolean [default: false]
  is_null boolean [default: null]

  // è¡¨è¾¾å¼ (åå¼•å·)
  created_at timestamp [default: `now()`]
  expires_at timestamp [default: `now() + interval '1 day'`]
  computed integer [default: `id * 2`]
}
```

**é‡è¦**:
- æ•°å­—: ç›´æ¥å†™æ•°å­—
- å­—ç¬¦ä¸²: ç”¨å•å¼•å· `'string'`
- è¡¨è¾¾å¼: ç”¨åå¼•å· `` `expression` ``
- å¸ƒå°”: `true`, `false`, `null`

#### 3.3 æ³¨é‡Šè§„åˆ™

```dbml
Table comments {
  // å•è¡Œæ³¨é‡Š
  status varchar [note: 'User status']

  // å¤šè¡Œæ³¨é‡Š
  description text [note: '''
    This is a multi-line note
    It can span multiple lines
  ''']

  // åŒ…å«ç‰¹æ®Šå­—ç¬¦
  emoji_status varchar [note: 'ğŸ’¸ 1=processing, âœ”ï¸ 2=shipped']
}
```

### 4. ç´¢å¼•è§„åˆ™

#### 4.1 å•åˆ—ç´¢å¼•

```dbml
Table users {
  id integer
  email varchar
  created_at timestamp

  indexes {
    id [pk]                              // ä¸»é”®ç´¢å¼•
    email [unique]                       // å”¯ä¸€ç´¢å¼•
    created_at                           // æ™®é€šç´¢å¼•
    created_at [name: 'idx_created']     // å‘½åç´¢å¼•
    email [type: hash]                   // æŒ‡å®šç±»å‹
  }
}
```

#### 4.2 å¤åˆç´¢å¼•

```dbml
Table orders {
  id integer
  user_id integer
  status varchar
  created_at timestamp

  indexes {
    (id, user_id) [pk]                   // å¤åˆä¸»é”®
    (user_id, created_at)                // å¤åˆç´¢å¼•
    (user_id, status) [unique]           // å¤åˆå”¯ä¸€ç´¢å¼•
  }
}
```

#### 4.3 è¡¨è¾¾å¼ç´¢å¼•

```dbml
Table advanced_indexes {
  id integer
  name varchar

  indexes {
    (`id * 2`)                           // ç®€å•è¡¨è¾¾å¼
    (`lower(name)`)                      // å‡½æ•°è¡¨è¾¾å¼
    (`id * 3`, `getdate()`)              // å¤šä¸ªè¡¨è¾¾å¼
    (`id * 3`, id)                       // è¡¨è¾¾å¼ + åˆ—
  }
}
```

#### 4.4 ç´¢å¼•è®¾ç½®

```dbml
indexes {
  email [
    name: 'idx_email',        // ç´¢å¼•åç§°
    type: hash,               // ç±»å‹: btree, hash, gin, gist
    unique,                   // å”¯ä¸€çº¦æŸ
    note: 'Email index'       // æ³¨é‡Š
  ]
}
```

### 5. å…³ç³»è§„åˆ™

#### 5.1 å…³ç³»ç¬¦å·

| ç¬¦å· | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `<` | one-to-many | å·¦è¡¨ 1 : å³è¡¨ N | `users.id < posts.user_id` |
| `>` | many-to-one | å·¦è¡¨ N : å³è¡¨ 1 | `posts.user_id > users.id` |
| `-` | one-to-one | å·¦è¡¨ 1 : å³è¡¨ 1 | `users.id - profiles.user_id` |
| `<>` | many-to-many | å·¦è¡¨ N : å³è¡¨ N | `authors.id <> books.id` |

#### 5.2 å…³ç³»è¯­æ³•

```dbml
// 1. å†…è”å½¢å¼ (Inline)
Table posts {
  user_id integer [ref: > users.id]
}

// 2. çŸ­æ ¼å¼ (Short form)
Ref: posts.user_id > users.id

// 3. é•¿æ ¼å¼ (Long form)
Ref post_user {
  posts.user_id > users.id
}

// 4. å¸¦è®¾ç½®
Ref: posts.user_id > users.id [
  delete: cascade,
  update: no action,
  color: #79AD51
]
```

#### 5.3 å¤åˆå¤–é”®

```dbml
// å¤åˆå¤–é”®
Ref: order_items.(order_id, product_id) > orders.(id, store_id)

// è·¨ schema å…³ç³»
Ref: blogging.posts.user_id > core.users.id
```

#### 5.4 å…³ç³»è®¾ç½®

```dbml
Ref: products.merchant_id > merchants.id [
  delete: cascade | restrict | set null | set default | no action,
  update: cascade | restrict | set null | set default | no action,
  color: #79AD51
]
```

#### 5.5 Zero-to-One/Many å…³ç³»

```dbml
Table follows {
  // many-to-zero (å¯ç©ºå¤–é”®)
  following_user_id int [ref: > users.id, null]

  // many-to-one (éç©ºå¤–é”®)
  followed_user_id int [ref: > users.id, not null]
}
```

#### 5.6 One-to-One è§„åˆ™

**é‡è¦**: åœ¨ one-to-one å…³ç³»ä¸­ï¼Œåˆ—çš„é¡ºåºå†³å®šå¤–é”®ä½ç½®

```dbml
// Long/Short form: ç¬¬äºŒåˆ—æ˜¯å¤–é”®
users.id - user_infos.user_id  // user_infos.user_id æ˜¯å¤–é”®

// Inline form: æœ‰ ref çš„åˆ—æ˜¯å¤–é”®
Table user_infos {
  user_id integer [ref: - users.id]  // user_id æ˜¯å¤–é”®
}
```

### 6. æšä¸¾è§„åˆ™

```dbml
// åŸºæœ¬æšä¸¾
enum status {
  active
  inactive
  suspended
}

// å¸¦æ³¨é‡Š
enum order_status {
  pending [note: 'Order placed']
  processing [note: 'Being processed']
  shipped
  delivered
}

// åŒ…å«ç‰¹æ®Šå­—ç¬¦ (ç”¨åŒå¼•å·)
enum grade {
  "A+"
  "A"
  "A-"
  "Not Yet Set"
}

// æŒ‡å®š schema
enum v2.status {
  active
  inactive
}

// ä½¿ç”¨æšä¸¾
Table orders {
  status order_status
  grade v2.grade
}
```

### 7. è¡¨æ¨¡æ¿è§„åˆ™ (TablePartial)

```dbml
// å®šä¹‰æ¨¡æ¿
TablePartial base_template [headerColor: #ff0000] {
  id int [pk, not null]
  created_at timestamp [default: `now()`]

  indexes {
    created_at
  }
}

TablePartial soft_delete {
  deleted_at timestamp
  deleted_by integer
}

// ä½¿ç”¨æ¨¡æ¿ (~ å‰ç¼€)
Table users {
  ~base_template        // æ³¨å…¥ base_template
  username varchar
  email varchar
  ~soft_delete          // æ³¨å…¥ soft_delete
}

// å†²çªè§£å†³ä¼˜å…ˆçº§:
// 1. æœ¬åœ°è¡¨å®šä¹‰ (æœ€é«˜)
// 2. æœ€åæ³¨å…¥çš„æ¨¡æ¿
// 3. å…ˆæ³¨å…¥çš„æ¨¡æ¿
```

### 8. æ³¨é‡Šå’Œå­—ç¬¦ä¸²è§„åˆ™

#### 8.1 å•è¡Œæ³¨é‡Š

```dbml
// è¿™æ˜¯å•è¡Œæ³¨é‡Š
Table users { ... }  // è¡Œå°¾æ³¨é‡Š
```

#### 8.2 å¤šè¡Œæ³¨é‡Š

```dbml
/*
  è¿™æ˜¯å¤šè¡Œæ³¨é‡Š
  å¯ä»¥è·¨è¶Šå¤šè¡Œ
*/
Table users { ... }
```

#### 8.3 å¤šè¡Œå­—ç¬¦ä¸²

```dbml
Note: '''
  è¿™æ˜¯å¤šè¡Œå­—ç¬¦ä¸²
  - æ¢è¡Œ: ç›´æ¥æŒ‰ Enter
  - ç»­è¡Œ: ä½¿ç”¨ \
  - è½¬ä¹‰:
    - \\ ä»£è¡¨ \
    - \' ä»£è¡¨ '
'''

// è‡ªåŠ¨å»é™¤ç¼©è¿›
Note: '''
  Line 1
    Line 2 (ç¼©è¿›)
  Line 3
'''
// è¾“å‡º:
// Line 1
//   Line 2 (ç¼©è¿›)
// Line 3
```

### 9. è¡¨åˆ†ç»„è§„åˆ™ (TableGroup)

```dbml
// åŸºæœ¬åˆ†ç»„
TableGroup e_commerce {
  merchants
  countries
  products
}

// å¸¦è®¾ç½®
TableGroup core [color: #345, note: 'Core tables'] {
  users
  roles
  permissions
}

// è·¨ schema
TableGroup mixed {
  core.users
  blogging.posts
  public.comments
}
```

### 10. Sticky Notes è§„åˆ™

```dbml
// å•è¡Œä¾¿ç­¾
Note reminder {
  'Remember to add indexes'
}

// å¤šè¡Œä¾¿ç­¾
Note architecture {'''
  ## Database Architecture

  - Users: Core user data
  - Orders: Transaction records
  - Products: Inventory management
'''}
```

### 11. ç‰¹æ®Šè§„åˆ™

#### 11.1 ä¿ç•™åç§°å¤„ç†

```dbml
Table users {
  // "id" å’Œ "url" æ˜¯ä¿ç•™åç§°ï¼Œéœ€è¦å‰ç¼€
  "userDefined:id" integer
  "userDefined:url" varchar

  // æˆ–è€…ç”¨å…¶ä»–åç§°
  user_id integer
  profile_url varchar
}
```

#### 11.2 Schema ä¼˜å…ˆçº§

```dbml
// æ˜¾å¼ schema
Table core.users { ... }           // ä½¿ç”¨ core schema

// é»˜è®¤ public
Table users { ... }                // ä½¿ç”¨ public schema
Enum status { ... }                // ä½¿ç”¨ public schema
```

#### 11.3 è¡¨åˆ«å

```dbml
Table very_long_user_table as U {
  id integer [pk]
}

// åœ¨å…³ç³»ä¸­ä½¿ç”¨åˆ«å
Ref: U.id < posts.user_id
```

---

## ğŸ“‹ è¯­æ³•æ£€æŸ¥æ¸…å•

### âœ… å¿…é¡»éµå®ˆ

- [ ] æ‰€æœ‰åˆ—ç±»å‹ä¸ºå•ä¸ªå•è¯ (ç§»é™¤ç©ºæ ¼)
- [ ] å­—ç¬¦ä¸²å€¼ç”¨å•å¼•å· `'string'`
- [ ] è¡¨è¾¾å¼ç”¨åå¼•å· `` `expression` ``
- [ ] å˜é‡åå¼•ç”¨ç”¨åŒå¼•å· `"column name"`
- [ ] å¤šè¡Œå­—ç¬¦ä¸²ç”¨ä¸‰å•å¼•å· `'''...'''`
- [ ] è®¾ç½®ç”¨æ–¹æ‹¬å· `[setting]`
- [ ] åˆ†ç»„ç”¨èŠ±æ‹¬å· `{...}`

### âœ… æ¨èåšæ³•

- [ ] ä½¿ç”¨ snake_case å‘½å
- [ ] ä¸ºå…³é”®åˆ—æ·»åŠ æ³¨é‡Š
- [ ] ä½¿ç”¨ TablePartial å‡å°‘é‡å¤
- [ ] ä¸ºå¤æ‚å…³ç³»æ·»åŠ åç§°
- [ ] ä½¿ç”¨ TableGroup ç»„ç»‡è¡¨
- [ ] æ·»åŠ é¡¹ç›®çº§åˆ« Note

### âŒ å¸¸è§é”™è¯¯

- [ ] æ•°æ®ç±»å‹åŒ…å«ç©ºæ ¼: `big int` â†’ `bigint`
- [ ] é»˜è®¤å€¼å¼•å·é”™è¯¯: `[default: "string"]` â†’ `[default: 'string']`
- [ ] è¡¨è¾¾å¼å¼•å·é”™è¯¯: `[default: 'now()']` â†’ ``[default: `now()`]``
- [ ] å¿˜è®° one-to-one å¤–é”®é¡ºåº
- [ ] ä½¿ç”¨ä¿ç•™åç§°æœªåŠ å‰ç¼€

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨ dbdiagram.io éªŒè¯

```
1. è®¿é—® https://dbdiagram.io
2. ç²˜è´´ DBML ä»£ç 
3. æŸ¥çœ‹è¯­æ³•é”™è¯¯æç¤º
4. å®æ—¶é¢„è§ˆå›¾è¡¨
```

### 2. ä½¿ç”¨ DBML CLI éªŒè¯

```bash
# å®‰è£…
npm install -g @dbml/cli

# éªŒè¯è¯­æ³•
dbml2sql schema.dbml --postgres

# å¦‚æœæœ‰é”™è¯¯ä¼šæ˜¾ç¤ºå…·ä½“ä½ç½®
```

### 3. ä½¿ç”¨ VSCode æ’ä»¶

```
1. å®‰è£… "dbml-language" æ’ä»¶
2. æ‰“å¼€ .dbml æ–‡ä»¶
3. è·å¾—è¯­æ³•é«˜äº®å’Œé”™è¯¯æç¤º
```

---

**æ–‡æ¡£æ›´æ–°**: 2025-10-13
**å‚è€ƒæ¥æº**: DBML å®˜æ–¹è¯­æ³•æ–‡æ¡£ (https://dbml.dbdiagram.io/docs/)
