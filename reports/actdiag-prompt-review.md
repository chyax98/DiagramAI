# ActDiag Prompt 系统审查报告

**语言**: ActDiag
**文件位置**: `/root/Diagram/DiagramAI/src/lib/constants/prompts/actdiag/`
**审查日期**: 2025-10-13
**审查范围**: L2 (common.txt) + L3 (activity.txt, swimlane.txt)

---

## 📊 文件清单

| 文件 | 类型 | 行数 | 功能 |
|------|------|------|------|
| `common.txt` | L2 通用规范 | 187 行 | ActDiag 语法基础 |
| `activity.txt` | L3 图表类型 | 247 行 | 活动图 (并行活动流程) |
| `swimlane.txt` | L3 图表类型 | 298 行 | 泳道图 (多角色协作) |

**总计**: 732 行

---

## ✅ 优点分析

### 1. L2 通用规范突出泳道特性

**强制规则清晰**:
- ✅ 规则 1: `actdiag {}` 图表声明
- ✅ 规则 2: 属性语法 `[属性名 = "值"]`
- ✅ 规则 3: **泳道定义必须使用 `lane` 关键字** - ActDiag 特有
- ✅ 规则 4: 中文标签引号

**核心语法完整**:
- 图表声明、泳道定义、活动定义
- 泳道语法清晰: `lane user { label = "用户"; login -> browse; }`

---

### 2. L3 文件类型区分明确

**activity.txt (并行活动流程)**:
- ✅ 强调并行活动: 从同一起点分叉,最终汇聚
- ✅ 3 个示例: 软件发布、敏捷开发、数据处理管道
- ✅ 示例质量高: 并行分支清晰,汇聚点明确

**swimlane.txt (多角色协作)**:
- ✅ 强调跨角色交互: 不同 `lane` 之间的消息传递
- ✅ 3 个示例: 在线购物、请假审批、微服务注册
- ✅ 示例 2 (请假审批) 非常实用: 五个泳道,展示完整审批流程

**类型区分清晰度**: 10/10 - Activity 和 Swimlane 的差异在开头明确说明

---

## ⚠️ 问题与改进建议

### 问题 1: Activity 和 Swimlane 的差异说明不够

**当前问题**:
- `activity.txt` 说明: "强调活动的时间顺序和并行关系"
- `swimlane.txt` 说明: "强调不同角色或系统之间的交互"
- 但两者都可以展示并行活动,差异不够明确

**改进建议**:
```markdown
## 在 activity.txt 开头添加
> **Activity vs Swimlane 的核心区别**
> - **Activity**: 聚焦活动本身的并行和串行关系,不区分角色
>   - 适用场景: 单一系统内的流程,如 CI/CD 管道、数据处理流程
>   - 不使用 `lane` 关键字
> - **Swimlane**: 聚焦不同角色/系统的职责划分和交互
>   - 适用场景: 跨部门流程、前后端交互、多微服务协作
>   - 必须使用 `lane` 关键字

## 在 swimlane.txt 开头添加
> **何时使用 Swimlane 而非 Activity**
> - 流程涉及 3+ 个独立角色/系统
> - 需要明确展示职责划分
> - 跨泳道交互是关键信息
```

---

### 问题 2: L2 与 L3 存在语法重复

**重复内容**:
- L2 第 132-175 行: 定义泳道语法和活动定义
- L3 (activity.txt) 第 11-45 行: 再次定义基础活动图语法
- L3 (swimlane.txt) 第 11-39 行: 再次定义泳道语法

**问题严重性**: 🟡 中等

**改进建议**:
- L2 保留通用规则 (强制规则 + 专家视角)
- L3 删除基础语法,仅保留特异性语法
  - activity.txt: 强调并行分支和汇聚点
  - swimlane.txt: 强调跨泳道连接和职责划分

---

### 问题 3: Swimlane 示例中的跨泳道连接语法不够清晰

**问题位置**: `swimlane.txt` 第 233-264 行 (常见错误 1)

**当前说明**:
```markdown
### 错误 1: 跨泳道连接在泳道内定义
**❌ 错误写法**：
```actdiag
lane user {
  login -> validate;  // validate 在另一个泳道中
}
```

**✅ 正确写法**：
```actdiag
lane user {
  login [label = "登录"];
}
lane system {
  validate [label = "验证"];
}
login -> validate;  // 跨泳道连接在泳道外定义
```
```

**问题**: 说明不够详细,未解释为什么必须在泳道外定义

**改进建议**:
```markdown
**原因**:
- 泳道内的连接 (`A -> B`) 表示同一角色的活动顺序
- 跨泳道的连接 (`login -> validate`) 表示角色间的交互消息
- 如果在泳道内定义跨泳道连接,会导致语法歧义: 不清楚 `validate` 属于哪个泳道
```

---

### 问题 4: 缺少嵌套泳道的说明

**发现**: ActDiag 是否支持嵌套泳道 (`lane { lane { } }`) ?

**当前文件**: 未提及嵌套泳道语法

**改进建议**:
- 如果 ActDiag 支持嵌套泳道,应在 L2 或 L3 中说明
- 如果不支持,应在 L2 中明确说明: "ActDiag 不支持嵌套泳道,只能定义单层 `lane`"

---

## 📈 量化评分

| 评估维度 | 得分 | 说明 |
|---------|------|------|
| **L2 覆盖度** | 9/10 | 规则完整,泳道特性突出 |
| **L3 示例质量** | 9/10 | 示例实用,涵盖真实场景 |
| **错误预防** | 8/10 | 常见错误覆盖,但跨泳道连接说明不够详细 |
| **内容去重** | 7/10 | L2 与 L3 存在部分重复 |
| **类型特异性** | 8/10 | Activity 和 Swimlane 区分较清晰 |
| **可维护性** | 8/10 | 结构清晰,但缺少嵌套泳道说明 |
| **总体评分** | **8.2/10** | 优秀,但有改进空间 |

---

## 🎯 优先改进建议

### 高优先级 (P0)
1. **在两个 L3 文件开头添加 Activity vs Swimlane 区别说明** - 增强类型区分
2. **删除 L3 中的语法重复内容** - 减少 Prompt 长度

### 中优先级 (P1)
3. **详细解释跨泳道连接的语法原理** - 防止常见错误
4. **明确是否支持嵌套泳道** - 避免用户尝试不支持的语法

---

## 📝 总结

**ActDiag Prompt 系统整体质量优秀**,L2 和 L3 结构清晰,示例实用。**Activity 和 Swimlane 的类型区分较清晰**,但可以进一步增强。主要问题是 **L2 与 L3 存在语法重复** 和 **跨泳道连接语法说明不够详细**。

**建议优先在两个 L3 文件开头添加类型区别说明**,并删除重复的基础语法内容。
