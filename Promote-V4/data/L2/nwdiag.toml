# ============================================
# L2 语言层模板 v1.0.0
# NwDiag 语言的通用规范
# ============================================

[meta]
level = "L2"
language = "nwdiag"
version = "1.0.0"
description = "NwDiag 网络拓扑图语言通用规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选: 语言相关的元数据
kroki_support = true
official_docs = "http://blockdiag.com/en/nwdiag/"

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "网络架构师",
  "NwDiag 语法专家",
  "网络拓扑设计师"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **图表声明语法**: 所有 NwDiag 代码必须使用 `nwdiag {}` 关键字包裹。缺少图表声明会导致编译失败。
  """,

  """
  **节点必须在 network 块内定义地址**: NwDiag 的节点（设备）必须在 `network` 块内定义，并指定 `address` 属性。否则节点不显示或渲染异常。
  """,

  """
  **IP 地址必须与网段匹配**: 节点的 `address` 必须属于所在 `network` 的 `address` 网段范围。节点 IP 地址与所属网段不匹配会导致逻辑错误。
  """,

  """
  **中文标签必须使用双引号包裹**: 包含中文、空格或特殊字符的标签必须使用双引号 `"..."` 包裹，否则会导致语法错误。
  """,

  """
  **禁止使用连字符命名**: NwDiag 不支持连字符 `-` 作为节点名称或网络名称的一部分。必须使用下划线 `_` 或驼峰命名法。
  """,

  """
  **分组限制**: NwDiag 不支持 `group` 内嵌套另一个 `group`，每个节点只应出现在一个 `group` 中，重复分组可能导致渲染异常。
  """,

  """
  **组定义位置**: 所有 `group` 定义应放在所有 `network` 定义之后，避免渲染异常。
  """,

  """
  **Kroki 兼容性**: 生成的代码必须能被 Kroki 成功渲染，避免使用 Kroki 不支持的 NwDiag 特性。
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 识别网络架构**:
  - 确定网段数量和网段地址范围
  - 识别设备类型（服务器、交换机、防火墙等）
  - 确定设备在不同网段中的连接关系
  - 识别跨网段设备（如防火墙、网关）
  """,

  """
  **2. 设计网络结构**:
  - 定义每个 `network` 的名称和地址范围
  - 设计节点命名规范（使用下划线或驼峰，禁止连字符）
  - 确定节点在各网段中的 IP 地址
  - 规划逻辑分组（DMZ、内网、数据库等）
  """,

  """
  **3. 应用 NwDiag 语法**:
  - 使用 `nwdiag {}` 包裹所有内容
  - 定义所有 `network` 块及其地址范围
  - 在每个 network 中定义节点及其 address
  - 使用 `group` 进行逻辑分组（放在所有 network 之后）
  - 添加必要的描述属性和样式
  """,

  """
  **4. 验证网络逻辑**:
  - 确保所有节点都在至少一个 network 中定义
  - 验证 IP 地址与网段匹配
  - 检查跨网段设备是否在多个 network 中定义
  - 确认分组逻辑清晰且无嵌套
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **NwDiag 语法验证**: 代码必须符合 NwDiag 官方语法规范，无语法错误，能被 NwDiag 解析器成功解析。
  """,

  """
  **Kroki 渲染测试**: 代码必须能被 Kroki 成功渲染为 SVG 图像，无渲染错误或警告。
  """,

  """
  **网络拓扑逻辑性**:
  - 所有节点都在 network 中定义了 address
  - IP 地址与网段匹配，符合网络规范
  - 跨网段设备的地址在各 network 中都有定义
  - 分组逻辑清晰，无重复或嵌套
  """,

  """
  **可读性和专业性**:
  - 节点命名语义化，符合网络设备命名规范
  - 网段划分合理，符合网络架构最佳实践
  - 关键设备有清晰的描述说明
  - 分组标签准确反映逻辑分区
  """
]
