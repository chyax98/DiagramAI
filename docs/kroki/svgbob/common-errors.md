# SvgBob 常见错误和解决方案

> **渲染引擎**: SvgBob
> **文档类型**: 故障排查指南

---

## ⚠️ 字符对齐问题

### 错误 1: 边框不对齐

**症状**: 矩形或形状显示不完整或变形

```
错误示例:
+---+
 |   |    <- 左边界缩进
+---+

或:
+---+
|   |
 +---+    <- 底部边界缩进
```

**原因**:
- 使用了非等宽字体
- 复制粘贴时丢失了空格
- 手动编辑时对齐错误

**解决方案**:
```
正确示例:
+---+
|   |
+---+

检查清单:
✓ 使用等宽字体（Courier, Consolas, Monaco）
✓ 垂直对齐所有边框字符
✓ 使用编辑器的标尺功能辅助对齐
```

---

### 错误 2: 连接点错位

**症状**: 线条没有正确连接，出现断裂

```
错误示例:
A----+
      |    <- 竖线与横线不在同一列
     B

或:
A----
     +    <- 连接点没有与线条对齐
     |
     B
```

**解决方案**:
```
正确示例:
A----+
     |
     B

技巧:
1. 使用编辑器的列选择模式
2. 启用"显示空白字符"功能
3. 使用标尺/网格辅助
```

---

## 🔤 字符识别问题

### 错误 3: 箭头方向错误

**症状**: 箭头指向与预期相反或不显示

```
错误示例:
A >--- B   <- 箭头头部位置错误

A ---> B
B <--- A   <- 可能引起混淆
```

**原因**:
- 箭头头部 (`>`, `<`, `v`, `^`) 位置不正确
- 箭头与线条没有紧密连接

**解决方案**:
```
正确示例:
A ---> B   (A 指向 B)
A <--- B   (B 指向 A)
B ---> A   (B 指向 A，更清晰)

双向箭头:
A <--> B

检查:
✓ 箭头头部紧邻线条
✓ 没有额外空格
✓ 方向符合逻辑流程
```

---

### 错误 4: 圆形/椭圆变形

**症状**: 圆形显示为不规则形状

```
错误示例:
  __
 /  \     <- 宽高比例不当
 \__/

或:
 ___
/   \
|   |     <- 混用了不同的弧线字符
 \__/
```

**解决方案**:
```
标准圆形模板:
   ___        小圆
  /   \
 |     |
  \___/

  .---.       中圆（圆角风格）
 (     )
  '---'

   _____      大圆
  /     \
 |       |
  \_____/

技巧:
1. 保持对称性
2. 使用一致的字符风格
3. 调整宽高比（通常高度是宽度的一半）
```

---

## 📐 形状识别问题

### 错误 5: 矩形未被识别

**症状**: 预期的矩形显示为独立的线条

```
错误示例:
+--     <- 右上角缺失
|  |
+--+

或:
+---+
|   |    <- 底部边框字符不匹配
'---'
```

**解决方案**:
```
正确示例:
+---+    或   .---.
|   |         |   |
+---+         '---'

规则:
✓ 四个角必须完整
✓ 边框字符必须一致（全用 + 或全用 . '）
✓ 边必须闭合
```

---

### 错误 6: 线条交叉识别错误

**症状**: 交叉点显示不正确或缺失

```
错误示例:
  |
--+--    <- 期望交叉，但可能不显示
  |

或:
  |
----     <- 缺少交叉点符号
  |
```

**解决方案**:
```
明确的交叉点:
  |
--+--
  |

使用 * 表示节点:
  |
--*--
  |

多路交叉:
  |
--+--
 /|\
```

---

## 🎨 样式和渲染问题

### 错误 7: 样式未生效

**症状**: 定义的 CSS 样式没有应用到形状

```
错误示例:
+------+
| {r1} |
+------+

r1 = {          <- 样式定义位置错误（应在代码块外）
    fill: red;
}
```

**原因**:
- 样式定义位置错误
- 标签名称拼写错误
- CSS 语法错误

**解决方案**:
```
正确示例:
+------+
| {r1} |
+------+

# 样式定义（在代码块外或文档末尾）
r1 = {
    fill: papayawhip;
    stroke: crimson;
}

检查清单:
✓ 标签名称完全匹配（区分大小写）
✓ CSS 语法正确（分号、冒号）
✓ 颜色值有效
```

---

### 错误 8: 文本覆盖图形

**症状**: 文本与图形字符冲突

```
错误示例:
+Text+    <- "T" 与 "+" 冲突
|Box |
+----+
```

**解决方案**:
```
正确示例:
+------+
| Text |
+------+

或使用更大的边框:
+---------+
|  Text   |
+---------+

技巧:
1. 文本两侧留空格
2. 边框要足够大
3. 避免文本与边框字符重叠
```

---

## 🔄 复杂图表问题

### 错误 9: 嵌套结构显示错误

**症状**: 嵌套的矩形或容器边界混乱

```
错误示例:
+-------+
| +---+ |
| |   | |    <- 内外边框可能冲突
| +---+ |
+-------+
```

**解决方案**:
```
使用不同的边框风格:
.~~~~~~~.
!       :
! +---+ :
! |   | :
! +---+ :
!       :
'~~~~~~~'

或留出足够间距:
+----------+
|          |
|  +----+  |
|  |    |  |
|  +----+  |
|          |
+----------+
```

---

### 错误 10: 对角线连接问题

**症状**: 对角线没有正确连接到形状

```
错误示例:
A
 \
  \
   B    <- 斜线可能不对齐
```

**解决方案**:
```
正确示例:
A
 \
  \
   B

或使用中间节点:
A
 \
  +
   \
    B

45度角规则:
- 每行移动一个字符
- 每列移动一个字符
```

---

## 🐛 渲染引擎问题

### 错误 11: SVG 输出为空

**症状**: 生成的 SVG 文件为空或无内容

**可能原因**:
1. 输入文本全是空格
2. 没有可识别的图形字符
3. 编码问题（非 UTF-8）

**解决方案**:
```
检查清单:
✓ 至少包含一个图形元素
✓ 文件编码为 UTF-8
✓ 没有不可见的特殊字符
✓ 使用标准 ASCII 字符

测试用最简图形:
+-+
| |
+-+
```

---

### 错误 12: 特殊字符显示错误

**症状**: 某些字符在 SVG 中显示异常

**问题字符**:
- Unicode 字符（非 ASCII）
- 制表符 Tab
- 全角字符

**解决方案**:
```
仅使用标准 ASCII 字符:
✓ A-Z, a-z
✓ 0-9
✓ +-|/\*><^v
✓ .,'()[]{}

避免:
✗ Tab（用空格代替）
✗ 全角字符
✗ 特殊 Unicode 符号
```

---

## 🔧 工具相关问题

### 错误 13: CLI 渲染失败

**症状**: 命令行工具报错或输出错误

```bash
# 常见错误
svgbob input.txt -o output.svg
Error: Invalid character encoding
```

**解决方案**:
```bash
# 检查文件编码
file -I input.txt

# 转换为 UTF-8
iconv -f GB2312 -t UTF-8 input.txt > input_utf8.txt

# 指定编码
svgbob input_utf8.txt -o output.svg
```

---

### 错误 14: 在线编辑器中无法显示

**症状**: https://ivanceras.github.io/svgbob-editor/ 不显示预期结果

**常见原因**:
1. 浏览器缓存问题
2. JavaScript 错误
3. 输入字符过多

**解决方案**:
```
1. 清除浏览器缓存
2. 使用隐私/无痕模式
3. 检查浏览器控制台错误
4. 分段测试（减少输入字符）
5. 尝试其他浏览器
```

---

## 📝 调试技巧

### 技巧 1: 逐步构建

```
第一步: 绘制基本框架
+---+
+---+

第二步: 添加连接
+---+
  |
+---+

第三步: 添加文本和样式
+---+
| A |
+---+
  |
+---+
| B |
+---+
```

---

### 技巧 2: 使用注释标记

```
# TODO: 这里的连接有问题
A----?
     |
     B

# FIXME: 圆形变形
  __
 /  \
 \__/
```

---

### 技巧 3: 对比测试

```
# 工作的版本:
+---+
| A |
+---+

# 不工作的版本:
+---+
 | A |  <- 问题：左侧多了空格
+---+
```

---

## 🔍 排查流程

1. **检查字体**: 确保使用等宽字体
2. **验证对齐**: 使用编辑器的列标尺
3. **简化测试**: 移除复杂部分，逐步添加
4. **查看输出**: 检查 SVG 源代码
5. **对照文档**: 参考官方示例

---

## 🆘 获取帮助

- **GitHub Issues**: https://github.com/ivanceras/svgbob/issues
- **在线编辑器**: https://ivanceras.github.io/svgbob-editor/
- **Reddit**: r/rust (搜索 svgbob)
- **Stack Overflow**: 标签 `svgbob`

---

**最后更新**: 2025-10-13
**适用版本**: SvgBob 0.7.6+
