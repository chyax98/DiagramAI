# ============================================
# L2 语言层模板 v1.0.0
# RackDiag 语言的通用规范
# ============================================

[meta]
level = "L2"
language = "rackdiag"
version = "1.0.0"
description = "RackDiag 机柜图语言通用规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选: 语言相关的元数据
kroki_support = true
official_docs = "http://blockdiag.com/en/nwdiag/rackdiag-examples.html"

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "数据中心架构师",
  "RackDiag 语法专家",
  "机柜设计工程师"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **图表声明语法**: 所有 RackDiag 代码必须使用 `rackdiag {}` 关键字包裹。缺少图表声明会导致编译失败。
  """,

  """
  **U 位范围限制**: 标准 42U 机柜的 U 位编号范围是 1-42。超出此范围会导致渲染异常。可通过 `16U` 或 `24U` 定义非标准机柜高度。
  """,

  """
  **U 位编号规则**:
  - 默认模式：U 位从上往下编号，1U 在顶部，42U 在底部
  - ascending 模式：使用 `orientation = portrait` 后，1U 在底部，42U 在顶部（符合机柜物理标准）
  """,

  """
  **多 U 设备标记**: 占用多个 U 位的设备必须使用 `[2U]`、`[3U]`、`[4U]` 等标记。缺少标记会导致 U 位空间计算错误。
  """,

  """
  **多 U 设备不能重叠**: 多 U 设备占用的 U 位空间不能与其他设备重叠。例如 `1: Server [2U]` 占用 U1-U2，下一设备应从 U3 开始。
  """,

  """
  **中文描述使用双引号**: 设备名称和描述包含中文、空格或特殊字符时，必须使用双引号包裹，否则会导致语法错误。
  """,

  """
  **同一 U 位多设备语法**: 多个设备可用逗号分隔在同一 U 位水平排列，如 `1: PDU-A, PDU-B;`。适用于刀片服务器、双电源等场景。
  """,

  """
  **Kroki 兼容性**: 生成的代码必须能被 Kroki 成功渲染，避免使用 Kroki 不支持的 RackDiag 特性。
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 识别机柜需求**:
  - 确定机柜高度（42U 标准或 16U/24U 非标准）
  - 识别所有设备类型和数量
  - 确定每个设备占用的 U 位数
  - 规划设备的逻辑分层（电源、网络、计算、存储、管理）
  """,

  """
  **2. 规划 U 位布局**:
  - 分配电源设备到底部（U1-U5）
  - 分配网络设备到中下部（U6-U15）
  - 分配计算/存储设备到中上部（U16-U38）
  - 分配管理设备到顶部（U39-U42）
  - 计算每个设备的起始 U 位，确保无重叠
  """,

  """
  **3. 应用 RackDiag 语法**:
  - 使用 `rackdiag {}` 包裹所有内容
  - 可选定义机架高度（如 `16U;`）
  - 按 U 位顺序定义设备
  - 多 U 设备使用 `[2U]` 等标记
  - 添加必要的描述属性（description、color、重量、功耗）
  """,

  """
  **4. 验证和优化**:
  - 验证所有 U 位在 1-42 范围内
  - 检查多 U 设备无重叠
  - 确认布局分层合理（重设备在底部）
  - 验证承重和功耗在安全范围内
  - 添加散热预留空间（N/A 标记）
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **RackDiag 语法验证**: 代码必须符合 RackDiag 官方语法规范，无语法错误，能被 RackDiag 解析器成功解析。
  """,

  """
  **Kroki 渲染测试**: 代码必须能被 Kroki 成功渲染为 SVG 图像，无渲染错误或警告。
  """,

  """
  **U 位布局合理性**:
  - 所有 U 位编号在 1-42 范围内（或自定义高度范围内）
  - 多 U 设备占用空间计算正确，无重叠
  - 设备分层合理（电源底部、管理顶部）
  - 重量分布合理（重设备在底部）
  - 散热规划合理（高密度区域有预留空间）
  """,

  """
  **数据中心专业性**:
  - 设备命名符合数据中心命名规范
  - 设备布局符合数据中心最佳实践
  - 考虑承重和功耗限制
  - 预留扩展和维护空间
  - 冗余配置合理（双电源、双网络）
  """
]
