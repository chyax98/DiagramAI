# DBML å®˜æ–¹æ–‡æ¡£

> **éªŒè¯æ—¶é—´**: 2025-10-13
> **ä¿¡æ¯æ¥æº**: https://dbml.dbdiagram.io/

---

## ğŸ“‹ æ¦‚è¿°

**DBML (Database Markup Language)** æ˜¯ä¸€ä¸ªå¼€æºçš„é¢†åŸŸç‰¹å®šè¯­è¨€ (DSL)ï¼Œä¸“ä¸ºå®šä¹‰å’Œæ–‡æ¡£åŒ–æ•°æ®åº“æ¨¡å¼å’Œç»“æ„è€Œè®¾è®¡ã€‚

- **å®˜æ–¹ç½‘ç«™**: https://dbml.dbdiagram.io/
- **GitHub**: https://github.com/holistics/dbml
- **ç»´æŠ¤è€…**: Holistics (https://holistics.io)
- **æ ‡å‡†**: ISO/IEC 19510

---

## ğŸ¯ è®¾è®¡ç†å¿µ

### æ ¸å¿ƒç‰¹ç‚¹

1. **å£°æ˜å¼è¯­æ³•** - ä¸ SQL DDL ä¸åŒï¼ŒDBML æ˜¯å£°æ˜å¼è€Œéå‘½ä»¤å¼
2. **æ•°æ®åº“æ— å…³** - ä¸ç»‘å®šç‰¹å®šæ•°æ®åº“ (PostgreSQL, MySQL, etc.)
3. **é«˜å¯è¯»æ€§** - ä¸“æ³¨äºé«˜å±‚æ¬¡æ•°æ®åº“æ¶æ„ï¼Œè€Œéåº•å±‚åˆ›å»ºç»†èŠ‚
4. **ç®€å•ä¸€è‡´** - è¯­æ³•è§„åˆ™ç®€å•ä¸”ä¸€è‡´

### ä¸ SQL DDL çš„åŒºåˆ«

| ç‰¹æ€§       | DBML                 | SQL DDL                       |
| ---------- | -------------------- | ----------------------------- |
| èŒƒå¼       | å£°æ˜å¼ (Declarative) | å‘½ä»¤å¼ (Imperative)           |
| ç”¨é€”       | å®šä¹‰å’Œæ–‡æ¡£åŒ– Schema  | ç‰©ç†åˆ›å»º/ä¿®æ”¹è¡¨               |
| æ•°æ®åº“ç‰¹å®š | å¦                   | æ˜¯ (Oracle, PostgreSQL, etc.) |
| å¯è¯»æ€§     | é«˜                   | ä¸­ç­‰                          |

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

- **æ–‡æ¡£åˆ›å»ºæ•°**: 250 ä¸‡+ (æˆªè‡³ 2025 å¹´ 2 æœˆ)
- **ç”¨æˆ·æ•°**: 140 ä¸‡+ (æˆªè‡³ 2025 å¹´ 2 æœˆ)
- **ç¤¾åŒºè´¡çŒ®**: 20+ å¼€æºé¡¹ç›®å’Œæ’ä»¶

---

## ğŸ—ï¸ æ ¸å¿ƒè¯­æ³•ç»“æ„

### 1. Project Definition (é¡¹ç›®å®šä¹‰)

```dbml
Project project_name {
  database_type: 'PostgreSQL'
  Note: 'Description of the project'
}
```

### 2. Table Definition (è¡¨å®šä¹‰)

```dbml
// é»˜è®¤ public schema
Table table_name {
  column_name column_type [column_settings]
}

// æŒ‡å®š schema
Table schema_name.table_name {
  column_name column_type [column_settings]
}
```

**è¯­æ³•è§„åˆ™**:

- Schema åç§°å¯é€‰ï¼Œé»˜è®¤ä¸º `public`
- è¡¨åå’Œåˆ—åå¯ç”¨æ™®é€šæ–‡æœ¬æˆ–åŒå¼•å· `"column name"`
- åˆ—ç±»å‹æ”¯æŒæ‰€æœ‰å•è¯ç±»å‹ (å¦‚ `JSON`, `JSONB`, `decimal(1,2)`)
- åˆ—è¡¨ç”¨ `{}` åŒ…è£¹
- è®¾ç½®ç”¨ `[]` åŒ…è£¹
- å­—ç¬¦ä¸²å€¼ç”¨å•å¼•å· `'string'`

### 3. Column Settings (åˆ—è®¾ç½®)

```dbml
Table buildings {
  id integer [pk, unique, default: 123, note: 'Number']
  address varchar(255) [unique, not null, note: 'to include unit number']
}
```

**å¯ç”¨è®¾ç½®**:

- `primary key` / `pk` - ä¸»é”®
- `null` / `not null` - å¯ç©º/éç©º
- `unique` - å”¯ä¸€çº¦æŸ
- `default: value` - é»˜è®¤å€¼
- `increment` - è‡ªå¢
- `note: 'text'` - æ³¨é‡Š

### 4. Default Value (é»˜è®¤å€¼)

```dbml
Table users {
  id integer [default: 123]                    // æ•°å­—
  source varchar(255) [default: 'direct']      // å­—ç¬¦ä¸²
  created_at timestamp [default: `now()`]      // è¡¨è¾¾å¼
  active boolean [default: true]               // å¸ƒå°”å€¼
}
```

### 5. Index Definition (ç´¢å¼•å®šä¹‰)

```dbml
Table bookings {
  id integer
  country varchar
  booking_date date
  created_at timestamp

  indexes {
    (id, country) [pk]                         // å¤åˆä¸»é”®
    created_at [name: 'created_at_index']      // å‘½åç´¢å¼•
    (country, booking_date) [unique]           // å¤åˆå”¯ä¸€ç´¢å¼•
    booking_date [type: hash]                  // æŒ‡å®šç´¢å¼•ç±»å‹
    (`id*2`)                                   // è¡¨è¾¾å¼ç´¢å¼•
  }
}
```

**ç´¢å¼•è®¾ç½®**:

- `type: btree | hash | gin | gist` - ç´¢å¼•ç±»å‹
- `name: 'index_name'` - ç´¢å¼•åç§°
- `unique` - å”¯ä¸€ç´¢å¼•
- `pk` - ä¸»é”®

### 6. Relationship Definition (å…³ç³»å®šä¹‰)

**å››ç§å…³ç³»ç±»å‹**:

- `<` - one-to-many (ä¸€å¯¹å¤š)
- `>` - many-to-one (å¤šå¯¹ä¸€)
- `-` - one-to-one (ä¸€å¯¹ä¸€)
- `<>` - many-to-many (å¤šå¯¹å¤š)

**ä¸‰ç§è¯­æ³•å½¢å¼**:

```dbml
// 1. Long form (é•¿æ ¼å¼)
Ref name_optional {
  schema1.table1.column1 < schema2.table2.column2
}

// 2. Short form (çŸ­æ ¼å¼)
Ref name_optional: schema1.table1.column1 < schema2.table2.column2

// 3. Inline form (å†…è”æ ¼å¼)
Table posts {
  id integer
  user_id integer [ref: > users.id]
}
```

**å…³ç³»è®¾ç½®**:

```dbml
Ref: products.merchant_id > merchants.id [
  delete: cascade,
  update: no action,
  color: #79AD51
]
```

**å¤åˆå¤–é”®**:

```dbml
Ref: merchant_periods.(merchant_id, country_code) > merchants.(id, country_code)
```

### 7. Enum Definition (æšä¸¾å®šä¹‰)

```dbml
// é»˜è®¤ public schema
enum job_status {
  created [note: 'Waiting to be processed']
  running
  done
  failure
}

// æŒ‡å®š schema
enum v2.job_status {
  ...
}

// åŒ…å«ç‰¹æ®Šå­—ç¬¦
enum grade {
  "A+"
  "A"
  "A-"
  "Not Yet Set"
}
```

### 8. TableGroup (è¡¨åˆ†ç»„)

```dbml
TableGroup e_commerce [color: #345, note: 'E-commerce tables'] {
  merchants
  countries
  products
}
```

### 9. TablePartial (è¡¨æ¨¡æ¿)

```dbml
// å®šä¹‰å¯é‡ç”¨æ¨¡æ¿
TablePartial base_template [headerColor: #ff0000] {
  id int [pk, not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

TablePartial soft_delete_template {
  delete_status boolean [not null]
  deleted_at timestamp [default: `now()`]
}

// ä½¿ç”¨æ¨¡æ¿ (ç”¨ ~ å‰ç¼€)
Table users {
  ~base_template
  name varchar
  ~soft_delete_template
}
```

### 10. Notes (æ³¨é‡Š)

```dbml
// é¡¹ç›®æ³¨é‡Š
Project DBML {
  Note: '''
  # DBML - Database Markup Language
  å¤šè¡Œæ³¨é‡Šç¤ºä¾‹
  '''
}

// è¡¨æ³¨é‡Š
Table users {
  Note: 'Stores user data'
}

// åˆ—æ³¨é‡Š
Table orders {
  status varchar [note: 'ğŸ’¸ 1=processing, âœ”ï¸ 2=shipped']
}

// Sticky Notes (ä¾¿ç­¾)
Note single_line_note {
  'This is a single line note'
}

Note multiple_lines_note {'''
  This is a multiple lines note
  This string can spans over multiple lines.
'''}
```

### 11. Multi-line String (å¤šè¡Œå­—ç¬¦ä¸²)

```dbml
Note: '''
  This is a block string
  This string can spans over multiple lines.
'''
```

**è§„åˆ™**:

- ç”¨ä¸‰ä¸ªå•å¼•å· `'''` åŒ…è£¹
- æ¢è¡Œ: ç›´æ¥æŒ‰ Enter
- ç»­è¡Œ: ä½¿ç”¨ `\` åæ–œæ 
- è½¬ä¹‰å­—ç¬¦:
  - `\`: ä½¿ç”¨ `\\`
  - `'`: ä½¿ç”¨ `\'`
- è‡ªåŠ¨å»é™¤ç¼©è¿›

### 12. Comments (æ³¨é‡Š)

```dbml
// å•è¡Œæ³¨é‡Š

/*
  å¤šè¡Œæ³¨é‡Š
  å¯ä»¥è·¨è¶Šå¤šè¡Œ
*/
```

---

## ğŸ”„ è¯­æ³•ä¸€è‡´æ€§åŸåˆ™

| ç¬¦å·        | ç”¨é€”                      | ç¤ºä¾‹                  |
| ----------- | ------------------------- | --------------------- |
| `{}`        | åˆ†ç»„ (ç´¢å¼•ã€çº¦æŸã€è¡¨å®šä¹‰) | `Table users {...}`   |
| `[]`        | è®¾ç½®                      | `[pk, not null]`      |
| `//`        | å•è¡Œæ³¨é‡Š                  | `// è¿™æ˜¯æ³¨é‡Š`         |
| `/* */`     | å¤šè¡Œæ³¨é‡Š                  | `/* ... */`           |
| `'string'`  | å­—ç¬¦ä¸²å€¼                  | `default: 'value'`    |
| `"name"`    | å¼•ç”¨å˜é‡                  | `"column name"`       |
| `'''...'''` | å¤šè¡Œå­—ç¬¦ä¸²                | `Note: '''...'''`     |
| `` ` ``     | å‡½æ•°è¡¨è¾¾å¼                | ``default: `now()` `` |

---

## ğŸ› ï¸ é…å¥—å·¥å…·

### 1. dbdiagram.io

- **åŠŸèƒ½**: å¯è§†åŒ–æ•°æ®åº“å›¾è¡¨
- **ç½‘å€**: https://dbdiagram.io
- **ç”¨é€”**: ä» DBML ä»£ç ç”Ÿæˆ ER å›¾

### 2. dbdocs.io

- **åŠŸèƒ½**: æ•°æ®åº“æ–‡æ¡£ç”Ÿæˆå™¨
- **ç½‘å€**: https://dbdocs.io
- **ç”¨é€”**: ä» DBML ä»£ç ç”Ÿæˆæ–‡æ¡£ç½‘ç«™

### 3. RunSQL

- **åŠŸèƒ½**: SQL æŸ¥è¯¢æµ‹è¯•å·¥å…·
- **ç½‘å€**: https://runsql.com
- **ç”¨é€”**: åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®åº“ç¯å¢ƒ

### 4. DBML CLI

- **åŠŸèƒ½**: å‘½ä»¤è¡Œå·¥å…·
- **å®‰è£…**: `npm install -g @dbml/cli`
- **ç”¨é€”**: DBML â†” SQL äº’è½¬

```bash
# SQL è½¬ DBML
sql2dbml schema.sql --postgres -o schema.dbml

# DBML è½¬ SQL
dbml2sql schema.dbml --postgres -o schema.sql
```

### 5. @dbml/core (JS æ¨¡å—)

- **åŠŸèƒ½**: Node.js åº“
- **å®‰è£…**: `npm install @dbml/core`
- **ç”¨é€”**: ç¨‹åºåŒ–è½¬æ¢ DBML â†” SQL

---

## ğŸ“¦ ç¤¾åŒºè´¡çŒ®é¡¹ç›®

1. **ç¼–è¾‘å™¨æ”¯æŒ**:
   - VSCode: `dbml-language` by duynvu
   - Vim: `vim-dbml` by jidn
   - Emacs: `dbd-mode` by ccod

2. **è§£æå™¨**:
   - Python: `PyDBML` by Vanderhoof
   - Go: `dbml-go` by duythinht
   - PHP: `dbml-parser` by Butschster
   - Java: `dbml-java` by Nils Wende
   - C#: `Ivy.Dbml.Parser` by Niels Bosma

3. **æ¡†æ¶é›†æˆ**:
   - Django: `DbmlForDjango` by hamedsj
   - Laravel: `Kacher` by Arsanandha
   - Rails: `SchemaToDbml` by Ricardo Ribeiro
   - Prisma: `prisma-dbml-generator` by Marc Stammerjohann

4. **å…¶ä»–å·¥å…·**:
   - Android Room: `FloorPlan` by julioz
   - Parse Server: `parseServerSchema2dbml` by stepanic
   - Snowflake: `snowflake-dbml-generator` by Ryan Rozich
   - Dynamics 365: `d365fo-entity-schema` by noakesey

---

## ğŸ”— ç›¸å…³èµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://dbml.dbdiagram.io/docs/
- **CLI æ–‡æ¡£**: https://dbml.dbdiagram.io/cli
- **JS æ¨¡å—æ–‡æ¡£**: https://dbml.dbdiagram.io/js-module/core
- **GitHub Issues**: https://github.com/holistics/dbml/issues
- **ç¤¾åŒºè®ºå›**: https://community.dbdiagram.io/

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹

```dbml
Project ecommerce_db {
  database_type: 'PostgreSQL'
  Note: 'E-commerce database schema'
}

// æšä¸¾å®šä¹‰
enum order_status {
  pending [note: 'Order placed']
  processing
  shipped
  delivered
  cancelled
}

// è¡¨å®šä¹‰
Table users {
  id integer [pk, increment]
  username varchar(50) [unique, not null]
  email varchar(100) [unique, not null]
  created_at timestamp [default: `now()`]

  indexes {
    email [unique]
    created_at
  }

  Note: 'User account information'
}

Table orders {
  id integer [pk, increment]
  user_id integer [not null, ref: > users.id]
  status order_status [default: 'pending']
  total_amount decimal(10,2) [not null]
  created_at timestamp [default: `now()`]

  indexes {
    (user_id, created_at)
    status
  }
}

// å…³ç³»å®šä¹‰
Ref: orders.user_id > users.id [delete: cascade]

// è¡¨åˆ†ç»„
TableGroup core {
  users
  orders
}
```

---

**æ–‡æ¡£æ›´æ–°**: 2025-10-13
**æ•°æ®æ¥æº**: DBML å®˜æ–¹ç½‘ç«™ (dbml.dbdiagram.io)
