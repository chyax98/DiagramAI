# ============================================
# L3 类型层 - Vega-Lite Line Chart v1.0.0
# ============================================

[meta]
level = "L3"
language = "vegalite"
diagram_type = "line"
version = "1.0.0"
description = "Vega-Lite 折线图规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选元数据
complexity = "medium"
target_length = 2800
use_cases = ["时间序列分析", "趋势变化展示", "多系列对比", "温度曲线"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "时间序列分析专家 - 精通时间数据的格式、粒度和趋势识别",
  "折线图专家 - 擅长折线图的多系列对比和插值方法"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **mark 类型固定**: 折线图必须使用 `"line"` 标记类型:
  - ✅ **正确**: `"mark": "line"` 或 `"mark": {"type": "line"}`
  - ❌ **错误**: `"mark": "linechart"` 或其他拼写错误
  """,

  """
  **时间字段类型**: 时间数据必须使用 `temporal` 类型:
  - ✅ **正确**: `{"field": "date", "type": "temporal"}`
  - ❌ **错误**: 使用 `ordinal` 或 `nominal` 处理时间数据
  - 配合 `timeUnit` 指定时间粒度
  """,

  """
  **时间格式规范**: 时间数据必须使用 ISO 8601 标准格式:
  - ✅ **日期**: `"2024-01-15"` (YYYY-MM-DD)
  - ✅ **日期时间**: `"2024-01-15T14:30:00"` (YYYY-MM-DDTHH:mm:ss)
  - ❌ **错误**: `"2024/01/15"` 或 `"01-15-2024"` 等非标准格式
  """,

  """
  **数据点显示**: 建议启用数据点标记:
  - 使用 `"point": true` 显示每个数据点
  - 使用 `"point": {"filled": true, "size": 50}` 自定义样式
  - 提升数据可读性和交互性
  """,

  """
  **多系列折线图**: 使用 `color` 通道区分不同系列:
  - 数据需要展平格式（long format）
  - 每行一个数据点，包含系列标识字段
  - 使用 `color` 通道自动绘制多条线
  """,

  """
  **插值方式选择**: 根据数据特点选择合适的插值:
  - `"linear"`: 直线连接（默认）
  - `"monotone"`: 平滑曲线（推荐用于温度、趋势等）
  - `"step"`: 阶梯线（适合离散变化）
  - `"basis"`: 贝塞尔曲线
  """,

  """
  **坐标轴范围**: 根据数据特点设置 y 轴范围:
  - `"scale": {"zero": true}` - 从 0 开始（强调增长幅度）
  - `"scale": {"zero": false}` - 显示真实范围（温度、评分等）
  """,

  """
  **timeUnit 使用**: 为时间字段指定合适的时间粒度:
  - `"year"`: 年
  - `"yearmonth"`: 年月
  - `"yearmonthdate"`: 年月日
  - `"hours"`, `"minutes"`: 小时、分钟
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 识别时间序列特征**:
  - **时间粒度**: 日、月、季度、年、小时
  - **数据周期性**: 是否有周期性模式
  - **系列数量**: 单系列或多系列对比
  - **趋势特点**: 上升、下降、波动
  """,

  """
  **2. 准备时间数据**:
  - 将时间数据转换为 ISO 8601 格式
  - **单系列**: `[{"date": "2024-01", "value": 100}]`
  - **多系列**: `[{"date": "2024-01", "series": "A", "value": 100}]`
  - 确保时间数据连续且有序
  """,

  """
  **3. 配置时间轴**:
  - x 轴使用 `temporal` 类型
  - 使用 `timeUnit` 指定时间粒度
  - 添加坐标轴标题（`axis.title`）
  - 可选：使用 `axis.format` 自定义时间显示格式
  """,

  """
  **4. 设置线条样式**:
  - 选择合适的插值方式（`interpolate`）
  - 启用数据点显示（`point: true`）
  - 单系列使用 `mark.color` 设置颜色
  - 多系列使用 `color` 通道区分
  """,

  """
  **5. 优化坐标轴**:
  - 根据数据特点设置 y 轴范围（`scale.zero`）
  - 添加图例标题（多系列图表）
  - 设置合理的尺寸（`width`, `height`）
  - 启用 tooltip
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **时间数据正确性**:
  - 时间字段使用 `temporal` 类型
  - 时间格式符合 ISO 8601 标准
  - `timeUnit` 设置合理
  - 时间轴刻度和标签清晰
  """,

  """
  **数据点可见性**:
  - 启用 `point: true` 显示数据点
  - 数据点大小和样式清晰可辨
  - 线条颜色和宽度合理
  """,

  """
  **多系列区分度**:
  - 使用 `color` 通道清晰区分不同系列
  - 颜色方案对比明显
  - 图例标题和标签清晰
  - 数据格式为展平格式
  """,

  """
  **坐标轴合理性**:
  - y 轴范围符合数据特点
  - 时间轴显示完整且连续
  - 坐标轴标题清晰
  - 刻度和标签不重叠
  """
]

# ============================================
# Section 5: 使用场景 (Use Cases)
# ============================================

[[use_cases]]
title = "月度用户增长趋势"
scenario = "展示产品的月度活跃用户数变化，识别增长趋势和拐点"
key_points = [
  "使用 timeUnit: 'yearmonth' 按月聚合数据",
  "启用 point: true 显示每月数据点",
  "scale.zero: true 从 0 开始强调增长幅度"
]

[[use_cases]]
title = "产品季度销量对比"
scenario = "对比多个产品在各季度的销量表现，识别表现最好的产品"
key_points = [
  "使用 color 通道区分不同产品",
  "数据展平格式，每行一个产品-季度数据点",
  "图例清晰标注产品名称"
]

[[use_cases]]
title = "24小时温度变化曲线"
scenario = "展示一天内温度的变化趋势，使用平滑曲线"
key_points = [
  "使用 interpolate: 'monotone' 生成平滑曲线",
  "时间格式 ISO 8601: '2024-01-15T14:00:00'",
  "scale.zero: false 显示温度真实范围（不从0开始）",
  "timeUnit: 'hoursminutes' 显示小时分钟"
]

[[use_cases]]
title = "股票价格走势"
scenario = "展示股票的历史价格走势，支持时间范围筛选"
key_points = [
  "使用 temporal 类型处理日期数据",
  "scale.zero: false 显示价格真实波动范围",
  "启用 tooltip 显示具体日期和价格"
]
