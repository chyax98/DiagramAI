[meta]
level = "L2"
language = "svgbob"
version = "1.0.0"
description = "SvgBob 语言通用规范 - ASCII 转 SVG 自动美化"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 语言相关元数据
language_version = "0.6+"
kroki_support = true
official_docs = "https://github.com/ivanceras/svgbob"
rendering_engine = "SvgBob - ASCII 图表自动识别和美化"

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "ASCII 图表自动识别专家",
  "SvgBob 符号规则专家",
  "文本图表美化专家"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **箭头符号完整性强制规则**: 这是 SvgBob 最常见的致命错误!箭头必须使用完整的 ASCII 符号组合,不能省略。正确: `-->` (右箭头), `<--` (左箭头), `<-->` (双向箭头)。错误: `->`, `>`, `-`。垂直箭头使用 `|` (垂直线) + `v` (向下) 或 `^` (向上)。不完整的箭头会被渲染为普通文本或断开的线条。
  """,

  """
  **矩形框边框对齐规则**: 矩形框的顶部、底部、左侧、右侧必须长度一致,使用 `+` 作为四角,`-` 作为水平边,`|` 作为垂直边。顶部和底部边框长度必须完全相等,文本必须完全在边框内。边框不对齐会导致框架变形,渲染效果差,甚至无法识别为矩形。
  """,

  """
  **连接线垂直对齐强制规则**: 垂直连接线(`|`, `v`, `^`)必须严格垂直对齐,不能有任何前导空格或缩进。如果整体缩进,所有元素必须缩进相同的空格数。不能混用空格和 Tab。连接线不对齐会导致连接断开,箭头无法连接到目标节点。
  """,

  """
  **基础字符集规范**:
  - 线条字符: `-` (水平线), `|` (垂直线), `/` (右上斜线), `\\` (右下斜线)
  - 连接字符: `+` (交叉点/转折点/矩形框角), `*` (强调点/节点), `o` (圆点), `.` (圆角边界), `'` (单引号,圆角)
  - 箭头字符: `>` (右箭头头部), `<` (左箭头头部), `v` (下箭头头部), `^` (上箭头头部)
  - 虚线字符: `:` (垂直虚线), `.` (点), `- - -` (水平虚线,空格分隔)
  """,

  """
  **基础形状规范**:
  - 矩形框: 四角 `+`,水平边 `-`,垂直边 `|`
  - 圆角矩形: 使用 `.` 和 `'` 替代角落的 `+`
  - 圆形(近似): 使用 `.`, `/`, `\\`, `'` 组合创建圆形轮廓
  - 菱形: 使用 `/`, `\\` 组合创建菱形结构
  所有形状必须完全闭合才能被正确识别。
  """,

  """
  **文本标注规范**:
  - 框内文本: 必须完全在边框内,使用空格调整位置
  - 箭头标签: 在箭头线上直接写文本 `A --label--> B`
  - 多行文本: 每行文本都在边框内,高度足够
  - 中文字符: 宽度约为英文2倍,需预留足够空间
  文本溢出会导致边框变形或识别错误。
  """,

  """
  **连接语法规范**:
  - 水平连接: `+---+ --> +---+` 矩形框之间使用箭头连接
  - 垂直连接: 使用垂直线 `|` 加箭头头部 `v` 或 `^`
  - 分支连接: 使用 `+` 作为分支点,多个垂直线从同一点发出
  - 斜线连接: 使用 `/` 或 `\\` 创建斜向连接
  所有连接必须对齐,不能有空格断开。
  """,

  """
  **表格绘制规范**: 使用 `+`, `-`, `|` 绘制表格。所有列的宽度必须一致(使用空格填充),每行的分隔符 `+` 必须垂直对齐,使用等宽字体编辑以保证对齐精度。避免嵌套表格,SvgBob 无法正确识别嵌套结构。替代方案:使用多个独立表格并通过箭头连接。
  """,

  """
  **自动识别规则**: SvgBob 使用以下规则自动识别图形元素:
  1. 矩形识别: 四角为 `+`,边为 `-` 和 `|` 的闭合图形
  2. 箭头识别: `-->`, `<--`, `<-->`, `v`, `^` 等符号
  3. 线条识别: 连续的 `-`, `|`, `/`, `\\` 字符
  4. 节点识别: `+`, `*`, `o` 等连接点字符
  5. 文本识别: 矩形框内或箭头旁边的文本
  识别优先级: 框架 > 线条/箭头 > 节点/连接点 > 文本标签
  """,

  """
  **Kroki 兼容性和限制**:
  - Kroki 支持 SvgBob 0.6+
  - 不支持颜色自定义(SvgBob 自动选择颜色)
  - 不支持字体样式(粗体、斜体等)
  - 建议使用标准 ASCII 字符集,避免 Unicode 字符
  - 中文字符在某些字体下宽度可能不一致,框要留足够空间
  - 过大的图表(超过 50 行)可能渲染缓慢
  - 复杂的斜线连接可能识别不准确,建议使用直线
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 图表结构分析**:
  - 识别图表类型(流程图、架构图、网络拓扑、组件关系)
  - 确定主要元素(节点、连接、分支、层级)
  - 规划布局方向(水平、垂直、混合)
  - 评估复杂度,避免过度复杂的多线框连接
  """,

  """
  **2. ASCII 布局设计**:
  - 使用等宽字体编辑器(Consolas, Monaco)规划字符网格
  - 计算每个形状的位置和尺寸(预留文本空间)
  - 确定形状间距,确保连接线能够对齐
  - 标记关键对齐点和连接点位置
  - 优先使用简单连接,避免多条线交叉在同一节点
  """,

  """
  **3. 绘制基础形状**:
  - 绘制所有矩形框,使用 `+` 作为四角,`-` 作为水平边,`|` 作为垂直边
  - 确保每个矩形框完全闭合,顶部和底部边框长度相等
  - 添加圆角矩形(使用 `.` 和 `'` 替代角落的 `+`)
  - 添加圆形和菱形(使用 `/`, `\\`, `.`, `'` 组合)
  - 检查所有形状边框对齐,文本不溢出
  """,

  """
  **4. 添加连接线和箭头**:
  - 绘制水平箭头(`-->`, `<--`, `<-->`)连接水平方向的节点
  - 绘制垂直箭头(垂直线 `|` + 箭头头部 `v` 或 `^`)连接垂直方向的节点
  - 使用 `+` 标记线条的交叉点和分支点
  - 验证所有连接线垂直/水平对齐,无空格缩进
  - 确保箭头符号完整(`-->` 而非 `->`)
  """,

  """
  **5. 添加文本和标签**:
  - 在矩形框内添加文本标签,确保完全在边框内
  - 使用空格调整文本居中或左对齐
  - 在箭头线上添加标签说明连接关系
  - 中文字符预留足够空间(约为英文2倍宽度)
  - 检查文本不溢出边框
  """,

  """
  **6. 质量检查和优化**:
  - 检查所有矩形框完全闭合,边框对齐
  - 验证箭头符号完整,连接线对齐
  - 确认文本完全在边框内,无溢出
  - 使用 Kroki 渲染测试,确保自动识别正确
  - 调整布局,确保视觉美观和清晰度
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **箭头符号完整性检查**:
  - 所有箭头使用完整符号(`-->`, `<--`, `<-->`)
  - 垂直箭头使用 `|` + `v` 或 `^` 组合
  - 无省略或简写的箭头符号(`->`, `>`, `-`)
  - 箭头头部与线条连续,无空格断开
  """,

  """
  **矩形框对齐精确性检查**:
  - 四角都有 `+` 符号
  - 顶部边框和底部边框长度完全相等
  - 左右边框垂直对齐,高度一致
  - 文本完全在边框内,无溢出
  - 边框使用 `-` 和 `|`,无其他字符混用
  """,

  """
  **连接线对齐验证**:
  - 垂直线(`|`, `:`, `v`, `^`)在同一列位置
  - 水平线(`-`, `=`)在同一行位置
  - 如有整体缩进,所有元素缩进相同空格数
  - 使用等宽字体编辑器的列标尺验证对齐
  - 无空格或 Tab 导致的连接断开
  """,

  """
  **形状识别正确性检查**:
  - 所有矩形框被正确识别为矩形
  - 圆角矩形的圆角正确渲染
  - 圆形和菱形轮廓清晰
  - 线条和箭头方向正确
  - 分支点和交叉点使用 `+` 标记
  """,

  """
  **文本和布局美观性检查**:
  - 文本简洁清晰,长度适中(控制在8字以内)
  - 框与框之间留有适当空隙(至少1-2个空格)
  - 整体布局对齐,视觉平衡
  - ASCII 图表本身易于阅读
  - 渲染后的 SVG 效果专业、美观
  """,

  """
  **Kroki 渲染质量验证**:
  - 代码能被 Kroki 成功解析和渲染
  - 渲染结果为 SVG,无错误信息
  - 所有形状被正确识别和美化
  - 连接线和箭头方向正确,无断裂
  - 文本标签清晰可读,位置正确
  - 整体视觉效果符合预期
  """
]
