# ============================================
# L3 类型层 - Vega-Lite Area Chart v1.0.0
# ============================================

[meta]
level = "L3"
language = "vegalite"
diagram_type = "area"
version = "1.0.0"
description = "Vega-Lite 面积图规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选元数据
complexity = "medium"
target_length = 2600
use_cases = ["累积数据展示", "堆叠面积图", "流图", "时间序列累积"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "累积数据可视化专家 - 精通累积数据和时间序列面积图设计",
  "面积图专家 - 擅长简单、堆叠和流图的实现"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **mark 类型固定**: 面积图必须使用 `"area"` 标记类型:
  - ✅ **正确**: `"mark": "area"` 或 `"mark": {"type": "area"}`
  - ❌ **错误**: `"mark": "areachart"` 或其他拼写错误
  """,

  """
  **边界线和数据点**: 建议显示顶部边界线和数据点:
  - ✅ **推荐**: `"line": true` 显示顶部线条
  - ✅ **推荐**: `"point": true` 显示数据点
  - 提升图表可读性和专业性
  """,

  """
  **y 轴从 0 开始**: 面积图通常要求 y 轴从 0 开始:
  - ✅ **正确**: 默认情况（`scale.zero: true`）
  - ❌ **错误**: `scale.zero: false` 会导致面积表示不准确
  - 面积大小表示累积量，必须从 0 基线开始
  """,

  """
  **时间轴类型**: 时间序列面积图 x 轴使用 `temporal` 类型:
  - 配合 `timeUnit` 指定时间粒度
  - 时间数据使用 ISO 8601 格式
  """,

  """
  **堆叠面积图**: 使用 `color` 通道自动堆叠不同系列:
  - 数据需要展平格式（long format）
  - 使用 `color` 通道区分系列
  - 数据会自动从下往上累加堆叠
  """,

  """
  **流图实现**: 使用 `stack: "center"` 创建流图（Streamgraph）:
  - 中心对称布局
  - 适合展示比例变化而非绝对值
  - 建议隐藏 y 轴（`axis: null`）
  """,

  """
  **透明度设置**: 建议设置适当的透明度:
  - 使用 `"opacity": 0.7` 使面积图更柔和
  - 堆叠面积图可以看到重叠部分
  """,

  """
  **插值方式**: 可选择平滑曲线插值:
  - `"interpolate": "monotone"` 生成平滑曲线
  - 适合趋势性强的累积数据
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 识别面积图类型**:
  - **简单面积图**: 单一系列累积数据
  - **堆叠面积图**: 多系列累积对比（使用 color）
  - **流图**: 中心对称展示比例变化（使用 stack: "center"）
  """,

  """
  **2. 准备数据结构**:
  - **简单面积图**: `[{"date": "2024-01", "value": 100}]`
  - **堆叠面积图**: `[{"date": "2024-01", "series": "A", "value": 100}]`
  - 确保数据展平（每行一个数据点）
  - 时间数据使用 ISO 8601 格式
  """,

  """
  **3. 配置坐标轴**:
  - x 轴（时间轴）使用 `temporal` 类型 + `timeUnit`
  - y 轴使用 `quantitative` 类型
  - **重要**: y 轴从 0 开始（默认行为）
  - 添加坐标轴标题
  """,

  """
  **4. 设置面积样式**:
  - 启用顶部边界线（`line: true`）
  - 启用数据点（`point: true`）
  - 设置透明度（`opacity: 0.7`）
  - 单系列使用 `mark.color` 设置颜色
  - 多系列使用 `color` 通道区分
  """,

  """
  **5. 优化特殊类型**:
  - **流图**: 使用 `stack: "center"` + `axis: null`
  - 使用 `interpolate: "monotone"` 平滑曲线
  - 设置合理的图表尺寸
  - 启用 tooltip
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **基线正确性**:
  - y 轴从 0 开始（面积图必需）
  - 面积大小准确表示累积量
  - 无负值区域（除非使用流图）
  """,

  """
  **边界和数据点**:
  - 显示顶部边界线（line: true）
  - 显示数据点（point: true）
  - 边界清晰可辨
  """,

  """
  **堆叠正确性**:
  - 堆叠面积图使用 `color` 通道
  - 数据格式为展平格式
  - 堆叠顺序合理
  - 总高度表示总量
  """,

  """
  **视觉效果**:
  - 透明度适中（0.6-0.8）
  - 颜色区分明显
  - 流图中心对称
  - 整体布局美观
  """
]

# ============================================
# Section 5: 使用场景 (Use Cases)
# ============================================

[[use_cases]]
title = "累计销售额趋势"
scenario = "展示月度累计销售额的增长趋势，强调累积效果"
key_points = [
  "使用简单面积图展示累积数据",
  "line: true 和 point: true 提升可读性",
  "y 轴从 0 开始表示累积量"
]

[[use_cases]]
title = "产品季度销量堆叠"
scenario = "展示多个产品在各季度的销量累积情况"
key_points = [
  "使用堆叠面积图（color 通道）",
  "数据展平格式，每行一个产品-季度数据点",
  "总高度表示所有产品的总销量"
]

[[use_cases]]
title = "渠道流量变化流图"
scenario = "使用流图展示多个渠道流量的比例变化，中心对称布局"
key_points = [
  "使用 stack: 'center' 创建流图",
  "interpolate: 'monotone' 平滑曲线",
  "axis: null 隐藏 y 轴（流图特征）",
  "适合展示比例变化而非绝对值"
]

[[use_cases]]
title = "能耗累积分析"
scenario = "展示不同设备的能耗累积情况，识别主要能耗来源"
key_points = [
  "堆叠面积图展示各设备能耗累积",
  "颜色方案清晰区分不同设备",
  "总高度表示总能耗"
]
