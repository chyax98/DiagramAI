# DBML å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

> **éªŒè¯æ—¶é—´**: 2025-10-13
> **å‚è€ƒæ¥æº**: GitHub Issues, Community Forum, Stack Overflow

---

## ğŸš¨ é«˜é¢‘é”™è¯¯ç±»å‹

### 1. æ•°æ®ç±»å‹é”™è¯¯

#### é”™è¯¯ 1.1: ç±»å‹åŒ…å«ç©ºæ ¼

```dbml
// âŒ é”™è¯¯
Table users {
  id big int              // ç±»å‹ä¸èƒ½æœ‰ç©ºæ ¼
  price decimal (10, 2)   // æ‹¬å·å‰ä¸èƒ½æœ‰ç©ºæ ¼
}

// âœ… æ­£ç¡®
Table users {
  id bigint
  price decimal(10,2)
}
```

**åŸå› **: DBML è¦æ±‚æ•°æ®ç±»å‹å¿…é¡»æ˜¯å•ä¸ªå•è¯

**è§£å†³æ–¹æ¡ˆ**:

- ç§»é™¤ç±»å‹ä¸­çš„æ‰€æœ‰ç©ºæ ¼
- å‚æ•°æ‹¬å·ç´§è·Ÿç±»å‹å: `decimal(10,2)`

#### é”™è¯¯ 1.2: ä¸æ”¯æŒçš„ç±»å‹è¯­æ³•

```dbml
// âŒ é”™è¯¯
Table users {
  id bigint unsigned      // å¤šå•è¯ç±»å‹
}

// âœ… è§£å†³æ–¹æ¡ˆ 1: ç”¨å¼•å·åŒ…è£¹
Table users {
  id "bigint unsigned"
}

// âœ… è§£å†³æ–¹æ¡ˆ 2: ä½¿ç”¨æ ‡å‡†ç±»å‹
Table users {
  id bigint [note: 'unsigned in actual DB']
}
```

### 2. é»˜è®¤å€¼é”™è¯¯

#### é”™è¯¯ 2.1: å­—ç¬¦ä¸²å€¼å¼•å·é”™è¯¯

```dbml
// âŒ é”™è¯¯
Table users {
  status varchar [default: "active"]     // ç”¨äº†åŒå¼•å·
  source varchar [default: active]       // æ²¡ç”¨å¼•å·
}

// âœ… æ­£ç¡®
Table users {
  status varchar [default: 'active']     // å•å¼•å·
  source varchar [default: 'direct']
}
```

**è§„åˆ™**:

- å­—ç¬¦ä¸²å€¼: å¿…é¡»ç”¨**å•å¼•å·** `'string'`
- åŒå¼•å·: ä»…ç”¨äºå¼•ç”¨å˜é‡å `"column name"`

#### é”™è¯¯ 2.2: è¡¨è¾¾å¼å¼•å·é”™è¯¯

```dbml
// âŒ é”™è¯¯
Table logs {
  created_at timestamp [default: 'now()']      // å•å¼•å·é”™è¯¯
  expires_at timestamp [default: "now() + interval '1 day'"]  // åŒå¼•å·é”™è¯¯
}

// âœ… æ­£ç¡®
Table logs {
  created_at timestamp [default: `now()`]      // åå¼•å·
  expires_at timestamp [default: `now() + interval '1 day'`]
}
```

**è§„åˆ™**:

- è¡¨è¾¾å¼: å¿…é¡»ç”¨**åå¼•å·** `` `expression` ``
- æ•°å­—: ä¸ç”¨å¼•å· `[default: 123]`
- å¸ƒå°”: ä¸ç”¨å¼•å· `[default: true]`

#### é”™è¯¯ 2.3: é»˜è®¤å€¼ç±»å‹ä¸åŒ¹é…

```dbml
// âŒ é”™è¯¯
Table users {
  age integer [default: 'twenty']        // å­—ç¬¦ä¸²èµ‹ç»™æ•´æ•°
  is_active boolean [default: 'true']    // å­—ç¬¦ä¸²èµ‹ç»™å¸ƒå°”
}

// âœ… æ­£ç¡®
Table users {
  age integer [default: 20]
  is_active boolean [default: true]
}
```

### 3. å…³ç³»å®šä¹‰é”™è¯¯

#### é”™è¯¯ 3.1: å…³ç³»ç¬¦å·æ–¹å‘é”™è¯¯

```dbml
// âŒ é”™è¯¯æ¦‚å¿µ
Table posts {
  user_id integer [ref: < users.id]    // ç¬¦å·åäº†
}

// âœ… æ­£ç¡®ç†è§£
// posts.user_id > users.id  (many-to-one: å¤šä¸ª post å¯¹åº” 1 ä¸ª user)
Table posts {
  user_id integer [ref: > users.id]
}

// æˆ–è€…
Ref: posts.user_id > users.id
```

**è®°å¿†æŠ€å·§**:

- `>`: ç®­å¤´æŒ‡å‘ "ä¸€" çš„é‚£æ–¹ (many â†’ one)
- `<`: ç®­å¤´æŒ‡å‘ "å¤š" çš„é‚£æ–¹ (one â†’ many)

#### é”™è¯¯ 3.2: One-to-One å¤–é”®ä½ç½®é”™è¯¯

```dbml
// âŒ é”™è¯¯: æä¸æ¸…å“ªä¸ªæ˜¯å¤–é”®
Ref: users.id - profiles.user_id

// å®é™…ä¸Š: profiles.user_id æ˜¯å¤–é”®
// è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„

// âœ… æ¨è: ç”¨å†…è”å½¢å¼æ˜ç¡®å¤–é”®
Table profiles {
  user_id integer [ref: - users.id]    // æ˜ç¡® profiles.user_id æ˜¯å¤–é”®
}
```

**è§„åˆ™**:

- Long/Short form: **ç¬¬äºŒåˆ—**æ˜¯å¤–é”®
- Inline form: **æœ‰ ref çš„åˆ—**æ˜¯å¤–é”®

#### é”™è¯¯ 3.3: å¤åˆå¤–é”®è¯­æ³•é”™è¯¯

```dbml
// âŒ é”™è¯¯
Ref: order_items.order_id, order_items.product_id > orders.id, orders.store_id

// âœ… æ­£ç¡®
Ref: order_items.(order_id, product_id) > orders.(id, store_id)
```

#### é”™è¯¯ 3.4: è·¨ Schema å¼•ç”¨æœªæŒ‡å®š Schema

```dbml
// âŒ é”™è¯¯
Table blogging.posts {
  user_id integer [ref: > users.id]     // æ‰¾ä¸åˆ° users (é»˜è®¤åœ¨ blogging schema)
}

// âœ… æ­£ç¡®
Table blogging.posts {
  user_id integer [ref: > core.users.id]    // æ˜ç¡®æŒ‡å®š core schema
}
```

### 4. ç´¢å¼•å®šä¹‰é”™è¯¯

#### é”™è¯¯ 4.1: ç´¢å¼•æ‹¬å·é”™è¯¯

```dbml
// âŒ é”™è¯¯
Table users {
  indexes {
    id, email [unique]              // è¯­æ³•é”™è¯¯
    user_id, created_at [pk]        // è¯­æ³•é”™è¯¯
  }
}

// âœ… æ­£ç¡®
Table users {
  indexes {
    (id, email) [unique]            // å¤åˆç´¢å¼•ç”¨æ‹¬å·
    (user_id, created_at) [pk]      // å¤åˆä¸»é”®ç”¨æ‹¬å·
    id [unique]                     // å•åˆ—å¯ä»¥ä¸ç”¨æ‹¬å·
  }
}
```

#### é”™è¯¯ 4.2: ä¸»é”®é‡å¤å®šä¹‰

```dbml
// âŒ é”™è¯¯
Table users {
  id integer [pk]
  email varchar [unique]

  indexes {
    id [pk]        // é‡å¤å®šä¹‰ä¸»é”®
  }
}

// âœ… æ­£ç¡®æ–¹æ¡ˆ 1: åªåœ¨åˆ—å®šä¹‰
Table users {
  id integer [pk]
  email varchar [unique]
}

// âœ… æ­£ç¡®æ–¹æ¡ˆ 2: åªåœ¨ç´¢å¼•
Table users {
  id integer
  email varchar [unique]

  indexes {
    id [pk]
  }
}

// âœ… æ­£ç¡®æ–¹æ¡ˆ 3: å¤åˆä¸»é”®å¿…é¡»åœ¨ç´¢å¼•
Table orders {
  user_id integer
  order_id integer

  indexes {
    (user_id, order_id) [pk]
  }
}
```

#### é”™è¯¯ 4.3: è¡¨è¾¾å¼ç´¢å¼•å¼•å·é”™è¯¯

```dbml
// âŒ é”™è¯¯
Table users {
  indexes {
    (lower(email))              // æ²¡ç”¨åå¼•å·
    'id * 2'                    // ç”¨äº†å•å¼•å·
  }
}

// âœ… æ­£ç¡®
Table users {
  indexes {
    (`lower(email)`)            // åå¼•å·
    (`id * 2`)                  // åå¼•å·
  }
}
```

### 5. æšä¸¾ç›¸å…³é”™è¯¯

#### é”™è¯¯ 5.1: æšä¸¾å€¼åŒ…å«ç©ºæ ¼æœªåŠ å¼•å·

```dbml
// âŒ é”™è¯¯
enum status {
  not set        // æœ‰ç©ºæ ¼ï¼Œéœ€è¦å¼•å·
  A+             // ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦å¼•å·
}

// âœ… æ­£ç¡®
enum status {
  "not set"
  "A+"
}
```

#### é”™è¯¯ 5.2: æšä¸¾åç§°å†²çª

```dbml
// âŒ é”™è¯¯
enum status {
  active
  inactive
}

enum status {      // é‡å¤å®šä¹‰
  pending
  done
}

// âœ… æ­£ç¡®æ–¹æ¡ˆ 1: ä½¿ç”¨ä¸åŒåç§°
enum user_status {
  active
  inactive
}

enum order_status {
  pending
  done
}

// âœ… æ­£ç¡®æ–¹æ¡ˆ 2: ä½¿ç”¨ä¸åŒ schema
enum public.status {
  active
  inactive
}

enum v2.status {
  pending
  done
}
```

### 6. TablePartial é”™è¯¯

#### é”™è¯¯ 6.1: æ³¨å…¥è¯­æ³•é”™è¯¯

```dbml
// âŒ é”™è¯¯
TablePartial base_template {
  id integer [pk]
}

Table users {
  base_template        // ç¼ºå°‘ ~ å‰ç¼€
  name varchar
}

// âœ… æ­£ç¡®
Table users {
  ~base_template       // å¿…é¡»æœ‰ ~ å‰ç¼€
  name varchar
}
```

#### é”™è¯¯ 6.2: å¾ªç¯å¼•ç”¨

```dbml
// âŒ é”™è¯¯
TablePartial A {
  ~B
}

TablePartial B {
  ~A
}

// ä¼šå¯¼è‡´æ— é™å¾ªç¯
```

### 7. æ³¨é‡Šå’Œå­—ç¬¦ä¸²é”™è¯¯

#### é”™è¯¯ 7.1: å¤šè¡Œå­—ç¬¦ä¸²å¼•å·é”™è¯¯

```dbml
// âŒ é”™è¯¯
Note: """
  This is wrong
"""

Note: '
  This is also wrong
'

// âœ… æ­£ç¡®
Note: '''
  This is correct
'''
```

#### é”™è¯¯ 7.2: ç‰¹æ®Šå­—ç¬¦æœªè½¬ä¹‰

```dbml
// âŒ é”™è¯¯
Note: '''
  Path: C:\Users\data   // \ éœ€è¦è½¬ä¹‰
'''

// âœ… æ­£ç¡®
Note: '''
  Path: C:\\Users\\data
'''
```

### 8. SQL è½¬ DBML é”™è¯¯

#### é”™è¯¯ 8.1: ä¸æ”¯æŒçš„ SQL è¯­æ³•

```sql
-- âŒ SQL åŒ…å« DBML ä¸æ”¯æŒçš„ç‰¹æ€§
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  data JSON DEFAULT '{}',           -- JSON é»˜è®¤å€¼
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CHECK (age > 0)                   -- CHECK çº¦æŸ
);
```

**è§£å†³æ–¹æ¡ˆ**:

```dbml
Table users {
  id integer [pk, increment]
  data json [default: `'{}'`]       // ç”¨è¡¨è¾¾å¼åŒ…è£¹ JSON
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  age integer [note: 'CHECK: age > 0']  // ç”¨æ³¨é‡Šè¯´æ˜çº¦æŸ
}
```

#### é”™è¯¯ 8.2: sql2dbml è§£æå¤±è´¥

```bash
# å¸¸è§åŸå› 
1. SQL æ–¹è¨€ç‰¹å®šè¯­æ³• (Oracle, SQL Server ç‰¹æœ‰)
2. å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾
3. åˆ†åŒºè¡¨ã€ç»§æ‰¿è¡¨
4. è‡ªå®šä¹‰ç±»å‹

# è§£å†³æ–¹æ¡ˆ
1. æ¸…ç† SQL: åªä¿ç•™ CREATE TABLE è¯­å¥
2. ç§»é™¤æ–¹è¨€ç‰¹å®šè¯­æ³•
3. æ‰‹åŠ¨è½¬æ¢å¤æ‚ç»“æ„
```

---

## ğŸ” è°ƒè¯•æ–¹æ³•

### 1. ä½¿ç”¨ dbdiagram.io åœ¨çº¿éªŒè¯

```
æ­¥éª¤:
1. æ‰“å¼€ https://dbdiagram.io
2. ç²˜è´´ DBML ä»£ç 
3. æŸ¥çœ‹é”™è¯¯æç¤º (çº¢è‰²ä¸‹åˆ’çº¿)
4. é¼ æ ‡æ‚¬åœæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
```

### 2. ä½¿ç”¨ DBML CLI æœ¬åœ°éªŒè¯

```bash
# å®‰è£…
npm install -g @dbml/cli

# è½¬æ¢ä¸º SQL (éªŒè¯è¯­æ³•)
dbml2sql schema.dbml --postgres

# å¦‚æœæœ‰é”™è¯¯ä¼šæ˜¾ç¤º:
# Error: Syntax error at line 10, column 15
```

### 3. ä½¿ç”¨ VSCode æ’ä»¶å®æ—¶æ£€æŸ¥

```
1. å®‰è£… "dbml-language" æ’ä»¶
2. æ‰“å¼€ .dbml æ–‡ä»¶
3. é”™è¯¯ä¼šå®æ—¶é«˜äº®æ˜¾ç¤º
```

### 4. é€æ­¥æ’æŸ¥æ³•

```dbml
// æ­¥éª¤ 1: æµ‹è¯•åŸºæœ¬ç»“æ„
Table test { id integer }

// æ­¥éª¤ 2: é€æ­¥æ·»åŠ åˆ—
Table test {
  id integer
  name varchar  // åŠ ä¸€åˆ—
}

// æ­¥éª¤ 3: æ·»åŠ è®¾ç½®
Table test {
  id integer [pk]
  name varchar [not null]
}

// æ­¥éª¤ 4: æ·»åŠ å…³ç³»
// ...
```

---

## ğŸ“‹ é”™è¯¯æ£€æŸ¥æ¸…å•

### è¯­æ³•æ£€æŸ¥

- [ ] æ‰€æœ‰æ•°æ®ç±»å‹æ˜¯å•ä¸ªå•è¯ (æ— ç©ºæ ¼)
- [ ] å­—ç¬¦ä¸²ç”¨å•å¼•å· `'string'`
- [ ] è¡¨è¾¾å¼ç”¨åå¼•å· `` `expr` ``
- [ ] å˜é‡åå¼•ç”¨ç”¨åŒå¼•å· `"name"`
- [ ] å¤šè¡Œå­—ç¬¦ä¸²ç”¨ä¸‰å•å¼•å· `'''...'''`
- [ ] å¤åˆç´¢å¼•ç”¨æ‹¬å· `(col1, col2)`

### å…³ç³»æ£€æŸ¥

- [ ] å…³ç³»ç¬¦å·æ–¹å‘æ­£ç¡® (`<`, `>`, `-`, `<>`)
- [ ] One-to-One å¤–é”®ä½ç½®æ˜ç¡®
- [ ] å¤åˆå¤–é”®ç”¨æ‹¬å· `(col1, col2)`
- [ ] è·¨ Schema å¼•ç”¨æŒ‡å®š Schema

### æ•°æ®å®Œæ•´æ€§

- [ ] ä¸»é”®æœªé‡å¤å®šä¹‰
- [ ] æšä¸¾åç§°æ— å†²çª
- [ ] å¤–é”®å¼•ç”¨çš„åˆ—å­˜åœ¨
- [ ] é»˜è®¤å€¼ç±»å‹åŒ¹é…

### æ¨¡æ¿å’Œç»„ç»‡

- [ ] TablePartial æ³¨å…¥ç”¨ `~` å‰ç¼€
- [ ] TableGroup åŒ…å«çš„è¡¨å­˜åœ¨
- [ ] æ— å¾ªç¯å¼•ç”¨

---

## ğŸ› ï¸ å·¥å…·æ¨è

### åœ¨çº¿å·¥å…·

1. **dbdiagram.io** - å®æ—¶è¯­æ³•æ£€æŸ¥å’Œå¯è§†åŒ–
2. **dbdocs.io** - æ–‡æ¡£ç”Ÿæˆå’ŒéªŒè¯

### æœ¬åœ°å·¥å…·

1. **@dbml/cli** - å‘½ä»¤è¡ŒéªŒè¯å·¥å…·
2. **VSCode dbml-language** - è¯­æ³•é«˜äº®å’Œé”™è¯¯æç¤º
3. **dbml-language-server** (Rust) - LSP æ”¯æŒ

### å¼€å‘å·¥å…·

1. **PyDBML** (Python) - Python è§£æå™¨
2. **dbml-go** (Go) - Go è§£æå™¨
3. **dbml-parser** (PHP) - PHP è§£æå™¨

---

## ğŸ“š å‚è€ƒèµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://dbml.dbdiagram.io/docs/
- **GitHub Issues**: https://github.com/holistics/dbml/issues
- **ç¤¾åŒºè®ºå›**: https://community.dbdiagram.io/
- **Stack Overflow**: æœç´¢ `[dbml]` æ ‡ç­¾

---

**æ–‡æ¡£æ›´æ–°**: 2025-10-13
**æ¥æº**: GitHub Issues, Community Forum, å®è·µç»éªŒæ€»ç»“
