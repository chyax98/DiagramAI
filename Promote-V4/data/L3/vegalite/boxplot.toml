# ============================================
# L3 类型层 - Vega-Lite Boxplot v1.0.0
# ============================================

[meta]
level = "L3"
language = "vegalite"
diagram_type = "boxplot"
version = "1.0.0"
description = "Vega-Lite 箱线图规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选元数据
complexity = "medium"
target_length = 2600
use_cases = ["数据分布分析", "离群点检测", "分组对比", "统计摘要"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "统计分析专家 - 精通箱线图的统计学原理和数据分布分析",
  "箱线图专家 - 擅长箱线图的设计和离群点识别"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **mark 类型固定**: 箱线图必须使用 `"boxplot"` 标记类型:
  - ✅ **正确**: `"mark": "boxplot"` 或 `"mark": {"type": "boxplot"}`
  - ❌ **错误**: `"mark": "box"` 或 `"mark": "whisker"`
  - boxplot 是 Vega-Lite 的复合标记类型
  """,

  """
  **坐标轴配置**: 箱线图的坐标轴配置有特定要求:
  - **分类轴**: x 轴（类别），使用 `nominal` 或 `ordinal` 类型
  - **数值轴**: y 轴（数值），使用 `quantitative` 类型
  - **垂直箱线图**: x 分类 + y 数值（常见）
  - **水平箱线图**: x 数值 + y 分类（x 和 y 互换）
  """,

  """
  **数据格式**: 箱线图的数据格式要求:
  - **原始数据**: `[{"category": "A", "value": 10}]` - Vega-Lite 自动计算统计量
  - **展平格式**: 每行一个数据点（非聚合数据）
  - Vega-Lite 会自动计算中位数、四分位数、离群点
  """,

  """
  **extent 参数**: 控制须线（whisker）的长度:
  - `"extent": 1.5` - 标准 1.5 倍 IQR（默认，推荐）
  - `"extent": "min-max"` - 须线延伸到最小/最大值
  - `"extent": 3.0` - 3 倍 IQR（更保守的离群点判定）
  """,

  """
  **分组箱线图**: 使用 `color` 通道创建分组箱线图:
  - 数据需要包含分组字段
  - color 通道使用 `nominal` 类型
  - 自动并排显示不同组的箱线图
  """,

  """
  **tooltip 启用**: 建议启用交互提示:
  - 使用 `"tooltip": true` 显示统计摘要
  - 提示包含: 最小值、Q1、中位数、Q3、最大值
  """,

  """
  **outliers 控制**: 可选择是否显示离群点:
  - 默认显示离群点（超出 1.5 倍 IQR 的数据点）
  - 离群点使用点标记显示
  """,

  """
  **坐标轴范围**: 建议让坐标轴自动调整:
  - 不设置 `scale.zero`（让数据决定范围）
  - 确保离群点和须线都在可见范围内
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 识别箱线图类型**:
  - **简单箱线图**: 单一类别的数据分布
  - **分组箱线图**: 多个类别的数据分布对比
  - **分组分层箱线图**: 使用 color 通道进一步分组
  """,

  """
  **2. 准备数据结构**:
  - **简单箱线图**: `[{"category": "A", "value": 10}]`
  - **分组箱线图**: `[{"category": "A", "group": "G1", "value": 10}]`
  - 使用原始数据（非聚合数据）
  - Vega-Lite 会自动计算统计量
  """,

  """
  **3. 配置坐标轴**:
  - **垂直箱线图**: x 轴分类（nominal） + y 轴数值（quantitative）
  - **水平箱线图**: x 轴数值（quantitative） + y 轴分类（nominal）
  - 添加坐标轴标题
  """,

  """
  **4. 设置箱线图参数**:
  - 设置 `extent`（默认 1.5 即可）
  - 分组箱线图使用 `color` 通道
  - 添加图例标题（分组箱线图）
  """,

  """
  **5. 优化交互和样式**:
  - 启用 tooltip
  - 设置合理的尺寸
  - 单一箱线图使用 `mark.color` 设置颜色
  - 分组箱线图使用 `scale.range` 自定义颜色
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **统计正确性**:
  - Vega-Lite 正确计算中位数、四分位数
  - 离群点判定准确（1.5 倍 IQR）
  - 须线长度符合 extent 设置
  """,

  """
  **坐标轴类型正确性**:
  - 分类轴使用 `nominal` 或 `ordinal`
  - 数值轴使用 `quantitative`
  - 类型选择符合数据语义
  """,

  """
  **数据格式正确性**:
  - 使用原始数据（非聚合）
  - 数据格式为展平格式
  - 字段名与 encoding 一致
  """,

  """
  **可读性**:
  - 箱线图清晰展示数据分布
  - 离群点清晰可辨
  - 分组箱线图颜色区分明显
  - 图例和坐标轴标题清晰
  """
]

# ============================================
# Section 5: 使用场景 (Use Cases)
# ============================================

[[use_cases]]
title = "学生成绩分布分析"
scenario = "展示不同班级学生成绩的分布情况，识别离群点和中位数"
key_points = [
  "x 轴班级，y 轴成绩",
  "使用原始成绩数据",
  "Vega-Lite 自动计算中位数、四分位数",
  "离群点表示异常高分或低分学生"
]

[[use_cases]]
title = "产品价格分布对比"
scenario = "对比不同品牌产品的价格分布，识别价格区间和离群点"
key_points = [
  "使用分组箱线图（color 通道）",
  "每个品牌显示独立的箱线图",
  "识别高价和低价离群产品"
]

[[use_cases]]
title = "实验数据统计分析"
scenario = "展示实验数据的统计分布，评估数据质量和一致性"
key_points = [
  "extent: 1.5（标准离群点判定）",
  "tooltip 显示统计摘要",
  "识别实验中的异常数据点"
]

[[use_cases]]
title = "员工薪资分布分析"
scenario = "展示不同部门员工薪资的分布情况，识别薪资差异和离群点"
key_points = [
  "x 轴部门，y 轴薪资",
  "水平箱线图（适合显示薪资范围）",
  "离群点表示异常高薪或低薪员工"
]
