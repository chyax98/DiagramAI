# D2 å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

> åŸºäºç¤¾åŒºé—®é¢˜å’Œå®˜æ–¹æ•…éšœæ’æŸ¥æ•´ç† | æœ€åæ›´æ–°: 2025-10-13

---

## ğŸš¨ è¯­æ³•é”™è¯¯

### 1. å…¨è§’å­—ç¬¦é—®é¢˜

**é”™è¯¯ç°è±¡**:
```d2
# âŒ ä½¿ç”¨ä¸­æ–‡è¾“å…¥æ³•çš„å…¨è§’ç¬¦å·
xï¼šlabel
aï¼›b
cã€‚d
```

**é”™è¯¯ä¿¡æ¯**:
```
Error: syntax error near line 1
```

**åŸå› **:
- ä¸­æ–‡è¾“å…¥æ³•çš„å…¨è§’å†’å· `ï¼š` â‰  ASCII å†’å· `:`
- D2 ä»…è¯†åˆ« ASCII ç‰¹æ®Šå­—ç¬¦

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… åˆ‡æ¢åˆ°è‹±æ–‡è¾“å…¥æ³•
x: label
a; b
c.d
```

**é¢„é˜²æªæ–½**:
- âš ï¸ ç¼–å†™ D2 ä»£ç æ—¶å§‹ç»ˆä½¿ç”¨è‹±æ–‡è¾“å…¥æ³•
- âš ï¸ ç‰¹åˆ«æ³¨æ„: `:`, `;`, `.`, `-`, `_` ç­‰ç¬¦å·
- âš ï¸ æ ‡ç­¾å†…å®¹å¯ä»¥ä½¿ç”¨ä¸­æ–‡,ä½†è¯­æ³•ç¬¦å·å¿…é¡»æ˜¯ ASCII

---

### 2. å¼•ç”¨æ ‡ç­¾è€Œéé”®å

**é”™è¯¯ç°è±¡**:
```d2
# âŒ é”™è¯¯ç¤ºä¾‹
backend: Backend Server
frontend: Frontend Application

# å°è¯•è¿æ¥ (ä¼šåˆ›å»ºæ–°å½¢çŠ¶è€Œéå¼•ç”¨å·²æœ‰å½¢çŠ¶)
Backend Server -> Frontend Application
```

**ç»“æœ**:
- åˆ›å»ºäº† 4 ä¸ªå½¢çŠ¶è€Œé 2 ä¸ª
- åŸæœ‰çš„ `backend` å’Œ `frontend` æœªè¿æ¥

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… æ­£ç¡®: ä½¿ç”¨é”®å
backend: Backend Server
frontend: Frontend Application

backend -> frontend
# æˆ–å¸¦æ ‡ç­¾
backend -> frontend: API calls
```

**æœ€ä½³å®è·µ**:
```d2
# æ–¹æ¡ˆ 1: é”®åå’Œæ ‡ç­¾ç›¸åŒ
Backend -> Frontend

# æ–¹æ¡ˆ 2: é”®åç®€çŸ­,æ ‡ç­¾æè¿°æ€§
be: Backend Server
fe: Frontend Application
be -> fe: API calls
```

---

### 3. è·¯å¾„å¼•ç”¨é”™è¯¯

**é”™è¯¯ç°è±¡**:
```d2
# âŒ è·¨å®¹å™¨å¼•ç”¨ä¸å®Œæ•´
network: {
  api
}
database: {
  db
}
api -> db  # é”™è¯¯: åˆ›å»ºæ–°çš„é¡¶å±‚ api å’Œ db
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… ä½¿ç”¨å®Œæ•´è·¯å¾„
network: {
  api
}
database: {
  db
}
network.api -> database.db
```

---

### 4. å•è¿å­—ç¬¦è¯¯ç”¨

**é”™è¯¯ç°è±¡**:
```d2
# âŒ æœŸæœ›è¿æ¥ä½†å®é™…åˆ›å»ºå½¢çŠ¶
x - y  # è¿™æ˜¯ä¸€ä¸ªé”®åä¸º "x - y" çš„å½¢çŠ¶,ä¸æ˜¯è¿æ¥
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… è¿æ¥å¿…é¡»ä½¿ç”¨åŒè¿å­—ç¬¦æˆ–ç®­å¤´
x -- y   # æ— å‘è¿æ¥
x -> y   # å³å‘ç®­å¤´
x <- y   # å·¦å‘ç®­å¤´
x <-> y  # åŒå‘ç®­å¤´
```

---

### 5. ç‰¹æ®Šå­—ç¬¦æœªå¼•ç”¨

**é”™è¯¯ç°è±¡**:
```d2
# âŒ æ ‡ç­¾åŒ…å«ç‰¹æ®Šå­—ç¬¦ä½†æœªåŠ å¼•å·
x: Hello: World
y -> z: Error; here
```

**é”™è¯¯ä¿¡æ¯**:
```
Error: syntax error near ':'
Error: syntax error near ';'
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… åŒ…å«ç‰¹æ®Šå­—ç¬¦æ—¶åŠ å¼•å·
x: "Hello: World"
y -> z: "Error; here"

# æˆ–ä½¿ç”¨å•å¼•å·
x: 'Hello: World'
y -> z: 'Error; here'
```

**éœ€è¦å¼•å·çš„åœºæ™¯**:
- åŒ…å«: `:`, `;`, `.`, `{`, `}`, `[`, `]`, `|`, `#`
- å‰åæœ‰ç©ºæ ¼çš„æ ‡ç­¾

---

## ğŸ¨ æ ·å¼é”™è¯¯

### 6. é¢œè‰²æ ¼å¼é”™è¯¯

**é”™è¯¯ç°è±¡**:
```d2
# âŒ ç¼ºå°‘å¼•å·çš„ RGB/RGBA
x.style.fill: rgb(255, 0, 0)
y.style.fill: rgba(0, 255, 0, 0.5)
```

**é”™è¯¯ä¿¡æ¯**:
```
Error: invalid color format
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… RGB/RGBA å¿…é¡»åŠ å¼•å·
x.style.fill: "rgb(255, 0, 0)"
y.style.fill: "rgba(0, 255, 0, 0.5)"

# âœ… åå…­è¿›åˆ¶å¯ä¸åŠ å¼•å·
z.style.fill: "#FF0000"
z.style.fill: red  # é¢œè‰²åä¹Ÿå¯ä¸åŠ å¼•å·
```

---

### 7. æ ·å¼å±æ€§åé”™è¯¯

**é”™è¯¯ç°è±¡**:
```d2
# âŒ ä½¿ç”¨ CSS å±æ€§å
x.style.background: red
x.style.color: blue
x.style.border: 1px solid black
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… ä½¿ç”¨ D2 æ ·å¼å±æ€§å
x.style.fill: red             # ä¸æ˜¯ background
x.style.font-color: blue      # ä¸æ˜¯ color
x.style.stroke: black         # ä¸æ˜¯ border-color
x.style.stroke-width: 1       # ä¸æ˜¯ border-width
```

**å¸¸ç”¨æ˜ å°„**:
| CSS | D2 |
|-----|-----|
| `background` | `fill` |
| `color` | `font-color` |
| `border-color` | `stroke` |
| `border-width` | `stroke-width` |
| `border-style: dashed` | `stroke-dash: 3` |

---

### 8. å¸ƒå°”å€¼å¤§å†™é”™è¯¯

**é”™è¯¯ç°è±¡**:
```d2
# âŒ å¤§å†™å¸ƒå°”å€¼
x.style.bold: True
y.style.italic: FALSE
z.style.shadow: 1
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… å°å†™å¸ƒå°”å€¼
x.style.bold: true
y.style.italic: false
z.style.shadow: true  # ä¸èƒ½ç”¨ 1/0
```

---

## ğŸ”— è¿æ¥é”™è¯¯

### 9. é‡å¤è¿æ¥è¯¯è§£

**é”™è¯¯ç°è±¡**:
```d2
# ç”¨æˆ·æœŸæœ›: æ›´æ–°è¿æ¥æ ‡ç­¾
Database -> S3: backup
Database -> S3: daily backup  # æœŸæœ›æ›¿æ¢æ ‡ç­¾
```

**å®é™…ç»“æœ**:
- åˆ›å»ºäº†ä¸¤æ¡ç‹¬ç«‹çš„è¿æ¥
- ç¬¬ä¸€æ¡æ ‡ç­¾ "backup",ç¬¬äºŒæ¡æ ‡ç­¾ "daily backup"

**è§£å†³æ–¹æ¡ˆ**:
```d2
# æ–¹æ¡ˆ 1: åªå®šä¹‰ä¸€æ¬¡
Database -> S3: daily backup

# æ–¹æ¡ˆ 2: å¼•ç”¨å¹¶ä¿®æ”¹ç‰¹å®šè¿æ¥
Database -> S3: backup
Database -> S3: daily backup
(Database -> S3)[0].style.stroke: red   # ç¬¬ä¸€æ¡
(Database -> S3)[1].style.stroke: blue  # ç¬¬äºŒæ¡
```

---

### 10. ç®­å¤´å¤´éƒ¨æœªç”Ÿæ•ˆ

**é”™è¯¯ç°è±¡**:
```d2
# âŒ è¿æ¥æ²¡æœ‰ç«¯ç‚¹,ç®­å¤´å¤´éƒ¨ä¸æ˜¾ç¤º
x -> y: {
  source-arrowhead.shape: diamond  # ä½† x -> y æœ‰æºç«¯ç‚¹
}

a -- b: {
  source-arrowhead.shape: diamond  # æ— æ•ˆ: -- æ— æ–¹å‘
}
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… ç¡®ä¿è¿æ¥æœ‰å¯¹åº”ç«¯ç‚¹
x -> y: {
  source-arrowhead.shape: diamond  # âœ… -> æœ‰æºç«¯ç‚¹
  target-arrowhead.shape: circle   # âœ… -> æœ‰ç›®æ ‡ç«¯ç‚¹
}

# âœ… æ— å‘è¿æ¥æ— æ³•è®¾ç½®ç®­å¤´
a -- b  # æ­£ç¡®: ä¸å°è¯•è®¾ç½®ç®­å¤´
```

---

## ğŸ“ å¸ƒå±€é”™è¯¯

### 11. å…ƒç´ é‡å 

**é”™è¯¯ç°è±¡**:
- èŠ‚ç‚¹äº’ç›¸é‡å 
- æ–‡æœ¬è¢«é®æŒ¡
- è¿çº¿ç©¿è¿‡å½¢çŠ¶

**åŸå› **:
- ä½¿ç”¨äº†ä¸åˆé€‚çš„å¸ƒå±€å¼•æ“
- å½¢çŠ¶å°ºå¯¸è®¾ç½®è¿‡å¤§/è¿‡å°
- å¤æ‚åµŒå¥—ç»“æ„

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å°è¯•ä¸åŒå¸ƒå±€å¼•æ“
d2 -l dagre input.d2   # é»˜è®¤,é€‚åˆç®€å•å›¾
d2 -l elk input.d2     # é€‚åˆå¤æ‚åµŒå¥—
d2 -l tala input.d2    # æœ€ä¼˜è´¨é‡ (ä»˜è´¹)
```

```d2
# è°ƒæ•´é—´è·
vars: {
  d2-config: {
    layout-engine: elk
  }
}

# æ‰‹åŠ¨è®¾ç½®å°ºå¯¸
large_node: {
  width: 200
  height: 100
}
```

---

### 12. æ–‡æœ¬è¿‡é•¿

**é”™è¯¯ç°è±¡**:
- æ ‡ç­¾æ–‡æœ¬è¶…å‡ºå½¢çŠ¶è¾¹ç•Œ
- æ–‡æœ¬æ˜¾ç¤ºè¢«æˆªæ–­

**è§£å†³æ–¹æ¡ˆ**:
```d2
# æ–¹æ¡ˆ 1: æ·»åŠ æ¢è¡Œç¬¦
x: "Very long text\nbroken into\nmultiple lines"

# æ–¹æ¡ˆ 2: ä½¿ç”¨å—å­—ç¬¦ä¸²
x: |
  Very long text
  broken into
  multiple lines
|

# æ–¹æ¡ˆ 3: å¢åŠ å½¢çŠ¶å®½åº¦
x: Very long text {
  width: 300
}
```

---

### 13. è¿çº¿æ··ä¹±

**é”™è¯¯ç°è±¡**:
- è¿çº¿ç©¿è¿‡æ— å…³å¯¹è±¡
- è¿çº¿äº¤å‰è¿‡å¤š
- å¸ƒå±€ä¸æ¸…æ™°

**è§£å†³æ–¹æ¡ˆ**:
```d2
# æ–¹æ¡ˆ 1: ä½¿ç”¨ ELK å¸ƒå±€å¼•æ“
vars: {
  d2-config: {
    layout-engine: elk
  }
}

# æ–¹æ¡ˆ 2: è°ƒæ•´èŠ‚ç‚¹é¡ºåºå’Œåˆ†ç»„
# å°†ç›¸å…³èŠ‚ç‚¹æ”¾åœ¨åŒä¸€å®¹å™¨ä¸­
frontend: {
  ui
  router
}
backend: {
  api
  database
}

# æ–¹æ¡ˆ 3: ä½¿ç”¨ direction æ§åˆ¶æµå‘
direction: down  # æˆ– up, left, right
```

---

## ğŸ–¼ï¸ æ¸²æŸ“é”™è¯¯

### 14. SVG æ— äº¤äº’æ€§

**é”™è¯¯ç°è±¡**:
- åœ¨æŸäº›ç¯å¢ƒä¸­ SVG çš„é“¾æ¥å’Œå·¥å…·æç¤ºä¸å·¥ä½œ

**åŸå› **:
- SVG è¢«ä½œä¸º `<img>` æ ‡ç­¾åµŒå…¥,ç¦ç”¨äº†äº¤äº’æ€§

**è§£å†³æ–¹æ¡ˆ**:
```html
<!-- âŒ ä½œä¸ºå›¾ç‰‡åµŒå…¥ (æ— äº¤äº’) -->
<img src="diagram.svg">

<!-- âœ… ä½œä¸ºå¯¹è±¡åµŒå…¥ (æœ‰äº¤äº’) -->
<object data="diagram.svg" type="image/svg+xml"></object>

<!-- âœ… ç›´æ¥å†…è” SVG -->
<div>
  <!-- SVG å†…å®¹ -->
</div>
```

---

### 15. HTML åœ¨ Markdown ä¸­æ–­è£‚

**é”™è¯¯ç°è±¡**:
```d2
# âŒ éè¯­ä¹‰åŒ– HTML
description: |md
  Line 1<br>
  Line 2<br>
  Line 3
|
```

**é”™è¯¯ä¿¡æ¯**:
```
SVG parse error: unclosed tag <br>
```

**è§£å†³æ–¹æ¡ˆ**:
```d2
# âœ… ä½¿ç”¨è¯­ä¹‰åŒ– HTML
description: |md
  Line 1<br/>
  Line 2<br/>
  Line 3
|
```

**è§„åˆ™**:
- ä½¿ç”¨ `<br/>` è€Œé `<br>`
- ä½¿ç”¨ `<img/>` è€Œé `<img>`
- æ‰€æœ‰æ ‡ç­¾å¿…é¡»é—­åˆ

---

## ğŸ”§ CLI é”™è¯¯

### 16. ç›‘å¬æ¨¡å¼ä¸åˆ·æ–°

**é”™è¯¯ç°è±¡**:
```bash
d2 --watch input.d2 output.svg
# æ–‡ä»¶ä¿®æ”¹åå›¾åƒä¸æ›´æ–°
```

**åŸå› **:
- æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶æœªè§¦å‘
- è¾“å‡ºæ–‡ä»¶è¢«å…¶ä»–ç¨‹åºé”å®š

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆ 1: ä½¿ç”¨æ›´çŸ­çš„è½®è¯¢é—´éš”
d2 --watch --watch-interval 100 input.d2

# æ–¹æ¡ˆ 2: æ‰‹åŠ¨ä¿å­˜æ–‡ä»¶è§¦å‘
# åœ¨ç¼–è¾‘å™¨ä¸­ç¡®ä¿ä¿å­˜æˆåŠŸ

# æ–¹æ¡ˆ 3: æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la input.d2 output.svg
```

---

### 17. ä¸»é¢˜ä¸ç”Ÿæ•ˆ

**é”™è¯¯ç°è±¡**:
```bash
d2 --theme 300 input.d2 output.svg
# å›¾åƒä»ä½¿ç”¨é»˜è®¤ä¸»é¢˜
```

**åŸå› **:
- æ–‡ä»¶ä¸­å·²å®šä¹‰ `vars.d2-config.theme-id`
- CLI å‚æ•°è¢«è¦†ç›–

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆ 1: ç§»é™¤æ–‡ä»¶ä¸­çš„ä¸»é¢˜é…ç½®
# input.d2 ä¸­åˆ é™¤:
vars: {
  d2-config: {
    theme-id: 100  # åˆ é™¤æ­¤è¡Œ
  }
}

# æ–¹æ¡ˆ 2: ä½¿ç”¨ --force-theme (å¦‚æœæ”¯æŒ)
d2 --theme 300 --force input.d2
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### é”™è¯¯é¢„é˜²

1. **ä½¿ç”¨è¯­æ³•é«˜äº®ç¼–è¾‘å™¨**
   - VSCode: å®‰è£… D2 æ‰©å±•
   - Vim: å®‰è£… D2 æ’ä»¶

2. **å¯ç”¨è‡ªåŠ¨æ ¼å¼åŒ–**
   ```bash
   d2 fmt input.d2
   ```

3. **ä½¿ç”¨ Playground éªŒè¯**
   - https://play.d2lang.com/
   - å¿«é€Ÿæµ‹è¯•è¯­æ³•æ­£ç¡®æ€§

4. **ä¿æŒæ–‡ä»¶å°è€Œç®€å•**
   - è¶…è¿‡ 100 ä¸ªèŠ‚ç‚¹æ—¶è€ƒè™‘æ‹†åˆ†
   - ä½¿ç”¨ `imports` ç»„ç»‡å¤§å‹å›¾è¡¨

5. **æ¸è¿›å¼æ„å»º**
   ```d2
   # ç¬¬ 1 æ­¥: å®šä¹‰å½¢çŠ¶
   api; database; cache

   # ç¬¬ 2 æ­¥: å®šä¹‰è¿æ¥
   api -> database
   api -> cache

   # ç¬¬ 3 æ­¥: æ·»åŠ æ ·å¼
   api.style.fill: blue
   ```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨è¯¦ç»†è¾“å‡º

```bash
d2 -v input.d2  # æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
```

### 2. å¢é‡æµ‹è¯•

```d2
# æ³¨é‡Šæ‰éƒ¨åˆ†ä»£ç ,é€æ­¥å¯ç”¨
# x -> y
# y -> z
z -> a  # ä»è¿™é‡Œå¼€å§‹æµ‹è¯•
```

### 3. æ£€æŸ¥è¾“å‡ºæ ¼å¼

```bash
# ç¡®è®¤ D2 ç‰ˆæœ¬
d2 --version

# æŸ¥çœ‹æ”¯æŒçš„è¾“å‡ºæ ¼å¼
d2 --help
```

### 4. ç¤¾åŒºæ±‚åŠ©

- **Discord**: https://discord.com/invite/pbUXgvmTpU
- **GitHub Issues**: https://github.com/terrastruct/d2/issues
- **Stack Overflow**: ä½¿ç”¨ `[d2lang]` æ ‡ç­¾

---

## ğŸ“š å‚è€ƒèµ„æº

- **æ•…éšœæ’æŸ¥æŒ‡å—**: https://d2lang.com/tour/troubleshoot/
- **å¸¸è§é—®é¢˜ FAQ**: https://d2lang.com/tour/faq/
- **è¯­æ³•è§„åˆ™**: https://d2lang.com/tour/strings/
- **ç¤¾åŒºè®¨è®º**: https://github.com/terrastruct/d2/discussions

---

**æœ€åæ›´æ–°**: 2025-10-13
