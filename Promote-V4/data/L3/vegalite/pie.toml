# ============================================
# L3 类型层 - Vega-Lite Pie Chart v1.0.0
# ============================================

[meta]
level = "L3"
language = "vegalite"
diagram_type = "pie"
version = "1.0.0"
description = "Vega-Lite 饼图规范"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 可选元数据
complexity = "medium"
target_length = 2600
use_cases = ["比例分布", "市场份额", "流量来源", "预算分配"]

# ============================================
# Section 1: D 角色定义 (Role Definition)
# ============================================

[D_role]
additional_roles = [
  "比例数据可视化专家 - 精通百分比、比例和构成数据的展示",
  "饼图专家 - 擅长饼图和环形图的设计与实现"
]

# ============================================
# Section 2: E 约束条件 (Constraints)
# ============================================

[E_constraints]
items = [
  """
  **mark 类型固定**: 饼图必须使用 `"arc"` 标记类型:
  - ✅ **正确**: `"mark": "arc"` 或 `"mark": {"type": "arc"}`
  - ❌ **错误**: `"mark": "pie"` 或 `"mark": "bar"`
  - 饼图在 Vega-Lite 中使用 arc（弧形）标记
  """,

  """
  **theta 通道必需**: 饼图必须使用 `theta` 通道表示角度:
  - ✅ **必须**: `"theta": {"field": "value", "type": "quantitative"}`
  - theta 通道使用 `quantitative` 类型（数值决定角度大小）
  - 数值越大，扇形角度越大
  """,

  """
  **color 通道类型**: 使用 `color` 通道区分不同类别:
  - ✅ **正确**: `"color": {"field": "category", "type": "nominal"}`
  - color 通道使用 `nominal` 类型（类别决定颜色）
  - 添加图例标题（`legend.title`）
  """,

  """
  **去除外边框**: 必须去除默认的外边框:
  - ✅ **必需**: `"view": {"stroke": null}`
  - 默认会有外边框，影响美观
  - 使用 `stroke: null` 去除
  """,

  """
  **类别数量限制**: 饼图适合 3-7 个类别:
  - ✅ **推荐**: 3-7 个类别
  - ❌ **不推荐**: >10 个类别（改用柱状图）
  - 过多类别应合并为"其他"
  """,

  """
  **环形图实现**: 使用 `innerRadius` 创建环形图:
  - 使用 `"innerRadius": 60` 创建中空效果
  - `innerRadius` 约为 `outerRadius` 的 1/2
  - 环形图比饼图更现代、更易读
  """,

  """
  **标签图层**: 使用 `layer` 添加百分比标签:
  - 第一层: arc（饼图本体）
  - 第二层: text（百分比标签）
  - 使用 `radius` 控制标签位置
  """,

  """
  **tooltip 必需**: 饼图必须启用交互提示:
  - 使用 `"tooltip": true` 提升交互性
  - 帮助用户查看具体数值和百分比
  """
]

# ============================================
# Section 3: P 流程规范 (Process)
# ============================================

[P_process]
items = [
  """
  **1. 识别饼图类型**:
  - **基础饼图**: 简单的比例分布
  - **环形图**: 使用 innerRadius 创建中空效果
  - **带标签饼图**: 使用 layer 添加百分比标签
  """,

  """
  **2. 准备数据结构**:
  - **饼图**: `[{"category": "A", "value": 40}]`
  - **带标签**: `[{"category": "A", "value": 40, "label": "40%"}]`
  - 确保类别数量合理（3-7 个）
  - 过多类别合并为"其他"
  """,

  """
  **3. 配置 theta 和 color**:
  - theta 通道使用 `quantitative` 类型（数值决定角度）
  - color 通道使用 `nominal` 类型（类别决定颜色）
  - 添加图例标题
  """,

  """
  **4. 设置样式**:
  - 使用 `outerRadius` 控制饼图大小
  - 环形图使用 `innerRadius`（约为 outerRadius 的 1/2）
  - 去除外边框（`view.stroke: null`）
  - 使用 `scale.range` 自定义颜色
  """,

  """
  **5. 优化交互和标签**:
  - 启用 tooltip
  - 带标签饼图使用 layer
  - 设置合理的尺寸（width, height）
  - 确保图例清晰
  """
]

# ============================================
# Section 4: H 质量标准 (Quality Standards)
# ============================================

[H_quality]
items = [
  """
  **标记类型正确性**:
  - 使用 `arc` 标记类型
  - theta 通道使用 `quantitative` 类型
  - color 通道使用 `nominal` 类型
  """,

  """
  **外观专业性**:
  - 去除外边框（view.stroke: null）
  - 颜色方案清晰区分
  - 环形图半径比例合理（innerRadius 约为 outerRadius 的 1/2）
  """,

  """
  **类别数量合理性**:
  - 类别数量 3-7 个
  - 过多类别合并为"其他"
  - 每个扇形清晰可辨
  """,

  """
  **图例和交互**:
  - 图例标题清晰
  - 图例标签完整
  - tooltip 启用
  - 交互体验良好
  """
]

# ============================================
# Section 5: 使用场景 (Use Cases)
# ============================================

[[use_cases]]
title = "市场份额分布"
scenario = "展示不同公司的市场份额占比，识别行业格局"
key_points = [
  "使用基础饼图展示市场份额",
  "scale.range 自定义公司品牌颜色",
  "tooltip 显示具体份额和百分比"
]

[[use_cases]]
title = "流量来源分布（环形图）"
scenario = "使用环形图展示网站流量来源分布，更现代美观"
key_points = [
  "使用 innerRadius 创建环形图",
  "innerRadius 约为 outerRadius 的 1/2",
  "中心空白可放置总流量等信息"
]

[[use_cases]]
title = "销售渠道占比（带百分比标签）"
scenario = "展示不同销售渠道的占比，使用百分比标签提升可读性"
key_points = [
  "使用 layer 叠加饼图和文本标签",
  "第一层 arc，第二层 text",
  "radius 控制标签位置（大于 outerRadius 显示在外侧）"
]

[[use_cases]]
title = "预算分配"
scenario = "展示项目预算在不同领域的分配比例"
key_points = [
  "类别数量控制在 3-7 个",
  "过多项目合并为'其他'",
  "颜色方案清晰区分不同领域"
]
