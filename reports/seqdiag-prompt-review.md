# SeqDiag Prompt 系统审查报告

**语言**: SeqDiag
**文件位置**: `/root/Diagram/DiagramAI/src/lib/constants/prompts/seqdiag/`
**审查日期**: 2025-10-13
**审查范围**: L2 (common.txt) + L3 (sequence.txt)

---

## 📊 文件清单

| 文件 | 类型 | 行数 | 功能 |
|------|------|------|------|
| `common.txt` | L2 通用规范 | 372 行 | SeqDiag 语法基础 (最长的 L2) |
| `sequence.txt` | L3 图表类型 | 193 行 | 时序图生成规范 |

**总计**: 565 行

---

## ✅ 优点分析

### 1. L2 通用规范极其详细

**强制规则覆盖核心特性** (4 个规则):
- ✅ 规则 1: `seqdiag {}` 图表声明
- ✅ 规则 2: **返回消息必须使用 `<--`** - SeqDiag 特有,渲染异常级别
- ✅ 规则 3: 中文标签必须使用双引号
- ✅ 规则 4: **激活/失活必须成对出现** - SeqDiag 特有逻辑校验

**核心语法完整** (第 122-239 行,6 个语法点):
- 图表声明、对象定义、消息定义、激活框、分组、注释
- **消息类型详细**: 单向调用 (`->`), 返回消息 (`<--`), 异步消息 (`=>`)

**常见消息类型** (第 241-276 行,4 种):
- 同步调用和返回、异步消息、自调用、多对象交互
- 每种类型都有完整的代码示例

**常见错误** (第 278-334 行,3 个):
- 错误 1: 返回消息方向错误 (`->` vs `<--`)
- 错误 2: 激活未成对 (`activation` 缺少 `deactivation`)
- 错误 3: 中文未引号

**时序图设计原则** (第 337-357 行,4 个原则):
- 消息流向、对象命名、消息标签、激活框使用

**L2 长度**: 372 行 (是所有语言中最长的,但内容充实)

---

### 2. L3 (sequence.txt) 简洁实用

**3 个示例,覆盖真实场景**:
- ✅ 示例 1: 用户登录流程 - 4 个对象,展示请求和返回
- ✅ 示例 2: 电商下单流程 - 6 个对象,展示复杂交互
- ✅ 示例 3: 微服务调用链 - 6 个对象,展示 API 网关和认证流程

**常见错误覆盖** (第 125-182 行,3 个):
- 错误 1: 消息缺少标签
- 错误 2: 对象未定义
- 错误 3: 返回消息使用实线 (应该用虚线)

---

## ⚠️ 问题与改进建议

### 问题 1: L2 过长,包含过多细节

**问题严重性**: 🟡 中等

**当前 L2 长度**: 372 行 (比 RackDiag 的 290 行更长)

**包含的细节内容**:
- 第 241-276 行: **常见消息类型** (4 种,共 36 行) - 应该放在 L3
- 第 278-334 行: **常见错误** (3 个,共 57 行) - 应该精简或移到 L3
- 第 337-357 行: **时序图设计原则** (4 个原则,共 21 行) - 应该放在 L3

**改进建议**:
```markdown
## L2 应该保留的内容 (缩减到约 200 行)
- 强制规则 (4 个,必须保留)
- 专家视角 (简化版本)
- 核心语法 (图表声明、对象定义、消息定义、激活框)
- 生成检查清单 (通用版本)

## L3 应该包含的内容
### sequence.txt
- 常见消息类型 (4 种)
- 时序图设计原则 (4 个)
- 常见错误 (3 个,详细版本)
- 生成示例 (3 个)
```

---

### 问题 2: L2 与 L3 存在内容重复

**重复内容**:
- L2 第 122-239 行: 定义核心语法 (图表声明、对象定义、消息定义)
- L3 (sequence.txt) 第 8-24 行: 再次定义基础时序图语法

**问题严重性**: 🟢 低 (重复内容较少,约 15 行)

**改进建议**:
- 删除 L3 中的基础语法重复
- L3 仅保留该类型特有的示例和设计原则

---

### 问题 3: 缺少 SeqDiag vs Mermaid Sequence 的对比

**发现**: SeqDiag 是 BlockDiag 系列的时序图,语法简化

**当前文件**: 未提及与 Mermaid Sequence 的差异

**改进建议**:
```markdown
## 在 L2 (common.txt) 或 L3 (sequence.txt) 开头添加
> **SeqDiag vs Mermaid Sequence 的核心区别**
> - **SeqDiag**: BlockDiag 风格,语法简化
>   - 消息: `A -> B [label = "message"]`
>   - 返回: `B <-- A [label = "return"]`
>   - 激活: `activation = A; ... deactivation = A;`
> - **Mermaid Sequence**: 功能更丰富,支持循环、条件分支、并行
>   - 消息: `A->>B: message`
>   - 返回: `B-->>A: return`
>   - 激活: `activate A ... deactivate A`
>
> **选择建议**:
> - **简单时序图**: 使用 SeqDiag (语法简洁)
> - **复杂时序图**: 使用 Mermaid Sequence (功能丰富)
```

---

### 问题 4: 激活框语法不够直观

**当前语法**:
```seqdiag
activation = A;
A -> B;
deactivation = A;
```

**问题**: `activation = A` 这种语法不够直观,容易误解为 "A 被激活" 而非 "A 激活自己"

**改进建议**:
```markdown
## 在 L2 中添加说明
### 激活框语法说明
```seqdiag
activation = A;    // A 进入活动期 (开始执行)
A -> B;            // A 向 B 发送消息
deactivation = A;  // A 退出活动期 (执行结束)
```

**语法解释**:
- `activation = A` 表示对象 A 开始执行,生命线上出现激活框
- `deactivation = A` 表示对象 A 执行结束,激活框消失
- 激活和失活必须成对出现,否则激活框渲染异常
```

---

## 📈 量化评分

| 评估维度 | 得分 | 说明 |
|---------|------|------|
| **L2 覆盖度** | 10/10 | 规则最完整,消息类型详细 |
| **L3 示例质量** | 9/10 | 示例实用,覆盖真实场景 |
| **错误预防** | 10/10 | 返回消息方向、激活成对覆盖全面 |
| **内容去重** | 8/10 | 重复内容较少 (约 15 行) |
| **类型特异性** | 8/10 | 时序图特性突出,但缺少与 Mermaid 对比 |
| **可维护性** | 6/10 | L2 过长 (372 行),不易维护 |
| **总体评分** | **8.5/10** | 优秀,但 L2 需要精简 |

---

## 🎯 优先改进建议

### 高优先级 (P0)
1. **精简 L2,将常见消息类型和设计原则移到 L3** - 减少 L2 长度约 45%
2. **删除 L3 中的语法重复内容** - 避免冗余

### 中优先级 (P1)
3. **增加 SeqDiag vs Mermaid Sequence 对比** - 帮助用户选择合适工具
4. **详细说明激活框语法** - 避免误解

---

## 📝 总结

**SeqDiag Prompt 系统整体质量优秀**,**L2 规则最完整,消息类型和设计原则详细**。但 **L2 过长 (372 行),包含过多 L3 特有内容**,建议精简 L2,将常见消息类型和设计原则移到 L3。

**L3 (sequence.txt) 简洁实用**,示例质量高。建议增加 SeqDiag vs Mermaid Sequence 对比,帮助用户选择合适的时序图工具。
