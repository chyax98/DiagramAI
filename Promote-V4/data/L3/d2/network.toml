# ============================================
# L3 类型层: D2 网络拓扑图 (Network Topology Diagram)
# ============================================

[meta]
level = "L3"
language = "d2"
diagram_type = "network"
version = "1.0.0"
description = "D2 网络拓扑图生成规范 - 网络架构、网络安全、数据中心网络、混合云网络"
author = "DiagramAI Team"
created_at = "2025-10-19"
updated_at = "2025-10-19"

# 类型相关元数据
complexity = "high"
target_length = 3000
use_cases = ["网络架构设计", "网络安全拓扑", "数据中心网络", "混合云网络"]

# ============================================
# Section 1: D 角色定义
# ============================================

[D_role]
additional_roles = [
  "网络架构专家 - 理解网络分层 (互联网、DMZ、内网) 和网络设备",
  "D2 网络图工程师 - 精通 D2 容器分区语法和网络设备形状表示",
  "安全可视化审查员 - 确保安全边界清晰、网络流量方向正确、访问控制准确"
]

# ============================================
# Section 2: E 约束条件
# ============================================

[E_constraints]
items = [
  """
  **网络设备形状规范**:
  使用约定俗成的形状表示不同的网络设备:
  - 互联网/云服务: `shape: cloud`
  - 路由器/API网关: `shape: hexagon`
  - 防火墙/交换机/服务器: `shape: rectangle`
  - 数据库: `shape: cylinder`
  - 用户/客户端: `shape: person`
  """,

  """
  **网络设备配色规范**:
  遵循行业标准配色方案,提高图表可读性:
  - 安全设备 (防火墙): 红色系 `#ffcdd2`, 边框 `#d32f2f`, `stroke-width: 2`
  - 路由设备 (路由器): 黄色系 `#fff9c4`
  - 交换设备 (交换机): 绿色系 `#c8e6c9`
  - 服务器: 蓝色系 `#bbdefb`
  - 数据库: 橙色系 `#ffccbc`
  - 云服务: 紫色系 `#d1c4e9`
  - 用户/客户端: 浅蓝色系 `#e3f2fd`
  """,

  """
  **安全设备必须突出**:
  安全设备 (防火墙、WAF、IDS/IPS) 应该使用红色系并加粗边框,让安全边界一目了然。
  - ✅ 正确: `防火墙: { style.fill: "#ffcdd2"; style.stroke: "#d32f2f"; style.stroke-width: 2 }`
  - ❌ 错误: `防火墙: { shape: rectangle }` (无特殊样式)
  """,

  """
  **网络区域使用容器**:
  使用容器明确划分网络区域 (DMZ、内网、云平台) 能清晰表达安全边界。
  - ✅ 正确: `DMZ区: { Web服务器 }`, `内网: { 应用服务器 }`
  - ❌ 错误: `Web服务器 -> 应用服务器` (无网络区域划分)
  """,

  """
  **流量方向必须正确**:
  内网不应该直接连接互联网,应该通过防火墙进行访问控制。
  - ✅ 正确: `互联网 -> 防火墙 -> 内网`
  - ❌ 错误: `内网 <-> 互联网` (缺少防火墙)
  """,

  """
  **连接必须标注协议或类型**:
  网络连接应该标注协议或流量类型。
  - ✅ 正确: `A -> B: "HTTP/HTTPS"`
  - ✅ 正确: `本地 -> 云端: "VPN隧道"`
  - ❌ 错误: `A -> B` (缺少标签)
  """,

  """
  **加密连接使用虚线**:
  VPN 等加密连接应该使用虚线样式区分普通连接。
  - ✅ 正确: `本地 <-> VPN网关: "VPN隧道" { style.stroke-dash: 3; style.stroke-width: 2 }`
  - ❌ 错误: `本地 -> 云端` (未标识加密)
  """,

  """
  **集群使用 multiple 标识**:
  服务器集群应该使用 `style.multiple: true` 表示多实例。
  - ✅ 正确: `Web服务器集群: { style.multiple: true }`
  - ❌ 错误: 每个服务器单独声明 (Web1, Web2, Web3)
  """
]

# ============================================
# Section 3: P 流程规范
# ============================================

[P_process]
items = [
  """
  **1. 识别网络拓扑结构**:
  - 确定网络分层 (互联网、DMZ、内网、云平台)
  - 识别网络设备 (路由器、交换机、防火墙、负载均衡器)
  - 确定服务器和存储设备
  - 识别外部实体 (用户、外部服务)
  """,

  """
  **2. 设计网络区域**:
  - 使用容器划分网络区域 (DMZ、内网)
  - 为每个区域分配合适的配色
  - 规划安全边界和访问控制点
  - 确定网络设备的部署位置
  """,

  """
  **3. 确定设备形状和样式**:
  - 互联网/云服务使用 `cloud` 形状
  - 路由器/API网关使用 `hexagon` 形状
  - 防火墙使用红色系并加粗边框
  - 数据库使用 `cylinder` 形状
  - 集群使用 `style.multiple: true`
  """,

  """
  **4. 设计网络连接**:
  - 确定设备之间的连接关系
  - 标注连接协议或流量类型 (HTTP/HTTPS, SSH, VPN)
  - 加密连接使用虚线 (`stroke-dash: 3`)
  - 双向连接使用 `<->`,单向访问控制使用 `->`
  - 在容器外定义连接线,保持布局清晰
  """,

  """
  **5. 应用 D2 语法和优化**:
  - 设置布局方向 (`direction: right` 或 `direction: down`)
  - 为每个设备设置形状和样式
  - 使用容器嵌套表示网络区域
  - 使用路径引用连接嵌套设备 (`本地数据中心.企业防火墙 -> 本地数据中心.内网.应用服务器`)
  - 确保安全边界清晰可见
  - 测试代码可在 Kroki 成功渲染
  """
]

# ============================================
# Section 4: H 质量标准
# ============================================

[H_quality]
items = [
  """
  **网络图结构正确性**:
  - 网络区域清晰: 使用容器划分 DMZ、内网等区域
  - 设备形状合适: 路由器用 `hexagon`, 服务器用 `rectangle`, 数据库用 `cylinder`
  - 配色规范遵守: 安全设备红色系, 路由黄色系, 交换绿色系, 服务器蓝色系
  - 代码可在 Kroki 成功渲染
  """,

  """
  **网络安全规范**:
  - 安全设备突出: 防火墙使用红色系和加粗边框 (`stroke-width: 2` 或更高)
  - 流量方向正确: 内网不直接连接互联网,需通过防火墙
  - 安全边界明确: DMZ 与内网有明确的隔离和访问控制
  - 加密连接区分: VPN/隧道使用虚线样式 (`stroke-dash: 3`)
  """,

  """
  **网络细节完整性**:
  - 连接标签清晰: 标注协议或流量类型 (HTTP/HTTPS, SSH, VPN等)
  - 集群表示准确: 服务器集群使用 `style.multiple: true`
  - 高可用架构: 主备链路、负载均衡等体现冗余设计
  - 子网划分合理: 相关服务器分组到同一子网容器
  """,

  """
  **高级网络概念**:
  - VPN 隧道正确: 加密连接用虚线加粗 (`stroke-dash: 3`, `stroke-width: 2`)
  - 负载均衡器标识: 使用 `hexagon` 形状并加粗边框
  - DNS 服务器突出: 使用黄色系并加粗边框
  - 多层安全防御: 外部防火墙 → WAF → IDS/IPS → 内部防火墙
  - 配色一致性: 同类设备使用相同色系,对比度足够
  """
]

# ============================================
# Section 5: 使用场景
# ============================================

[[use_cases]]
title = "基础企业网络"
scenario = "企业网络结构,包含防火墙、DMZ区和内网"
key_points = [
  "使用 `cloud` 形状表示互联网",
  "防火墙使用红色系并加粗边框突出安全设备",
  "DMZ 和内网使用容器清晰分隔",
  "双向连接用 `<->`, 单向访问控制用 `->`"
]

[[use_cases]]
title = "数据中心网络"
scenario = "数据中心网络拓扑,包含核心交换机、接入交换机和服务器"
key_points = [
  "使用 `hexagon` 形状表示路由器和核心交换机",
  "使用 `style.multiple: true` 表示服务器集群",
  "三层网络架构 (核心、汇聚、接入) 使用容器分层",
  "主备链路都要显示"
]

[[use_cases]]
title = "混合云网络"
scenario = "混合云网络架构,包含本地数据中心、VPN 和公有云"
key_points = [
  "使用容器分隔本地和云端资源",
  "VPN 连接使用虚线表示加密隧道 (`stroke-dash: 3`, `stroke-width: 2`)",
  "云资源使用紫色系配色区分",
  "包含用户视角展示访问路径"
]
