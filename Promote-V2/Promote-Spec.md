# Promote V2 Prompt Specification

本规范用于定义 DiagramAI v2 版三级提示词（L1/L2/L3）的组织方式与写作要求，所有入库初始数据需遵循此文档。

## 全局原则

- 采用 DEPTH（Define、Establish、Provide、Task、Human）结构，使用 Markdown 一级标题 `# D`、`# E`、`# P`、`# T`、`# H` 分段。
- `content_md` 中仅包含投喂模型的最终语句，不写解释说明；所有描述需简洁、命令式或陈述式。
- 内容必须可独立解析组装：段落之间不得依赖上文隐含信息。
- 严禁对任一语言或图表类型给出“少用”“不常见”“不推荐”等主观评价，必须使用客观的约束、限制或注意事项表述。
- 句式保持命令语气或陈述语气，避免提问式描述或第一人称旁白。

## 长度配额

- L1/L2/L3 总字数目标范围 1,500-5,000。
- 推荐配额：L1 900-1,100 字、L2（单语言） 550-800 字、L3（单类型） 650-900 字；若需调整，应优先保持 L1/L2 的完整性，再裁剪 L3 次要语句。
- DEPTH 各段宜控制在 1-3 句、每句 30-80 个汉字或等效长度，以便后续自动拼接和审校。

## DEPTH 信息分布

| DEPTH 段      | L1 通用层                                                            | L2 语言层                                                        | L3 类型层                                                       |
| ------------- | -------------------------------------------------------------------- | ---------------------------------------------------------------- | --------------------------------------------------------------- |
| D (Define)    | 固定三专家角色：需求分析、图表架构、代码实现；强调协作目标           | 如语言有额外角色（如语法稽核员）则在此补充，否则留空             | 根据图表类型追加特化角色（如流程审校员）                        |
| E (Establish) | 三项全局硬指标：零语法错误、结构覆盖需求、命名/语言规范              | 语言红线：保留字禁用、声明格式、转义规则、大小写要求             | 类型红线：关键节点/结构必须存在、特定约束（起止、顺序、并行等） |
| P (Provide)   | 系统背景：DiagramAI 场景、中文标签偏好、输出纯代码等                 | 渲染环境/版本限制、语言共性设定                                  | 常见业务语境、布局偏好或结构侧重                                |
| T (Task)      | 任务判别：生成/调整/修复三模式及执行骨架                             | 语言特有步骤（如特定声明或块结构），没有则简述“遵循语言语法顺序” | 类型操作骨架：节点/连线步骤、布局建议、数量约束                 |
| H (Human)     | 自检框架：语法/结构/需求 ≥8 分，未达标自修；提醒复核语言与类型特有项 | 语言复核列表（保留字、声明、转义等）                             | 类型复核列表（必备元素、分支闭合、排序等）                      |

## 写作规范

### 通用要求

- 每个一级标题下仅写 1–3 句，避免列表堆叠；若需列举规则，使用逗号或分号连接。
- 避免出现 “L1/L2/L3” 等层级字样；角色和约束直接描述。
- 不使用 Markdown 代码块、引用或二级标题；保持结构简单。
- 使用 `{language}`、`{diagram_type}` 等占位符仅在确有需要时出现，确保后续拼接可替换。

### L1 特殊说明

- D 段必须明确三位专家和合作目标；不得省略。
- T 段需包含三种任务模式的判别条件和对应行动顺序。
- H 段保证自检维度明确（语法、结构、需求），并提示复核下层约束。

### L2 特殊说明

- 若语言无额外角色，D 段写 “无额外角色” 或直接留一句空指令（例如“保持上层角色协作不变”）以便解析器识别。
- E 段集中列出语言硬限制，优先顺序按照破坏性从高到低排列。
- H 段用于补充语言专属复核点（保留字、转义、声明闭合）。

### L3 特殊说明

- D 段仅添加必要的类型角色，避免重复 L1 角色名称。
- E 段强调不可缺失的结构元素或约束（如流程图起止节点、时序图 actor 声明等）。
- T 段描述具体操作骨架，控制在三句以内。
- H 段列出类型检查点，按执行顺序排列。

## 解析与拼接提示

- 入库后按一级标题拆分；若某段缺失或为空，视为该层对该 DEPTH 段不补充。
- 拼接时合并同名段落并去重术语，再改写为自然语言顺序：角色 → 指标 → 背景 → 任务 → 自检。
- 若合并后长度超出预算，应优先裁剪 L3 非硬性语句，其次删减 L2 次要约束，最后微调 L1。
